### vagrant notes ###
prerequis : 
virtualbox + modules dkms + kernel linux avec les headers correspondant. Il peut être nécéssaire de reconfigurer virtualbox-dkms :
sudo apt-get install virtualbox virtualbox-dkms linux-headers-amd64
sudo apt-get install linux-image-4.0.0-2-amd64 linux-headers-4.0.0-2-amd64
sudo dpkg-reconfigure virtualbox-dkms

Initialisation :
vagrant init ubuntu/trusty64
vagrant up # le premier up va download l'image vagrant de notre vm ubuntu
Un fois installé on voit dans notre repertoire  une arbo : 
boogie@x61:~/lab/ansible/playbooks$ tree .*
.
└── Vagrantfile
..
└── playbooks
    └── Vagrantfile
.vagrant
└── machines
    └── default
        └── virtualbox
            ├── action_provision
            ├── action_set_name
            ├── id
            ├── index_uuid
            ├── private_key
            └── synced_folders

On lance notre vm avec
vagrant up
On  y accede via
vagrant ssh
vagrant redirige le port 22 classique du ssh sur le port 2222
Pour modifier se comportement par defaut un 
vagrant ssh-config
Host default
  HostName 127.0.0.1
  User vagrant
  Port 2222
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /home/boogie/lab/ansible/playbooks/.vagrant/machines/default/virtualbox/private_key
  IdentitiesOnly yes
  LogLevel FATAL

On peut par default se connecter via :

boogie@x61:~/lab/ansible/playbooks$ ssh vagrant@127.0.0.1 -p2222 -i /home/boogie/lab/ansible/playbooks/.vagrant/machines/default/virtualbox/private_key
The authenticity of host '[127.0.0.1]:2222 ([127.0.0.1]:2222)' can't be established.
ECDSA key fingerprint is f8:17:1b:a3:5d:55:4c:c8:c7:cd:33:ca:d1:66:2b:ac.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[127.0.0.1]:2222' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 14.04.2 LTS (GNU/Linux 3.13.0-55-generic x86_64)
....

# Redirection de ports :

On va rediriger les ports 8080 et 8443 de notre machine vers les ports 80 et 443 de la vagrant vm.Pour pouvoir correctement tester depuis notre machine le serveur web de la vagrant vm : http://localhost:8080 and https://localhost:8443.
On va modifier le fichier Vagrantfile présent dans notre repertoire principal de manière à configurer la redirection de port :

VAGRANTFILE_API_VERSION = "2"
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  config.vm.box = "ubuntu/trusty64"
  config.vm.network "forwarded_port", guest: 80, host: 8080
  config.vm.network "forwarded_port", guest: 443, host: 8443
end

Apres la modif de conf on reload notre vagrant et on voit la redirection de port se charger :

boogie@x61:~/lab/ansible/playbooks$ vagrant reload

==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==> default: Forwarding ports...
    default: 80 => 8080 (adapter 1)
    default: 443 => 8443 (adapter 1)
    default: 22 => 2222 (adapter 1)
==> default: Booting VM...
==> default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
# Arrêt de la vm :

Pour arrêter notre vm vagrant :

boogie@x61:~/lab/ansible/playbooks$ vagrant halt
==> default: Attempting graceful shutdown of VM...







