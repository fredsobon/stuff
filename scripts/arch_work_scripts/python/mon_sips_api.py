#!/usr/bin/python

import os, sys, socket, re

host = os.environ['HM_SRV_IPADDR']
port = int(os.environ['HM_SRV_PORT'])
#send_string = sys.argv[1]
#receive_string = sys.argv[2]
send_string = '\x3c\x73\x65\x72\x76\x69\x63\x65\x20\x63\x6f\x6d\x70\x6f\x6e\x65\x6e\x74\x3d\x22\x6f\x66\x66\x69\x63\x65\x22\x20\x6e\x61\x6d\x65\x3d\x22\x63\x68\x65\x63\x6b\x6f\x66\x66\x69\x63\x65\x22\x3e\x3c\x63\x68\x65\x63\x6b\x6f\x66\x66\x69\x63\x65\x20\x6d\x65\x72\x63\x68\x61\x6e\x74\x5f\x69\x64\x3d\x22\x30\x31\x34\x32\x31\x33\x32\x34\x35\x36\x31\x31\x31\x31\x31\x22\x20\x6d\x65\x72\x63\x68\x61\x6e\x74\x5f\x63\x6f\x75\x6e\x74\x72\x79\x3d\x22\x66\x72\x22\x20\x2f\x3e\x3c\x2f\x73\x65\x72\x76\x69\x63\x65\x3e\x0d\x0a'
receive_string = '^\x3c\x72\x65\x73\x70\x6f\x6e\x73\x65\x20\x20\x70\x61\x74\x68\x66\x69\x6c\x65\x3d\x22\x4f\x4b\x22\x20\x20\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x3d\x22\x4f\x4b\x22\x20\x2f\x3e\x0a$'

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    #s.settimeout(5)
    s.connect((host, port))
    s.send(send_string)
    response = s.recv(4096)
except OSError as e:
    sys.exit(-1)

if(re.search(r"%s" % receive_string, response) != None):
    sys.exit(0)
else:
    sys.exit(1)
