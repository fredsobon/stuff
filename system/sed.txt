####### sed #####

Fichier de reference : geekstuff :
ex employee :
101,John Doe,CEO
102,Jason Smith,IT Manager
103,Raj Reddy,Sysadmin
104,Anand Ram,Developer
105,Jane Miller,Sales Manager

sed [options] {sed-commands} {input-file}

Sed lit chaque ligne une a une depuis son entree standard (pipe ou file) et execute les commandes sur une ligne particuliere.

-commande basiques/ options :

*Lecture du fichier :
 sed -n 'p' /etc/passwd
*  script : -f (file)

Enregistrement des commandes via un fichier : modele servant a saisir plus facilement de nombreuses commandes via un appelà un script externe :

cat sed-script.test 
/^root/ p
/^boogie/ p


sed -n -f sed-script.test /etc/passwd
root:x:0:0:root:/root:/bin/bash
boogie:x:1000:1000:boogie,,,:/home/boogie:/bin/bash
boogie@x61:~/lab/awk_sed/sed$ 

* Multiples commandes : -e (execute)

sed -n -e '/^root/ p' -e '/^boogie/ p' /etc/passwd


* Multi lignes commandes : {} 

sed -n '{
/^root/ p
/^boogie/ p
}' /etc/passwd
root:x:0:0:root:/root:/bin/bash
boogie:x:1000:1000:boogie,,,:/home/boogie:/bin/bash

/!\ Sed ne modifie jamais le fichier original : il redirige juste son execution vers la sortie standart. Pour enregistrer les modifs dans un fichier il faut saisir directement la redirection vers " > fichier.dest " 

Sed utilise la sequence : REPR : Read Execute Print Repeat
-> Read : lecture de la ligne dans un "pattern space"
-> Execution des commandes dans le pattern space
-> Print : affichage du resultat ET vidage du pattern space 
-> Repeat : recommence a la ligne suivante et jusqu'a la fin du fichier.

- Commande p print pattern space.
par defaut sed affiche sur la sortie standart .le p permet de controller precisement se que l'on veut sur la sortie sandart . Il est utiliser conjointement avec "-n" qui va neutraliser la sortie standart de sed : sans quoi de base on aurait l'affichage en double sur notre sortie : "sed" de base + "p".

On peut donc preciser les lignes que l'on veut afficher .Ex :


-affichage de la ligne 1 du fichier /etc/passwd :
sed -n '1p' /etc/passwd
root:x:0:0:root:/root:/bin/bash

-affichage d'un interval de lignes :

sed -n '2,4p' /etc/passwd
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin


- affichage de la ligne 1 et 2 puis de la ligne 5 du fichier passwd :

sed -n -e '1,2p' -e '5p' /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
 
- On peut biensur utiliser les regexps pour filtrer notre affichage :
Ici on affiche de la troisième ligne du fichier à la fin : 

cat employee  |sed -n '3,$ p'
103,Raj Reddy,Sysadmin
104,Anand Ram,Developer
105,Jane Miller,Sales Manager
 
Les intervalles de ligne peuvent donc être spécifiés avec : "," (n,m) mais aussi avec les charactères "+" et "~" :

- "+" : permet de definir le nombre de ligne que l'on veut imprimer à partir de notre premier interval :
Ici on imprime la première ligne suivi de 2 autres lignes : 
cat employee  |sed -n '1,+2 p'
101,John Doe,CEO
102,Jason Smith,IT Manager
103,Raj Reddy,Sysadmin

- "~"  : va permettre d'exclure un nombre défini de lignes .

Exemple : ici on va afficher toutes les lignes impaires ( on commence à la première puis on affiche une ligne sur deux : 
boogie@x61:~/lab/awk_sed/sed$ cat employee  |sed -n '1~2 p'
101,John Doe,CEO
103,Raj Reddy,Sysadmin
105,Jane Miller,Sales Manager

Ici on affiche que les lignes paires : 
boogie@x61:~/lab/awk_sed/sed$ cat employee  |sed -n '2~2 p'
102,Jason Smith,IT Manager
104,Anand Ram,Developer

On affiche une ligne sur quatre comme ceci : 
cat employee  |sed -n '1~4 p'
101,John Doe,CEO
105,Jane Miller,Sales Manager

Comme on peut sélectionner le numéro de ligne que l'on veut afficher , on peut selectionner une pattern à afficher.
Ex :
cat employee |sed -n '/Sysadmin/ 'p
103,Raj Reddy,Sysadmin

On peut combiner les deux : selectionner un pattern et une ligne particulière : 
Ex : ici on affiche la ligne contenant le pattern 'sysadmin' et la premiere ligne du fichier : 
cat employee |sed -n -e '/Sysadmin/ p' -e '1 p'
101,John Doe,CEO
103,Raj Reddy,Sysadmin

On remarque que sed evalue les instructions avant de les afficher : il affiche ici la premiere ligne avant la ligne contenant le pattern "sysadmin" .

On peut afficher la ligne contenant un pattern jusqu'à la fin du fichier :
cat employee |sed -n -e '/Dev/,$ p'
104,Anand Ram,Developer
105,Jane Miller,Sales Manager

Un intervalle de pattern : 

cat employee |sed -n -e '/Sysadmin/, /Dev/ p'
103,Raj Reddy,Sysadmin
104,Anand Ram,Developer

-Commande "delete" :

On peut supprimer des lignes avec sed. Comme avec les differentes commandes : cette suppression ne ce fait que sur l'affichage standart ( le fichier original n'est pas modifié.)

Ex : ici on supprime la troisième ligne du fichier : 

cat employee  |sed '3 d'
101,John Doe,CEO
102,Jason Smith,IT Manager
104,Anand Ram,Developer
105,Jane Miller,Sales Manager

Idem qu'avec print : on peut supprimer un intervalle de ligne : 
cat employee  |sed '3,$ d'
101,John Doe,CEO
102,Jason Smith,IT Manager

On peut supprimer une ligne contenant un certain pattern 
cat employee  |sed '/Developer/ d'
101,John Doe,CEO
102,Jason Smith,IT Manager
103,Raj Reddy,Sysadmin
105,Jane Miller,Sales Manager

On peut egalement supprimer un intervalle compri entree deux pattern détectés :

cat employee  |sed '/Sysadmin/,/Sales/ d'
101,John Doe,CEO
102,Jason Smith,IT Manager


On peut supprimer grace aux regexp les lignes vides et les lignes commencent par un commentaire.Ex :

cat cgi.cfg |sed -e '/^$/d' -e '/^#/d'
