== notes set up Harbor avec helm : ==

- ajout du repo helm : 
 helm repo add harbor https://helm.goharbor.io

- Config pour exposition du service harbor :
-> ingress controller 
-> **ClusterIP**: Exposes the service on a cluster-internal IP. Choosing this value makes the service only reachable from within the cluster.
-> NodePort: Exposes the service on each Node’s IP at a static port (the NodePort). You’ll be able to contact the NodePort service, from outside the cluster, by requesting NodeIP:NodePort.
-> LoadBalancer: Exposes the service externally using a cloud provider’s load balancer.

- Config de l'url externe :

The external URL for Harbor core service is used to:
-> populate the docker/helm commands showed on portal
-> populate the token service URL returned to docker/notary client

Format: protocol://domain[:port]. Usually:

if expose the service via Ingress, the domain should be the value of expose.ingress.hosts.core

if expose the service via ClusterIP, the domain should be the value of expose.clusterIP.name

if expose the service via NodePort, the domain should be the IP address of one Kubernetes node

if expose the service via LoadBalancer, set the domain as your own domain name and add a CNAME record to map the domain name to the one you got from the cloud provider

If Harbor is deployed behind the proxy, set it as the URL of proxy.

- Configure the way how to persistent data
Disable: The data does not survive the termination of a pod.

Persistent Volume Claim(default): A default StorageClass is needed in the Kubernetes cluster to dynamic provision the volumes. Specify another StorageClass in the storageClass or set existingClaim if you have already existing persistent volumes to use.

External Storage(only for images and charts): For images and charts, the external storages are supported: azure, gcs, s3 swift and oss.

Configure the secrets
Secret keys: Secret keys are used for secure communication between components. Fill core.secret, jobservice.secret and registry.secret to configure.

Certificates:

notary: Used for authentication during communications. Fill notary.secretName to configure. Notary server certificate must be issued with notary service name as subject alternative name.

core: Used for token encryption/decryption. Fill core.secretName to configure.

Secrets and certificates must be setup to avoid changes on every Helm upgrade (see: #107).

- Installation :
helm install my-release harbor/harbor

- Désitallation :
helm uninstall my-release


