==== notes quick sql ud : ====

= intro : =

bdd: outil permettant de stocker des données stockées selon des themes
sgbg: systeme gestion base de données 
tables: contiennent des colonnes qui contient des données en lignes.
sql: structured query language
ajouter , supprimer des données , selectionner des données ..

env de travail :
install xamp : 
dl de l'appi sur xampp :
chmod 775 xampp-linux-x64-7.2.32-0-installer.run
sudo ./xampp-linux-x64-7.2.32-0-installer.run

setup apache mariadb phpmyadmin perl ..

dir d'install :
/opt/lampp

une fois l'install faite on peut lancer via un pannel de controle les apps :
ex : apache et mysql

on check avec un localhost : qui nous ammene dans le home dir xampp 
on pourra de base acceder a phpmyadmin depuis un browser sur http://localhost/phpmyadmin/

pour gérer xampp :
sudo /opt/lampp/lampp start                                                                    (⎈ b-k:monitoring)
Starting XAMPP for Linux 7.2.32-0...
XAMPP: Starting Apache...ok.
XAMPP: Starting MySQL...ok.
XAMPP: Starting ProFTPD...ok.

ou avec la gestion graphique :
cd /opt/lampp
sudo ./manager-linux.run (or manager-linux-x64.run)

idem pour stop

= creation d'une bdd :

on peut utiliser phpmyadmin ou alors faire nos requettes en sql depuis le client mysql :

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 10.4.13-MariaDB Source distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| phpmyadmin         |
| test               |
+--------------------+
5 rows in set (0.001 sec)

MariaDB [(none)]>


creation depuis phpmyadmin :

base udemy type utf8_bin

on va importer un shema de bdd deja fait (udemy-sql.sql ) cf dir 
bdd de cinema gestion de films ,cine etc ..

id : est l'unicité d'une données.
l'id est quelque chose d'unique dans une table.

= select/insert/update/delete :

requettes les plus utilisées.

- select :
on va pouvoir selectionner les colonnes que l'on veut dans une table.

ex: 
select id,first_name from members renvoit toutes les colonnes id et first_name de la table members.
select * from members : on selectionne toutes les colonnes de la tables members.
select distinct first_name from members : on peut avoir plusieurs personnes qui ont le prénom Jean : avec le keyword distinct on ne prendra que la premiere entrée trouvée dans la table. Cela permet d'avoir des données uniques sur les lignes.

SELECT name, city FROM `cinema`

ex : requettes :

pour mémo on interroge avec phpmyadmin ou client mysql : 

boogie@boogie-stuff  ~/Documents/learn/bdd/sql-pour-le-web  sudo /opt/lampp/bin/mysql                                           (⎈ b-k:monitoring)
[sudo] password for boogie:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 69
Server version: 10.4.13-MariaDB Source distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

- on examine les dbs :

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| phpmyadmin         |
| test               |
| udemy              |
+--------------------+
6 rows in set (0.001 sec)

- on selectionne la db udemy :

MariaDB [(none)]> use udemy;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed


- on examine les tables :

MariaDB [udemy]> show tables;
+-----------------+
| Tables_in_udemy |
+-----------------+
| cinema          |
| diffusion       |
| film            |
| language        |
| room            |
+-----------------+
5 rows in set (0.001 sec)


- on fait une description de la table cinema : on recupere le nom des colonnes :

MariaDB [udemy]> desc cinema;
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| cinema_id    | int(11)      | NO   | PRI | NULL    | auto_increment |
| name         | varchar(255) | NO   |     | NULL    |                |
| city         | varchar(255) | NO   |     | NULL    |                |
| number_rooms | int(11)      | NO   |     | NULL    |                |
+--------------+--------------+------+-----+---------+----------------+
4 rows in set (0.002 sec)


- selection des cinéma par leur nom et villes :

MariaDB [udemy]> select name, city from cinema;
+--------------+------------------+
| name         | city             |
+--------------+------------------+
| CGR CINÉMAS  | Bordeaux         |
| CGR CINÉMAS  | Evry             |
| CGR CINÉMAS  | La Rochelle      |
| CGR CINÉMAS  | Clermont-Ferrand |
| CGR CINÉMAS  | Troyes           |
| CGR CINÉMAS  | Colmar           |
| CGR CINÉMAS  | Auxerre          |
| CGR CINÉMAS  | Narbonne         |
| MÉGARAMA     | Boulogne sur Mer |
| MÉGARAMA     | Bordeaux         |
| MÉGARAMA     | Montpellier      |
| MÉGARAMA     | Quimper          |
| MÉGARAMA     | Besançon         |
| MÉGARAMA     | Audincourt       |
+--------------+------------------+
14 rows in set (0.001 sec)


- pour recupérer la liste des noms uniques de cinema :

MariaDB [udemy]> select distinct name from cinema;
+--------------+
| name         |
+--------------+
| CGR CINÉMAS  |
| MÉGARAMA     |
+--------------+


= Ajout de données : insert into .. values :

insert into <table> values <value1, value2 ..> 

ex : table members avec comme colonne id, nom, prenom 

insert into members values(77,'Bob', 'Eponge')

il est possible de ne remplir que certaines colonnes : il faut les selectionner :
insert into members(first_name,name) values('Bob', 'Eponge') ( dans cet exmple on ne remplit pas le champ id : qui sera donc à null (sauf si certains params sont indiqués dans la conf ..) 


on peut ajouter plusieurs valeurs en une requette : en séparant les values par une "," 

insert into members values(77,'Bob', 'Eponge'), (78,'Bab', 'Esponges'), (79, 'Bib', 'Espongitos')

ex: pour table udemy :

MariaDB [udemy]> select * from cinema;
+-----------+--------------+------------------+--------------+
| cinema_id | name         | city             | number_rooms |
+-----------+--------------+------------------+--------------+
...
.....
|        18 | MÉGARAMA     | Audincourt       |            4 |
+-----------+--------------+------------------+--------------+

on ajoute un nouveau cinema :

MariaDB [udemy]> insert into cinema values(19,'CGR','Paris',10);

on controle et c'est ok :
..
|        18 | MÉGARAMA     | Audincourt       |            4 |
|        19 | CGR          | Paris            |           10 |
+-----------+--------------+------------------+--------------+
15 rows in set (0.001 sec)
si on essaye de nouveau d'ecrire la même requette on a une erreur :

MariaDB [udemy]> insert into cinema values(19,'CGR','Paris',10);
ERROR 1062 (23000): Duplicate entry '19' for key 'PRIMARY'


on peut delete notre entrée :

MariaDB [udemy]> delete from cinema where cinema_id = 19;
Query OK, 1 row affected (0.012 sec)


exo:

- ajouter dans la table cinema un cinema sa ville et le nombre de salles 

MariaDB [udemy]> insert into cinema(name,city,number_rooms) values('Mégarama','Paris',10);

on voit que dans la table udemy l'id est incrémenté automatiquement 


|        20 | Mégarama     | Paris            |           10 |
+-----------+--------------+------------------+--------------+

- ajouter deux langues en une seule requete :


MariaDB [udemy]> show tables;
+-----------------+
| Tables_in_udemy |
+-----------------+
| cinema          |
| diffusion       |
| film            |
| language        |
| room            |
+-----------------+
5 rows in set (0.001 sec)

MariaDB [udemy]> desc language;
+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+-------------+--------------+------+-----+---------+----------------+
| language_id | int(11)      | NO   | PRI | NULL    | auto_increment |
| name        | varchar(255) | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
2 rows in set (0.003 sec)

MariaDB [udemy]> insert into language(name) values('Persian'), ('Vietnamese');

MariaDB [udemy]> select * from language;
+-------------+------------+
| language_id | name       |
+-------------+------------+
|           1 | English    |
|           2 | French     |
|           3 | Arabic     |
|           4 | Spanish    |
|           5 | Portuguese |
|           6 | Russian    |
|           7 | German     |
|           8 | Italian    |
|           9 | Japanese   |
|          10 | Chinese    |
|          11 | Korean     |
|          12 | Persian    |
|          13 | Vietnamese |
+-------------+------------+
13 rows in set (0.001 sec)

= update :

modification de valeur dans colonne de table 
update <table> set <column_number> = <value_x>

ex:  remplir une colonne prénoms uniquement avec le prénom Jean 
update members set first_name = 'Jean'; 

on peut changer plusieurs colonnes à la fois :

update members set first_name = 'Jean', last_name = 'Dupont'; 

tous les users des colonnes prénom nom s'appelleront Jean Dupont.

ex: dans la table film on veut definir tous les films avec comme id de langue 2 qui correspond a fr dans la table des languages et original_language_id a 1 (anglais) :

MariaDB [udemy]> update film set language_id = 2 and original_language_id = 1;

changer tous les noms de cinema par "CGR cinema" :
MariaDB [udemy]> update cinema set name = "CGR CINEMA" ;

= Delete :

on va pouvoir purger des données d'une table :

ex : ici on delete tous les champs de la table table :
Delete  from table; ou  Delete * from table;

on pourra seletionner finement ce que l'on veut delete avec le mot clé "where" 


=== Types de données en sql :

= numerique :

- entier : 

ont a 5 types qui vont permettre de stocker des valeurs de tailles différentes :

TINYINT : 1 octet : valeur : 256 valeurs differents ( -127 à 128 )
SMALLINT : 2 octet : -32.768  à + 32.768
MEDIUMINT: : 3 octets : 
INT: 4 octets : -2147483648 +2147483647
BIGINT :  5 octets

on a le type :
SIGN ou UNSIGN 

un unsign sera tjs positif suppérieur ou egal a 0
ex: 
TINYINT UNSIGNED aura comme valeur 0 à 255

- Virgules :

DECIMAL / NUMERIC : codé sur le nombre d'octet qu'on veut on le précise à la creation 
DECIMAL(x,y) : x: nombre total de chiffre , y :nombre de chiffre apres la virgule.
DECIMAL(4,3) : nombre de 4 chiffres dont 3 apres la virgule.
Si on ne precise pas le second chiffre alors celui ci sera de base défini à 0 ..et on aura donc un nombre entier ..

DECIMAL(4,2) aura donc comme valeur tout ce qui sera compri entre -99.99 et +99.99

FLOAT : codé sur 4 octets
DOUBLE : codé sur 8 octets.

BOOLEAN : True /False
Le 0 est considéré comme false .

= Données textuelles :

CHAR   / VARCHAR

on précise dans tous les cas la valeur de stockage  que l'on veut donner 

CHAR(5) : toutes les valeurs du champ prendront 5 octets (même s'i elles sont inférrieure à 5 ) : le champ est figé
VARCHAR(5) : les valeurs pourront faire jusqu'a 5 octects 
Attention VARCHAR prend un octet de plus pour son type à lui même 


si on sait qu'on aura 3 caracteres par ex on settera donc un char
pour un type de le nombre est inconnu on met un varchar


- types :

TINYTEXT : 2*8 octet
TEXT : 2*16 octets max
MEDIUMTEXT: 2*24
LONGTEXT: 2*32


un article de blog devrait tenir avec un TEXT

= type exclusif a mysql :

enum : liste de chaine de caractere possible 
ex: enum(terre,soleil) : les titres de colonnes ne pourront etre que terre ou soleil 
65534 choix possible
set : on pourra avoir des combinaisons possibles :
set(terre,soleil) : terre, /terre,soleil/ soleil 

types pas recommandés car exclusifs à mysql : pb en cas de migration de sgbd.

= données temporelles : =

date : stocker une date : AAAA-MM-JJ
time : HH:MM:SS
datetime : AAAA-MM-JJ HH:MM:SS
year : AAAA

on a aussi le timestamp : nb de secondes ecoulé depuis le 1janvier 1970 mais pas en mysql 

= Attributs :

UNSIGNED
SIGNED 
ZEROFILL : 
permet de tjs avoir le même nombre de chiffre dans une ligne en remplissant les chiffres manquants par un 0 si nécéssaire.
ex :
INT(4) ZEROFILL  : 2 -> 0002
INT(4) ZEROFILL  : 14 -> 0014
INT(4) ZEROFILL  : 1402 -> 1402

AUTOINCREMENT : tres utilisé pour les id : on va incrementé de 1 les valeurs 
/!\ attention si on delete un champ , et qu'on ajoute un nouveau champ : celui ci ne reprendra pas l'ancien id delete mais prendra le suivant dispo 
AUTOINCREMENT est une variable dans la table.
il n'y a jamais deux fois la même valeur dans la table.

NOTNULL :précise que la valeur null dans un champ n'est pas autorisée. On est obligé d'avoir une valeur.
VARCHAR(255) NOTNULL : on met forcement une chaine de caractere max de 255 caracteres.

DEFAULT : permet de mettre une valeur par defaut si rien n'est saisi 
VARCHAR(255) DEFAULT "toto" : on mettra par defaut toto dans le champ si rien n'est défini.



== creation de conditions : ==

WHERE :
permet une selection des champ en fonction de criteres :

ex: on renvoit toutes les lignes ou le prénom est égal à Jean 
select * from members where first_name = "Jean" :

fonctionne avec select, update, delete 

Utilisation des operateurs :
comparaison :
= , != , > , < , >= , <= 
logiques : permet de gérer les conditions entre elles 
AND, OR , NOT

ex: 
MariaDB [udemy]> select * from film where budget > 0;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
8 rows in set (0.001 sec)

MariaDB [udemy]>

MariaDB [udemy]> select * from film where running_time > 100 AND original_language_id =  1;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
8 rows in set (0.001 sec)

MariaDB [udemy]>


MariaDB [udemy]> select * from film where running_time > 100 OR budget = 0;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
9 rows in set (0.001 sec)

MariaDB [udemy]>


MariaDB [udemy]> select * from film where running_time = 108 OR NOT budget = 0;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
8 rows in set (0.001 sec)


= IN :

permet de remplacer une suite de OR dans un where 

- selection des films avec un id 7 8 ou 9 : 

MariaDB [udemy]> select * from film where film_id in (7,8,9);
+---------+----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                 | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       7 | Django Unchained     | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain           | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère  | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
+---------+----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
3 rows in set (0.001 sec)


- selection des films dont l'id n'est pas 7 8 ou 9 : 

MariaDB [udemy]> select * from film where not film_id in (7,8,9);
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name                  | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures |          140 | 55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures |          189 | 60000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                      |          109 |        0 |           2 |                    9 |
|       4 | Lion                  | SDN                           |          118 |        0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport       |          140 | 40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures |          195 | 25000000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France           |          111 | 33000000 |           2 |                    1 |
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
7 rows in set (0.001 sec)


- on peut cumuler nos filtres de recherche :

MariaDB [udemy]> select * from film where not film_id in (7,8,9) and distributor in ("Eurozoom");
+---------+-----------+-------------+--------------+--------+-------------+----------------------+
| film_id | name      | distributor | running_time | budget | language_id | original_language_id |
+---------+-----------+-------------+--------------+--------+-------------+----------------------+
|       3 | Your Name | Eurozoom    |          109 |      0 |           2 |                    9 |
+---------+-----------+-------------+--------------+--------+-------------+----------------------+
1 row in set (0.001 sec)


= BETWEEN :
trouver des colonnes ayant des valeurs avec des intervals (qui sont pris en compte ) : peut etre utile pour les dates ou les nombres :

- trouver les films ayant une durée comprise entre 100 et 120 minutes : 
MariaDB [udemy]> select * from film where running_time between 100 AND 120 ;
+---------+-------------+---------------------+--------------+----------+-------------+----------------------+
| film_id | name        | distributor         | running_time | budget   | language_id | original_language_id |
+---------+-------------+---------------------+--------------+----------+-------------+----------------------+
|       3 | Your Name   | Eurozoom            |          109 |        0 |           2 |                    9 |
|       4 | Lion        | SDN                 |          118 |        0 |           2 |                    1 |
|      10 | Gran Torino | Warner Bros. France |          111 | 33000000 |           2 |                    1 |
+---------+-------------+---------------------+--------------+----------+-------------+----------------------+
3 rows in set (0.001 sec)

= ISNULL :

va check que la valeur du champ est null :

- check que la duree des films est bien renseignée :
MariaDB [udemy]> select * from film where running_time is null ;
Empty set (0.001 sec)

aucune ligne retournée : tout est bien saisi.

= IS NOT NULL : 

on a donc aussi le is not null qui est l'inverse du is null :

MariaDB [udemy]> select * from film where running_time is not  null ;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)


ex:
- liste de film dont la durée est comprise entre 100 et 140 min et dont le budget n'est pas null :

MariaDB [udemy]> select * from film where running_time between 100 and 140 and budget is not null ;
+---------+--------------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name               | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+--------------------+-------------------------------+--------------+----------+-------------+----------------------+
|       1 | Forrest Gump       | United International Pictures |          140 | 55000000 |           2 |                    1 |
|       3 | Your Name          | Eurozoom                      |          109 |        0 |           2 |                    9 |
|       4 | Lion               | SDN                           |          118 |        0 |           2 |                    1 |
|       5 | Tu ne tueras point | Metropolitan FilmExport       |          140 | 40000000 |           2 |                    1 |
|      10 | Gran Torino        | Warner Bros. France           |          111 | 33000000 |           2 |                    1 |
+---------+--------------------+-------------------------------+--------------+----------+-------------+----------------------+
5 rows in set (0.001 sec)

- changer le nombre de place dans la salle F ayant l'id 3 :


MariaDB [udemy]> select * from room where name = "F" and cinema_id = 3;
+---------+------+---------------+-----------+
| room_id | name | number_places | cinema_id |
+---------+------+---------------+-----------+
|       6 | F    |            60 |         3 |
+---------+------+---------------+-----------+
1 row in set (0.001 sec)

MariaDB [udemy]> update room set number_places = 65  where name = "F" and cinema_id = 3;

MariaDB [udemy]> select * from room where name = "F" and cinema_id = 3;
+---------+------+---------------+-----------+
| room_id | name | number_places | cinema_id |
+---------+------+---------------+-----------+
|       6 | F    |            65 |         3 |
+---------+------+---------------+-----------+
1 row in set (0.000 sec)

- Supprimer les cinémas des villes de colma et evry :

MariaDB [udemy]> select * from cinema where city in ('Colmar','Evry');
+-----------+--------------+--------+--------------+
| cinema_id | name         | city   | number_rooms |
+-----------+--------------+--------+--------------+
|         4 | CGR CINÉMAS  | Evry   |            8 |
|         8 | CGR CINÉMAS  | Colmar |            6 |
+-----------+--------------+--------+--------------+
2 rows in set (0.001 sec)

MariaDB [udemy]> delete from cinema where city in('Colmar','Evry');
Query OK, 2 rows affected (0.010 sec)

== creation d'alias : ==


permet de renommer une colonnes pour permettre de requetter des colonnes.

- ici on va créer un alias prenom sur la colonne first_name de la table members 
select fisrt_name AS prenom from members;


- ici on crée un alias doublure sur la colonne language_id :
MariaDB [udemy]> select language_id as doublage from film;
+----------+
| doublage |
+----------+
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
+----------+
10 rows in set (0.001 sec)

on est pas obligé de mettre le keyword as : de base sql comprend sans :
ex :
MariaDB [udemy]> select language_id doublage from film;
+----------+
| doublage |
+----------+
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
|        2 |
+----------+
10 rows in set (0.000 sec)


on peut faire une colonne avec plusieurs :

select col1*col2 AS col3 from table;

MariaDB [udemy]> select language_id*original_language_id as lang from film;
+------+
| lang |
+------+
|    2 |
|    2 |
|   18 |
|    2 |
|    2 |
|    2 |
|    2 |
|    2 |
|    2 |
|    2 |
+------+
10 rows in set (0.001 sec)

ex :
on peut créer une colonne qui convertira le temps des films minutes en heures :

MariaDB [udemy]> select running_time / 60 as hours from film;
+--------+
| hours  |
+--------+
| 2.3333 |
| 3.1500 |
| 1.8167 |
| 1.9667 |
| 2.3333 |
| 3.2500 |
| 2.7333 |
| 2.9167 |
| 1.5833 |
| 1.8500 |
+--------+
10 rows in set (0.001 sec)

MariaDB [udemy]>

= ORDER BY :

permet de trier nos résultats 

select * from table order by column ;

MariaDB [udemy]> select * from film order by original_language_id ;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)

on peut préciser l'ordre de tri :

asc -> ascendant 
desc -> descendant 


MariaDB [udemy]> select * from film order by original_language_id asc;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)

MariaDB [udemy]> select * from film order by original_language_id desc;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)

MariaDB [udemy]>


en cas de resultat identique dans notre tri , on peut ajouter une seconde colomne pour notre tri :
ici on retri notre resultat precedant en prenant en compte la durée du film :


MariaDB [udemy]> select * from film order by original_language_id, running_time desc ;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)

= LIMIT :

limiter la sortie de nos résultats :

select * from table order by column limit number; 

on va afficher 10 lignes de résultat de recherche des prénoms de notre table : 
select * from member order by first_name limit 10;


- affichage de 3 films filtrés par durée :

MariaDB [udemy]> select * from film order by running_time limit 3;
+---------+----------------------+---------------------+--------------+----------+-------------+----------------------+
| film_id | name                 | distributor         | running_time | budget   | language_id | original_language_id |
+---------+----------------------+---------------------+--------------+----------+-------------+----------------------+
|       9 | 12 hommes en colère  | Carlotta Films      |           95 |   340000 |           2 |                    1 |
|       3 | Your Name            | Eurozoom            |          109 |        0 |           2 |                    9 |
|      10 | Gran Torino          | Warner Bros. France |          111 | 33000000 |           2 |                    1 |
+---------+----------------------+---------------------+--------------+----------+-------------+----------------------+
3 rows in set (0.001 sec)

MariaDB [udemy]>


la même chose avec les durée décroissantes :
MariaDB [udemy]> select * from film order by running_time desc limit 3  ;
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name                  | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
|       6 | La Liste de Schindler | United International Pictures |          195 | 25000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures |          189 | 60000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures            |          175 |  6000000 |           2 |                    1 |
+---------+-----------------------+-------------------------------+--------------+----------+-------------+----------------------+
3 rows in set (0.001 sec)

on peut ajouter un index dans notre limit :
on aura donc le premier chiffre qui correspond a l'index dans la table et le second qui correspond au nombre de ligne de résultat retourné :
limit 5,10 

ex :
MariaDB [udemy]> select * from film ;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.001 sec)

MariaDB [udemy]> select * from film order by film_id limit 0,2;
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name           | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
|       1 | Forrest Gump   | United International Pictures |          140 | 55000000 |           2 |                    1 |
|       2 | La Ligne verte | United International Pictures |          189 | 60000000 |           2 |                    1 |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
2 rows in set (0.001 sec)

MariaDB [udemy]> select * from film order by film_id limit 1,2;
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name           | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
|       2 | La Ligne verte | United International Pictures |          189 | 60000000 |           2 |                    1 |
|       3 | Your Name      | Eurozoom                      |          109 |        0 |           2 |                    9 |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
2 rows in set (0.001 sec)

MariaDB [udemy]>


- Tri des deux films au plus gros budget :
MariaDB [udemy]> select * from film order by budget desc limit 2;
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name             | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       7 | Django Unchained | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|       2 | La Ligne verte   | United International Pictures  |          189 |  60000000 |           2 |                    1 |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
2 rows in set (0.001 sec)

MariaDB [udemy]>

 si on commence à l'index 1 ( deuxieme ligne) on aura donc le film suivant qui apparaitra :
 MariaDB [udemy]> select * from film order by budget desc limit 1,2;
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name           | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
|       2 | La Ligne verte | United International Pictures |          189 | 60000000 |           2 |                    1 |
|       1 | Forrest Gump   | United International Pictures |          140 | 55000000 |           2 |                    1 |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
2 rows in set (0.001 sec)

MariaDB [udemy]>


ex: 

trier la liste des langues par ordre alphabetique :


MariaDB [udemy]> select * from language order by Name;
+-------------+------------+
| language_id | name       |
+-------------+------------+
|           3 | Arabic     |
|          10 | Chinese    |
|           1 | English    |
|           2 | French     |
|           7 | German     |
|           8 | Italian    |
|           9 | Japanese   |
|          11 | Korean     |
|          12 | Persian    |
|           5 | Portuguese |
|           6 | Russian    |
|           4 | Spanish    |
|          13 | Vietnamese |
+-------------+------------+
13 rows in set (0.001 sec)


-recup le film avec le plus gros budget :
MariaDB [udemy]> select * from film order by budget desc limit 1;
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name             | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       7 | Django Unchained | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
1 row in set (0.001 sec)

MariaDB [udemy]>

- trouver le 4 film le plus long :
MariaDB [udemy]> select * from film order by running_time desc limit 3,1;
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| film_id | name             | distributor                    | running_time | budget    | language_id | original_language_id |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|       7 | Django Unchained | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
+---------+------------------+--------------------------------+--------------+-----------+-------------+----------------------+
1 row in set (0.001 sec)

MariaDB [udemy]>

= Fonctions : =

les fonctions vont permettre de prendre en compte plusieurs lignes pour faire des statistiques.

count() : compte le nombre de ligne
avg() : fait la moyenne
sum() : fait la somme
min() : envoie le plus petit
max() : envoie le plus grand.

select fonction(colonne) from table;

- count : avec count on peut mettre un "*" car on prend tous les champs.
select count(*) as total from members;

- avg : on identifie la moyenne ( ex : ici moyenne d'age des membre d'une table.) 
select avg(age) as moyenne from members;

on peut faire des selection multiples :
ici on recup la date la plus petite d'enregistrement d'un membre et son id. 
ex : select id, min(register_date) from members 
ex: ici on va recup le nombre de prenom unique de notre table :
select count(distinct(first_name) from members ;

MariaDB [udemy]> select count(distinct distributor) from film;
exo :
- trouver le nombre de salle max par cinema
MariaDB [udemy]> select max(number_rooms) as salles from cinema;
- trouver la moyenne de la durée des films et la moyenne de budget de film :
MariaDB [udemy]> select avg(running_time), avg(budget) from film;
+-------------------+---------------+
| avg(running_time) | avg(budget)   |
+-------------------+---------------+
|          143.6000 | 31934000.0000 |
+-------------------+---------------+
- trouver le nombre de ville ayant un cinema :

MariaDB [udemy]> select count(distinct city) from cinema;
+----------------------+
| count(distinct city) |
+----------------------+
|                   12 |
+----------------------+
1 row in set (0.001 sec)


== requettes avancees : ==

join / union / exist 


- jointure :

va nous permettre en une requette sql de recupérer des valeurs de plusieurs tables différentes.

inner join : va permettre de recupérer les elements ayant des points communs à deux tables 
left join : permet de recup les elements de toute une table (celle de gauche et recupérer les élements commun de cette table avec la seconde table )
right join : permet de recup les elements de toute une table (celle de droite et recupérer les élements commun de cette table avec la seconde table )


- inner join :

select * from table1 inner join table2 on table1.colonne = table2.colonne

select * from purchases inner join members on purshases.member_id = members.id 

on va souvent utiliser les alias pour les jointures afin de faciliter les requettes :

select * from table1 as t1 inner join table2 as t2  on t1.colonne = t2.colonne

select p.*, register_id from purchases as p inner join members as m  on p.member_id = m.id 

- left join :

select * from table1 as t1 left join table2 as t2 on t1.colonne = t2.colonne

select m.id, p.id from members as m left join purchases as p on m.id = p.member_id 


- right join : 

select * from table1 as t1 right join table2 as t2 on t1.colonne = t2.colonne

select m.id, p.id from members as m right join purchases as p on m.id = p.member_id 

ex: on va pouvoir faire le lien entre deux tables 

MariaDB [udemy]> desc room;
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| room_id       | int(11)      | NO   | PRI | NULL    | auto_increment |
| name          | varchar(255) | NO   |     | NULL    |                |
| number_places | int(11)      | NO   |     | NULL    |                |
| cinema_id     | int(11)      | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
4 rows in set (0.002 sec)
MariaDB [udemy]> desc cinema;
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| cinema_id    | int(11)      | NO   | PRI | NULL    | auto_increment |
| name         | varchar(255) | NO   |     | NULL    |                |
| city         | varchar(255) | NO   |     | NULL    |                |
| number_rooms | int(11)      | NO   |     | NULL    |                |
+--------------+--------------+------+-----+---------+----------------+
4 rows in set (0.002 sec)

MariaDB [udemy]> select * from room limit 3;
+---------+------+---------------+-----------+
| room_id | name | number_places | cinema_id |
+---------+------+---------------+-----------+
|       1 | A    |           100 |         3 |
|       2 | B    |            60 |         3 |
|       3 | C    |            70 |         3 |
+---------+------+---------------+-----------+
3 rows in set (0.001 sec)

MariaDB [udemy]> select * from cinema limit 3;
+-----------+--------------+------------------+--------------+
| cinema_id | name         | city             | number_rooms |
+-----------+--------------+------------------+--------------+
|         3 | CGR CINÉMAS  | Bordeaux         |           10 |
|         5 | CGR CINÉMAS  | La Rochelle      |            6 |
|         6 | CGR CINÉMAS  | Clermont-Ferrand |            7 |
+-----------+--------------+------------------+--------------+
3 rows in set (0.001 sec)

MariaDB [udemy]> 


on peut donc sortir la liste des cinema_id présents dans la table room et cinema: ici le nom de la colonne est identique mais ce nom peut être différent :

on fait notre requette et on voit qu'on a toutes les valeurs de la table room et de la table cinema puisqu'on a fait une requette sur *  


MariaDB [udemy]> select * from room as r inner join cinema as c on r.cinema_id = c.cinema_id;
+---------+------+---------------+-----------+-----------+--------------+------------------+--------------+
| room_id | name | number_places | cinema_id | cinema_id | name         | city             | number_rooms |
+---------+------+---------------+-----------+-----------+--------------+------------------+--------------+
|       1 | A    |           100 |         3 |         3 | CGR CINÉMAS  | Bordeaux         |           10 |
|       2 | B    |            60 |         3 |         3 | CGR CINÉMAS  | Bordeaux         |           10 |
|       3 | C    |            70 |         3 |         3 | CGR CINÉMAS  | Bordeaux         |           10 |
      ......
      ........
       89 | C    |            45 |        18 |        18 | MÉGARAMA     | Audincourt       |            4 |
|      90 | D    |            45 |        18 |        18 | MÉGARAMA     | Audincourt       |            4 |
+---------+------+---------------+-----------+-----------+--------------+------------------+--------------+
72 rows in set (0.002 sec)

on peut affiner nos requettes :
ex on peut prendre toutes les lignes de la table room mais uniquement les colonnes de nom et de ville.

MariaDB [udemy]> select r.*, c.name, c.city from room as r inner join cinema as c on r.cinema_id = c.cinema_id limit 3;
+---------+------+---------------+-----------+--------------+----------+
| room_id | name | number_places | cinema_id | name         | city     |
+---------+------+---------------+-----------+--------------+----------+
|       1 | A    |           100 |         3 | CGR CINÉMAS  | Bordeaux |
|       2 | B    |            60 |         3 | CGR CINÉMAS  | Bordeaux |
|       3 | C    |            70 |         3 | CGR CINÉMAS  | Bordeaux |
+---------+------+---------------+-----------+--------------+----------+
3 rows in set (0.001 sec)

MariaDB [udemy]>

- left join :


MariaDB [udemy]> desc language;
+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+-------------+--------------+------+-----+---------+----------------+
| language_id | int(11)      | NO   | PRI | NULL    | auto_increment |
| name        | varchar(255) | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+
2 rows in set (0.002 sec)

MariaDB [udemy]> select * from language limit 2;
+-------------+---------+
| language_id | name    |
+-------------+---------+
|           1 | English |
|           2 | French  |
+-------------+---------+
2 rows in set (0.002 sec)

MariaDB [udemy]> desc film;
+----------------------+--------------+------+-----+---------+----------------+
| Field                | Type         | Null | Key | Default | Extra          |
+----------------------+--------------+------+-----+---------+----------------+
| film_id              | int(11)      | NO   | PRI | NULL    | auto_increment |
| name                 | varchar(255) | NO   |     | NULL    |                |
| distributor          | varchar(255) | NO   |     | NULL    |                |
| running_time         | int(11)      | NO   |     | NULL    |                |
| budget               | int(11)      | NO   |     | NULL    |                |
| language_id          | int(11)      | NO   |     | NULL    |                |
| original_language_id | int(11)      | NO   |     | NULL    |                |
+----------------------+--------------+------+-----+---------+----------------+
7 rows in set (0.003 sec)

MariaDB [udemy]> select * from film limit 2;
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
| film_id | name           | distributor                   | running_time | budget   | language_id | original_language_id |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
|       1 | Forrest Gump   | United International Pictures |          140 | 55000000 |           2 |                    1 |
|       2 | La Ligne verte | United International Pictures |          189 | 60000000 |           2 |                    1 |
+---------+----------------+-------------------------------+--------------+----------+-------------+----------------------+
2 rows in set (0.001 sec)



MariaDB [udemy]> select * from language as l left join film as f on l.language_id = f.language_id;
+-------------+------------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| language_id | name       | film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+-------------+------------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|           2 | French     |       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|           2 | French     |       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|           2 | French     |       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|           2 | French     |       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|           2 | French     |       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|           2 | French     |       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|           2 | French     |       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|           2 | French     |       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|           2 | French     |       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|           2 | French     |      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
|           1 | English    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           3 | Arabic     |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           4 | Spanish    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           5 | Portuguese |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           6 | Russian    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           7 | German     |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           8 | Italian    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|           9 | Japanese   |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|          10 | Chinese    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|          11 | Korean     |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|          12 | Persian    |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
|          13 | Vietnamese |    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |
+-------------+------------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
22 rows in set (0.001 sec)

on voit ici qu'on a enormement de valeur à null : on a pas de correspondance de film ayant le language de la table language.

- right join :

on reprend l'exemple des deux tables précédentes mais on fait maintenant une requette en right join : on commence donc la requette par la table film puis language : 

MariaDB [udemy]> select * from film as f right join language as l on f.language_id = l.language_id ;
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+-------------+------------+
| film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id | language_id | name       |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+-------------+------------+
|       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |           2 | French     |
|       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |           2 | French     |
|       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |           2 | French     |
|       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |           2 | French     |
|       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |           2 | French     |
|       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |           2 | French     |
|       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |           2 | French     |
|       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |           2 | French     |
|       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |           2 | French     |
|      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |           2 | French     |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           1 | English    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           3 | Arabic     |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           4 | Spanish    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           5 | Portuguese |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           6 | Russian    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           7 | German     |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           8 | Italian    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |           9 | Japanese   |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |          10 | Chinese    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |          11 | Korean     |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |          12 | Persian    |
|    NULL | NULL                  | NULL                           |         NULL |      NULL |        NULL |                 NULL |          13 | Vietnamese |
+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+-------------+------------+
22 rows in set (0.007 sec)

si on garde l'ordre des tables de la requette en left join on a :

MariaDB [udemy]> select * from language as l right join film as f  on f.language_id = l.language_id ;
+-------------+--------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
| language_id | name   | film_id | name                  | distributor                    | running_time | budget    | language_id | original_language_id |
+-------------+--------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
|           2 | French |       1 | Forrest Gump          | United International Pictures  |          140 |  55000000 |           2 |                    1 |
|           2 | French |       2 | La Ligne verte        | United International Pictures  |          189 |  60000000 |           2 |                    1 |
|           2 | French |       3 | Your Name             | Eurozoom                       |          109 |         0 |           2 |                    9 |
|           2 | French |       4 | Lion                  | SDN                            |          118 |         0 |           2 |                    1 |
|           2 | French |       5 | Tu ne tueras point    | Metropolitan FilmExport        |          140 |  40000000 |           2 |                    1 |
|           2 | French |       6 | La Liste de Schindler | United International Pictures  |          195 |  25000000 |           2 |                    1 |
|           2 | French |       7 | Django Unchained      | Sony Pictures Releasing France |          164 | 100000000 |           2 |                    1 |
|           2 | French |       8 | Le Parrain            | Paramount Pictures             |          175 |   6000000 |           2 |                    1 |
|           2 | French |       9 | 12 hommes en colère   | Carlotta Films                 |           95 |    340000 |           2 |                    1 |
|           2 | French |      10 | Gran Torino           | Warner Bros. France            |          111 |  33000000 |           2 |                    1 |
+-------------+--------+---------+-----------------------+--------------------------------+--------------+-----------+-------------+----------------------+
10 rows in set (0.000 sec)



= jointures suite :

natural join, cross join , self join


- natural join : va détecter automatiquement les données qui seront identiques pour les deux tables : pas besoin de passer par le mot clé "on" :

attention il faudra que le nom et le type des colonnes soit identique dans les deux tables ( on fait ca à la creation de la table.) 

select * from table1 natural join table2 = select * from table1 inner join table2 on table1.colonne = table2.colonne

- cross join :
rarement utilisé : il va permettre de créer tous les couples possibles entre deux tables sur des colonnes précises.

select * from table1 cross join table2 

seconde ecriture :
select * from table1, table2

- self join :

n'est pas un mot clé et ne sera donc jamais ecrit comme tel.
une table peut se joindre à elle même.
cela peut etre fait en definissant des alias au sein de la même table et en utilsant des joitures de type cross join, inner join, left join par exemple.

ex : 

natural join :



MariaDB [udemy]> desc diffusion;
+--------------+----------+------+-----+---------+----------------+
| Field        | Type     | Null | Key | Default | Extra          |
+--------------+----------+------+-----+---------+----------------+
| diffusion_id | int(11)  | NO   | PRI | NULL    | auto_increment |
| datetime     | datetime | NO   |     | NULL    |                |
| cinema_id    | int(11)  | NO   |     | NULL    |                |
| room_id      | int(11)  | NO   |     | NULL    |                |
| film_id      | int(11)  | NO   |     | NULL    |                |
+--------------+----------+------+-----+---------+----------------+
5 rows in set (0.005 sec)

MariaDB [udemy]> desc cinema;
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| cinema_id    | int(11)      | NO   | PRI | NULL    | auto_increment |
| name         | varchar(255) | NO   |     | NULL    |                |
| city         | varchar(255) | NO   |     | NULL    |                |
| number_rooms | int(11)      | NO   |     | NULL    |                |
+--------------+--------------+------+-----+---------+----------------+
4 rows in set (0.002 sec)

+-----------+--------------+---------------------+---------+---------+--------------+----------+--------------+
| cinema_id | diffusion_id | datetime            | room_id | film_id | name         | city     | number_rooms |
+-----------+--------------+---------------------+---------+---------+--------------+----------+--------------+
|         3 |            1 | 2017-10-01 11:30:00 |       1 |       3 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            2 | 2017-10-01 12:00:00 |       2 |       4 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            3 | 2017-10-01 12:30:00 |       3 |       9 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            4 | 2017-10-01 13:00:00 |       4 |       8 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            5 | 2017-10-01 13:30:00 |       5 |       6 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            6 | 2017-10-01 14:00:00 |       6 |      10 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            7 | 2017-10-01 14:30:00 |       7 |       5 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            8 | 2017-10-01 15:00:00 |       8 |       1 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |            9 | 2017-10-01 15:30:00 |       9 |       2 | CGR CINÉMAS  | Bordeaux |           10 |
|         3 |           10 | 2017-10-01 16:00:00 |      10 |       7 | CGR CINÉMAS  | Bordeaux |           10 |
+-----------+--------------+---------------------+---------+---------+--------------+----------+--------------+
10 rows in set (0.001 sec)

MariaDB [udemy]> 





