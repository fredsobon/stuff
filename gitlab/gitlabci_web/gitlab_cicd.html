<!DOCTYPE html>
<html class="" lang="en">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="object" property="og:type">
<meta content="GitLab" property="og:site_name">
<meta content="Readme · Yaml · Ci · Help" property="og:title">
<meta content="GitLab Community Edition" property="og:description">
<meta content="https://gitlab.meetic.ilius.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" property="og:image">
<meta content="64" property="og:image:width">
<meta content="64" property="og:image:height">
<meta content="https://gitlab.meetic.ilius.net/help/ci/yaml/README" property="og:url">
<meta content="summary" property="twitter:card">
<meta content="Readme · Yaml · Ci · Help" property="twitter:title">
<meta content="GitLab Community Edition" property="twitter:description">
<meta content="https://gitlab.meetic.ilius.net/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png" property="twitter:image">

<title>Readme · Yaml · Ci · Help · GitLab</title>
<meta content="GitLab Community Edition" name="description">
<link rel="shortcut icon" type="image/png" href="/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" id="favicon" data-original-href="/assets/favicon-7901bd695fb93edb07975966062049829afb56cf11511236e61bcf425070e36e.png" />
<link rel="stylesheet" media="all" href="/assets/application-def1880ada798c68ee010ba2193f53a2c65a8981871a634ae7e18ccdcd503fa3.css" />
<link rel="stylesheet" media="print" href="/assets/print-74c3df10dad473d66660c828e3aa54ca3bfeac6d8bb708643331403fe7211e60.css" />


<link rel="stylesheet" media="all" href="/assets/highlight/themes/white-3144068cf4f603d290f553b653926358ddcd02493b9728f62417682657fc58c0.css" />
<script>
//<![CDATA[
window.gon={};gon.api_version="v4";gon.default_avatar_url="https://gitlab.meetic.ilius.net/assets/no_avatar-849f9c04a3a0d0cea2424ae97b27447dc64a7dbfae83c036c45b403392f0e8ba.png";gon.max_file_size=10;gon.asset_host=null;gon.webpack_public_path="/assets/webpack/";gon.relative_url_root="";gon.shortcuts_path="/help/shortcuts";gon.user_color_scheme="white";gon.gitlab_url="https://gitlab.meetic.ilius.net";gon.revision="2417d5becc7";gon.gitlab_logo="/assets/gitlab_logo-7ae504fe4f68fdebb3c2034e36621930cd36ea87924c11ff65dbcb8ed50dca58.png";gon.sprite_icons="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg";gon.sprite_file_icons="/assets/file_icons-7262fc6897e02f1ceaf8de43dc33afa5e4f9a2067f4f68ef77dcc87946575e9e.svg";gon.emoji_sprites_css_path="/assets/emoji_sprites-289eccffb1183c188b630297431be837765d9ff4aed6130cf738586fb307c170.css";gon.test_env=false;gon.suggested_label_colors={"#0033CC":"UA blue","#428BCA":"Moderate blue","#44AD8E":"Lime green","#A8D695":"Feijoa","#5CB85C":"Slightly desaturated green","#69D100":"Bright green","#004E00":"Very dark lime green","#34495E":"Very dark desaturated blue","#7F8C8D":"Dark grayish cyan","#A295D6":"Slightly desaturated blue","#5843AD":"Dark moderate blue","#8E44AD":"Dark moderate violet","#FFECDB":"Very pale orange","#AD4363":"Dark moderate pink","#D10069":"Strong pink","#CC0033":"Strong red","#FF0000":"Pure red","#D9534F":"Soft red","#D1D100":"Strong yellow","#F0AD4E":"Soft orange","#AD8D43":"Dark moderate orange"};gon.first_day_of_week=0;gon.ee=false;
//]]>
</script>


<script src="/assets/webpack/runtime.15f5b13a.bundle.js" defer="defer"></script>
<script src="/assets/webpack/main.f8ac0dda.chunk.js" defer="defer"></script>
<script src="/assets/webpack/pages.help.show.8df4d2fd.chunk.js" defer="defer"></script>

<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="6rjhqlUtxY4Gb0VtktALnVspzgJREYkUFQTqcYwvnYpfmAvs8Dv2S72hg/Uij3hXC9lybQeHFGQjPYxiE0eT6Q==" />

<meta content="origin-when-cross-origin" name="referrer">
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
<meta content="#474D57" name="theme-color">
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/touch-icon-iphone-5a9cee0e8a51212e70b90c87c12f382c428870c0ff67d1eb034d884b78d2dae7.png" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/touch-icon-ipad-a6eec6aeb9da138e507593b464fdac213047e49d3093fc30e90d9a995df83ba3.png" sizes="76x76" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/touch-icon-iphone-retina-72e2aadf86513a56e050e7f0f2355deaa19cc17ed97bbe5147847f2748e5a3e3.png" sizes="120x120" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/touch-icon-ipad-retina-8ebe416f5313483d9c1bc772b5bbe03ecad52a54eba443e5215a22caed2a16a2.png" sizes="152x152" />
<link color="rgb(226, 67, 41)" href="/assets/logo-d36b5212042cebc89b96df4bf6ac24e43db316143e89926c0db839ff694d2de4.svg" rel="mask-icon">
<meta content="/assets/msapplication-tile-1196ec67452f618d39cdd85e2e3a542f76574c071051ae7effbfde01710eb17d.png" name="msapplication-TileImage">
<meta content="#30353E" name="msapplication-TileColor">




</head>

<body class="ui-indigo  gl-browser-generic gl-platform-other" data-group="" data-page="help:show" data-project="">

<script>
//<![CDATA[
gl = window.gl || {};
gl.client = {"isGeneric":true,"isOther":true};


//]]>
</script>


<header class="navbar navbar-gitlab navbar-expand-sm js-navbar" data-qa-selector="navbar">
<a class="sr-only gl-accessibility" href="#content-body" tabindex="1">Skip to content</a>
<div class="container-fluid">
<div class="header-content">
<div class="title-container">
<h1 class="title">
<a title="Dashboard" id="logo" href="/"><svg width="24" height="24" class="tanuki-logo" viewBox="0 0 36 36">
  <path class="tanuki-shape tanuki-left-ear" fill="#e24329" d="M2 14l9.38 9v-9l-4-12.28c-.205-.632-1.176-.632-1.38 0z"/>
  <path class="tanuki-shape tanuki-right-ear" fill="#e24329" d="M34 14l-9.38 9v-9l4-12.28c.205-.632 1.176-.632 1.38 0z"/>
  <path class="tanuki-shape tanuki-nose" fill="#e24329" d="M18,34.38 3,14 33,14 Z"/>
  <path class="tanuki-shape tanuki-left-eye" fill="#fc6d26" d="M18,34.38 11.38,14 2,14 6,25Z"/>
  <path class="tanuki-shape tanuki-right-eye" fill="#fc6d26" d="M18,34.38 24.62,14 34,14 30,25Z"/>
  <path class="tanuki-shape tanuki-left-cheek" fill="#fca326" d="M2 14L.1 20.16c-.18.565 0 1.2.5 1.56l17.42 12.66z"/>
  <path class="tanuki-shape tanuki-right-cheek" fill="#fca326" d="M34 14l1.9 6.16c.18.565 0 1.2-.5 1.56L18 34.38z"/>
</svg>

<span class="logo-text d-none d-lg-block prepend-left-8">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 617 169"><path d="M315.26 2.97h-21.8l.1 162.5h88.3v-20.1h-66.5l-.1-142.4M465.89 136.95c-5.5 5.7-14.6 11.4-27 11.4-16.6 0-23.3-8.2-23.3-18.9 0-16.1 11.2-23.8 35-23.8 4.5 0 11.7.5 15.4 1.2v30.1h-.1m-22.6-98.5c-17.6 0-33.8 6.2-46.4 16.7l7.7 13.4c8.9-5.2 19.8-10.4 35.5-10.4 17.9 0 25.8 9.2 25.8 24.6v7.9c-3.5-.7-10.7-1.2-15.1-1.2-38.2 0-57.6 13.4-57.6 41.4 0 25.1 15.4 37.7 38.7 37.7 15.7 0 30.8-7.2 36-18.9l4 15.9h15.4v-83.2c-.1-26.3-11.5-43.9-44-43.9M557.63 149.1c-8.2 0-15.4-1-20.8-3.5V70.5c7.4-6.2 16.6-10.7 28.3-10.7 21.1 0 29.2 14.9 29.2 39 0 34.2-13.1 50.3-36.7 50.3m9.2-110.6c-19.5 0-30 13.3-30 13.3v-21l-.1-27.8h-21.3l.1 158.5c10.7 4.5 25.3 6.9 41.2 6.9 40.7 0 60.3-26 60.3-70.9-.1-35.5-18.2-59-50.2-59M77.9 20.6c19.3 0 31.8 6.4 39.9 12.9l9.4-16.3C114.5 6 97.3 0 78.9 0 32.5 0 0 28.3 0 85.4c0 59.8 35.1 83.1 75.2 83.1 20.1 0 37.2-4.7 48.4-9.4l-.5-63.9V75.1H63.6v20.1h38l.5 48.5c-5 2.5-13.6 4.5-25.3 4.5-32.2 0-53.8-20.3-53.8-63-.1-43.5 22.2-64.6 54.9-64.6M231.43 2.95h-21.3l.1 27.3v94.3c0 26.3 11.4 43.9 43.9 43.9 4.5 0 8.9-.4 13.1-1.2v-19.1c-3.1.5-6.4.7-9.9.7-17.9 0-25.8-9.2-25.8-24.6v-65h35.7v-17.8h-35.7l-.1-38.5M155.96 165.47h21.3v-124h-21.3v124M155.96 24.37h21.3V3.07h-21.3v21.3"/></svg>

</span>
</a></h1>
<ul class="list-unstyled navbar-sub-nav">
<li class="home"><a title="Projects" class="dashboard-shortcuts-projects" href="/explore">Projects
</a></li><li class=""><a title="Groups" class="dashboard-shortcuts-groups" href="/explore/groups">Groups
</a></li><li class=""><a title="Snippets" class="dashboard-shortcuts-snippets" href="/explore/snippets">Snippets
</a></li><li>
<a title="About GitLab CE" href="/help">Help</a>
</li>
</ul>

</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li class="nav-item d-none d-sm-none d-md-block m-auto">
<div class="search search-form" data-track-event="activate_form_input" data-track-label="navbar_search" data-track-value="">
<form class="form-inline" action="/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" /><div class="search-input-container">
<div class="search-input-wrap">
<div class="dropdown" data-url="/search/autocomplete">
<input type="search" name="search" id="search" placeholder="Search or jump to…" class="search-input dropdown-menu-toggle no-outline js-search-dashboard-options" spellcheck="false" tabindex="1" autocomplete="off" data-issues-path="/dashboard/issues" data-mr-path="/dashboard/merge_requests" data-qa-selector="search_term_field" aria-label="Search or jump to…" />
<button class="hidden js-dropdown-search-toggle" data-toggle="dropdown" type="button"></button>
<div class="dropdown-menu dropdown-select js-dashboard-search-options">
<div class="dropdown-content"><ul>
<li class="dropdown-menu-empty-item">
<a>
Loading...
</a>
</li>
</ul>
</div><div class="dropdown-loading"><i aria-hidden="true" data-hidden="true" class="fa fa-spinner fa-spin"></i></div>
</div>
<svg class="s16 search-icon"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#search"></use></svg>
<svg class="s16 clear-icon js-clear-input"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#close"></use></svg>
</div>
</div>
</div>
<input type="hidden" name="group_id" id="group_id" class="js-search-group-options" />
<input type="hidden" name="project_id" id="search_project_id" value="" class="js-search-project-options" />
<input type="hidden" name="repository_ref" id="repository_ref" />
<input type="hidden" name="nav_source" id="nav_source" value="navbar" />
<div class="search-autocomplete-opts hide" data-autocomplete-path="/search/autocomplete"></div>
</form></div>

</li>
<li class="nav-item d-inline-block d-sm-none d-md-none">
<a title="Search" aria-label="Search" data-toggle="tooltip" data-placement="bottom" data-container="body" href="/search"><svg class="s16"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#search"></use></svg>
</a></li>
<li class="nav-item header-help dropdown">
<a class="header-help-dropdown-toggle" data-toggle="dropdown" href="/help"><svg class="s16"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#question"></use></svg>
<svg class="caret-down"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#angle-down"></use></svg>
</a><div class="dropdown-menu dropdown-menu-right">
<ul>
<li>
<a href="/help">Help</a>
</li>
<li>
<a href="https://about.gitlab.com/getting-help/">Support</a>
</li>

<li class="divider"></li>
<li>
<a href="https://about.gitlab.com/submit-feedback">Submit feedback</a>
</li>
<li>
<a target="_blank" class="text-nowrap" href="https://about.gitlab.com/contributing">Contribute to GitLab
</a></li>


</ul>

</div>
</li>
<li class="nav-item">
<div>
<a class="btn btn-sign-in" href="/users/sign_in?redirect_to_referer=yes">Sign in / Register</a>
</div>
</li>
</ul>
</div>
<button class="navbar-toggler d-block d-sm-none" type="button">
<span class="sr-only">Toggle navigation</span>
<svg class="s12 more-icon js-navbar-toggle-right"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#ellipsis_h"></use></svg>
<svg class="s12 close-icon js-navbar-toggle-left"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#close"></use></svg>
</button>
</div>
</div>
</header>

<div class="layout-page">
<div class="content-wrapper">

<div class="mobile-overlay"></div>
<div class="alert-wrapper">






<nav class="breadcrumbs container-fluid container-limited" role="navigation">
<div class="breadcrumbs-container">
<div class="breadcrumbs-links js-title-container">
<ul class="list-unstyled breadcrumbs-list js-breadcrumbs-list">
<li><a href="/help">Help</a><svg class="s8 breadcrumbs-list-angle"><use xlink:href="/assets/icons-4009ebf96719f129f954d643e65f87152b5e6c4a4917130c4a696beb54af9949.svg#angle-right"></use></svg></li>

<li>
<h2 class="breadcrumbs-sub-title"><a href="/help/ci/yaml/README">Help</a></h2>
</li>
</ul>
</div>

</div>
</nav>

<div class="d-flex"></div>
</div>
<div class="container-fluid container-limited ">
<div class="content" id="content-body">
<div class="flash-container flash-container-page sticky">
</div>

<div class="documentation md prepend-top-default">
<h1 data-sourcepos="1:1-1:47" dir="auto">&#x000A;<a id="user-content-gitlab-cicd-pipeline-configuration-reference" class="anchor" href="#gitlab-cicd-pipeline-configuration-reference" aria-hidden="true"></a>GitLab CI/CD Pipeline Configuration Reference</h1>&#x000A;<p data-sourcepos="3:1-3:119" dir="auto">GitLab CI/CD <a href="../pipelines.md">pipelines</a> are configured using a YAML file called <code>.gitlab-ci.yml</code> within each project.</p>&#x000A;<p data-sourcepos="5:1-5:90" dir="auto">The <code>.gitlab-ci.yml</code> file defines the structure and order of the pipelines and determines:</p>&#x000A;<ul data-sourcepos="7:1-9:0" dir="auto">&#x000A;<li data-sourcepos="7:1-7:73">What to execute using <a href="https://docs.gitlab.com/runner/" rel="nofollow noreferrer noopener" target="_blank">GitLab Runner</a>.</li>&#x000A;<li data-sourcepos="8:1-9:0">What decisions to make when specific conditions are encountered. For example, when a process succeeds or fails.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="10:1-10:95" dir="auto">This topic covers CI/CD pipeline configuration. For other CI/CD configuration information, see:</p>&#x000A;<ul data-sourcepos="12:1-14:0" dir="auto">&#x000A;<li data-sourcepos="12:1-12:105">&#x000A;<a href="../variables/README.md">GitLab CI/CD Variables</a>, for configuring the environment the pipelines run in.</li>&#x000A;<li data-sourcepos="13:1-14:0">&#x000A;<a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html" rel="nofollow noreferrer noopener" target="_blank">GitLab Runner advanced configuration</a>, for configuring GitLab Runner.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="15:1-15:51" dir="auto">We have complete examples of configuring pipelines:</p>&#x000A;<ul data-sourcepos="17:1-20:0" dir="auto">&#x000A;<li data-sourcepos="17:1-17:98">For a quick introduction to GitLab CI, follow our <a href="../quick_start/README.md">quick start guide</a>.</li>&#x000A;<li data-sourcepos="18:1-18:83">For a collection of examples, see <a href="../examples/README.md">GitLab CI/CD Examples</a>.</li>&#x000A;<li data-sourcepos="19:1-20:0">To see a large <code>.gitlab-ci.yml</code> file used in an enterprise, see the <a href="https://gitlab.com/gitlab-org/gitlab-foss/blob/master/.gitlab-ci.yml" rel="nofollow noreferrer noopener" target="_blank"><code>.gitlab-ci.yml</code> file for <code>gitlab-ce</code></a>.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="21:1-24:97" dir="auto">NOTE: <strong>Note:</strong>&#x000A;If you have a <a href="../../workflow/repository_mirroring.md#pulling-from-a-remote-repository-starter">mirrored repository where GitLab pulls from</a>,&#x000A;you may need to enable pipeline triggering in your project's&#x000A;<strong>Settings &gt; Repository &gt; Pull from a remote repository &gt; Trigger pipelines for mirror updates</strong>.</p>&#x000A;<h2 data-sourcepos="26:1-26:15" dir="auto">&#x000A;<a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"></a>Introduction</h2>&#x000A;<p data-sourcepos="28:1-28:106" dir="auto">Pipeline configuration begins with jobs. Jobs are the most fundamental element of a <code>.gitlab-ci.yml</code> file.</p>&#x000A;<p data-sourcepos="30:1-30:9" dir="auto">Jobs are:</p>&#x000A;<ul data-sourcepos="32:1-35:0" dir="auto">&#x000A;<li data-sourcepos="32:1-32:81">Defined with constraints stating under what conditions they should be executed.</li>&#x000A;<li data-sourcepos="33:1-33:101">Top-level elements with an arbitrary name and must contain at least the <a href="#script"><code>script</code></a> clause.</li>&#x000A;<li data-sourcepos="34:1-35:0">Not limited in how many can be defined.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="36:1-36:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job1</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">execute-script-for-job1"</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">job2</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">execute-script-for-job2"</span></span></code></pre>&#x000A;<p data-sourcepos="46:1-49:46" dir="auto">The above example is the simplest possible CI/CD configuration with two separate&#x000A;jobs, where each of the jobs executes a different command.&#x000A;Of course a command can execute code directly (<code>./configure;make;make install</code>)&#x000A;or run a script (<code>test.sh</code>) in the repository.</p>&#x000A;<p data-sourcepos="51:1-53:30" dir="auto">Jobs are picked up by <a href="../runners/README.md">Runners</a> and executed within the&#x000A;environment of the Runner. What is important, is that each job is run&#x000A;independently from each other.</p>&#x000A;<h3 data-sourcepos="55:1-55:31" dir="auto">&#x000A;<a id="user-content-validate-the-gitlab-ciyml" class="anchor" href="#validate-the-gitlab-ciyml" aria-hidden="true"></a>Validate the .gitlab-ci.yml</h3>&#x000A;<p data-sourcepos="57:1-59:94" dir="auto">Each instance of GitLab CI has an embedded debug tool called Lint, which validates the&#x000A;content of your <code>.gitlab-ci.yml</code> files. You can find the Lint under the page <code>ci/lint</code> of your&#x000A;project namespace. For example, <code>https://gitlab.example.com/gitlab-org/project-123/-/ci/lint</code>.</p>&#x000A;<h3 data-sourcepos="61:1-61:30" dir="auto">&#x000A;<a id="user-content-unavailable-names-for-jobs" class="anchor" href="#unavailable-names-for-jobs" aria-hidden="true"></a>Unavailable names for jobs</h3>&#x000A;<p data-sourcepos="63:1-64:30" dir="auto">Each job must have a unique name, but there are a few <strong>reserved <code>keywords</code> that&#x000A;cannot be used as job names</strong>:</p>&#x000A;<ul data-sourcepos="66:1-74:0" dir="auto">&#x000A;<li data-sourcepos="66:1-66:9"><code>image</code></li>&#x000A;<li data-sourcepos="67:1-67:12"><code>services</code></li>&#x000A;<li data-sourcepos="68:1-68:10"><code>stages</code></li>&#x000A;<li data-sourcepos="69:1-69:9"><code>types</code></li>&#x000A;<li data-sourcepos="70:1-70:17"><code>before_script</code></li>&#x000A;<li data-sourcepos="71:1-71:16"><code>after_script</code></li>&#x000A;<li data-sourcepos="72:1-72:13"><code>variables</code></li>&#x000A;<li data-sourcepos="73:1-74:0"><code>cache</code></li>&#x000A;</ul>&#x000A;<h3 data-sourcepos="75:1-75:27" dir="auto">&#x000A;<a id="user-content-using-reserved-keywords" class="anchor" href="#using-reserved-keywords" aria-hidden="true"></a>Using reserved keywords</h3>&#x000A;<p data-sourcepos="77:1-77:96" dir="auto">If you get validation error when using specific values (for example, <code>true</code> or <code>false</code>), try to:</p>&#x000A;<ul data-sourcepos="79:1-81:0" dir="auto">&#x000A;<li data-sourcepos="79:1-79:13">Quote them.</li>&#x000A;<li data-sourcepos="80:1-81:0">Change them to a different form. For example, <code>/bin/true</code>.</li>&#x000A;</ul>&#x000A;<h2 data-sourcepos="82:1-82:27" dir="auto">&#x000A;<a id="user-content-configuration-parameters" class="anchor" href="#configuration-parameters" aria-hidden="true"></a>Configuration parameters</h2>&#x000A;<p data-sourcepos="84:1-84:72" dir="auto">A job is defined as a list of parameters that define the job's behavior.</p>&#x000A;<p data-sourcepos="86:1-86:56" dir="auto">The following table lists available parameters for jobs:</p>&#x000A;<table data-sourcepos="88:1-116:623" dir="auto">&#x000A;<thead>&#x000A;<tr data-sourcepos="88:1-88:624">&#x000A;<th align="left" data-sourcepos="88:2-88:53">Keyword</th>&#x000A;<th align="left" data-sourcepos="88:55-88:623">Description</th>&#x000A;</tr>&#x000A;</thead>&#x000A;<tbody>&#x000A;<tr data-sourcepos="90:1-90:624">&#x000A;<td align="left" data-sourcepos="90:2-90:53"><a href="#script"><code>script</code></a></td>&#x000A;<td align="left" data-sourcepos="90:55-90:623">Shell script which is executed by Runner.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="91:1-91:624">&#x000A;<td align="left" data-sourcepos="91:2-91:53"><a href="#image"><code>image</code></a></td>&#x000A;<td align="left" data-sourcepos="91:55-91:623">Use docker images. Also available: <code>image:name</code> and <code>image:entrypoint</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="92:1-92:624">&#x000A;<td align="left" data-sourcepos="92:2-92:53"><a href="#services"><code>services</code></a></td>&#x000A;<td align="left" data-sourcepos="92:55-92:623">Use docker services images. Also available: <code>services:name</code>, <code>services:alias</code>, <code>services:entrypoint</code>, and <code>services:command</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="93:1-93:624">&#x000A;<td align="left" data-sourcepos="93:2-93:53"><a href="#before_script-and-after_script"><code>before_script</code></a></td>&#x000A;<td align="left" data-sourcepos="93:55-93:623">Override a set of commands that are executed before job.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="94:1-94:624">&#x000A;<td align="left" data-sourcepos="94:2-94:53"><a href="#before_script-and-after_script"><code>after_script</code></a></td>&#x000A;<td align="left" data-sourcepos="94:55-94:623">Override a set of commands that are executed after job.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="95:1-95:624">&#x000A;<td align="left" data-sourcepos="95:2-95:53"><a href="#stages"><code>stages</code></a></td>&#x000A;<td align="left" data-sourcepos="95:55-95:623">Define stages in a pipeline.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="96:1-96:624">&#x000A;<td align="left" data-sourcepos="96:2-96:53"><a href="#stage"><code>stage</code></a></td>&#x000A;<td align="left" data-sourcepos="96:55-96:623">Defines a job stage (default: <code>test</code>).</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="97:1-97:624">&#x000A;<td align="left" data-sourcepos="97:2-97:53"><a href="#onlyexcept-basic"><code>only</code></a></td>&#x000A;<td align="left" data-sourcepos="97:55-97:623">Limit when jobs are created. Also available: <a href="#onlyexcept-advanced"><code>only:refs</code>, <code>only:kubernetes</code>, <code>only:variables</code>, and <code>only:changes</code></a>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="98:1-98:624">&#x000A;<td align="left" data-sourcepos="98:2-98:53"><a href="#onlyexcept-basic"><code>except</code></a></td>&#x000A;<td align="left" data-sourcepos="98:55-98:623">Limit when jobs are not created. Also available: <a href="#onlyexcept-advanced"><code>except:refs</code>, <code>except:kubernetes</code>, <code>except:variables</code>, and <code>except:changes</code></a>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="99:1-99:623">&#x000A;<td align="left" data-sourcepos="99:2-99:53"><a href="#rules"><code>rules</code></a></td>&#x000A;<td align="left" data-sourcepos="99:55-99:622">List of conditions to evaluate and determine selected attributes of a job, and whether or not it is created. May not be used alongside <code>only</code>/<code>except</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="100:1-100:624">&#x000A;<td align="left" data-sourcepos="100:2-100:53"><a href="#tags"><code>tags</code></a></td>&#x000A;<td align="left" data-sourcepos="100:55-100:623">List of tags which are used to select Runner.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="101:1-101:624">&#x000A;<td align="left" data-sourcepos="101:2-101:53"><a href="#allow_failure"><code>allow_failure</code></a></td>&#x000A;<td align="left" data-sourcepos="101:55-101:623">Allow job to fail. Failed job doesn't contribute to commit status.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="102:1-102:624">&#x000A;<td align="left" data-sourcepos="102:2-102:53"><a href="#when"><code>when</code></a></td>&#x000A;<td align="left" data-sourcepos="102:55-102:623">When to run job. Also available: <code>when:manual</code> and <code>when:delayed</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="103:1-103:624">&#x000A;<td align="left" data-sourcepos="103:2-103:53"><a href="#environment"><code>environment</code></a></td>&#x000A;<td align="left" data-sourcepos="103:55-103:623">Name of an environment to which the job deploys. Also available: <code>environment:name</code>, <code>environment:url</code>, <code>environment:on_stop</code>, and <code>environment:action</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="104:1-104:624">&#x000A;<td align="left" data-sourcepos="104:2-104:53"><a href="#cache"><code>cache</code></a></td>&#x000A;<td align="left" data-sourcepos="104:55-104:623">List of files that should be cached between subsequent runs. Also available: <code>cache:paths</code>, <code>cache:key</code>, <code>cache:untracked</code>, and <code>cache:policy</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="105:1-105:652">&#x000A;<td align="left" data-sourcepos="105:2-105:53"><a href="#artifacts"><code>artifacts</code></a></td>&#x000A;<td align="left" data-sourcepos="105:55-105:651">List of files and directories to attach to a job on success. Also available: <code>artifacts:paths</code>, <code>artifacts:name</code>, <code>artifacts:untracked</code>, <code>artifacts:when</code>, <code>artifacts:expire_in</code>, <code>artifacts:reports</code>, and <code>artifacts:reports:junit</code>.<br><br>In GitLab <a href="https://about.gitlab.com/pricing/" rel="nofollow noreferrer noopener" target="_blank">Enterprise Edition</a>, these are available: <code>artifacts:reports:codequality</code>, <code>artifacts:reports:sast</code>, <code>artifacts:reports:dependency_scanning</code>, <code>artifacts:reports:container_scanning</code>, <code>artifacts:reports:dast</code>, <code>artifacts:reports:license_management</code>, <code>artifacts:reports:performance</code> and <code>artifacts:reports:metrics</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="106:1-106:624">&#x000A;<td align="left" data-sourcepos="106:2-106:53"><a href="#dependencies"><code>dependencies</code></a></td>&#x000A;<td align="left" data-sourcepos="106:55-106:623">Other jobs that a job depends on so that you can pass artifacts between them.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="107:1-107:624">&#x000A;<td align="left" data-sourcepos="107:2-107:53"><a href="#coverage"><code>coverage</code></a></td>&#x000A;<td align="left" data-sourcepos="107:55-107:623">Code coverage settings for a given job.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="108:1-108:624">&#x000A;<td align="left" data-sourcepos="108:2-108:53"><a href="#retry"><code>retry</code></a></td>&#x000A;<td align="left" data-sourcepos="108:55-108:623">When and how many times a job can be auto-retried in case of a failure.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="109:1-109:624">&#x000A;<td align="left" data-sourcepos="109:2-109:53"><a href="#timeout"><code>timeout</code></a></td>&#x000A;<td align="left" data-sourcepos="109:55-109:623">Define a custom timeout that would take precedence over the project-wide one.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="110:1-110:624">&#x000A;<td align="left" data-sourcepos="110:2-110:53"><a href="#parallel"><code>parallel</code></a></td>&#x000A;<td align="left" data-sourcepos="110:55-110:623">How many instances of a job should be run in parallel.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="111:1-111:624">&#x000A;<td align="left" data-sourcepos="111:2-111:53"><a href="#trigger-premium"><code>trigger</code></a></td>&#x000A;<td align="left" data-sourcepos="111:55-111:623">Defines a downstream pipeline trigger.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="112:1-112:624">&#x000A;<td align="left" data-sourcepos="112:2-112:53"><a href="#include"><code>include</code></a></td>&#x000A;<td align="left" data-sourcepos="112:55-112:623">Allows this job to include external YAML files. Also available: <code>include:local</code>, <code>include:file</code>, <code>include:template</code>, and <code>include:remote</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="113:1-113:624">&#x000A;<td align="left" data-sourcepos="113:2-113:53"><a href="#extends"><code>extends</code></a></td>&#x000A;<td align="left" data-sourcepos="113:55-113:623">Configuration entries that this job is going to inherit from.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="114:1-114:624">&#x000A;<td align="left" data-sourcepos="114:2-114:53"><a href="#pages"><code>pages</code></a></td>&#x000A;<td align="left" data-sourcepos="114:55-114:623">Upload the result of a job to use with GitLab Pages.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="115:1-115:624">&#x000A;<td align="left" data-sourcepos="115:2-115:53"><a href="#variables"><code>variables</code></a></td>&#x000A;<td align="left" data-sourcepos="115:55-115:623">Define job variables on a job level.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="116:1-116:623">&#x000A;<td align="left" data-sourcepos="116:2-116:53"><a href="#interruptible">interruptible</a></td>&#x000A;<td align="left" data-sourcepos="116:55-116:622">Defines if a job can be canceled when made redundant by a newer run</td>&#x000A;</tr>&#x000A;</tbody>&#x000A;</table>&#x000A;<p data-sourcepos="118:1-119:71" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Parameters <code>types</code> and <code>type</code> are <a href="#deprecated-parameters">deprecated</a>.</p>&#x000A;<h2 data-sourcepos="121:1-121:29" dir="auto">&#x000A;<a id="user-content-setting-default-parameters" class="anchor" href="#setting-default-parameters" aria-hidden="true"></a>Setting default parameters</h2>&#x000A;<p data-sourcepos="123:1-125:14" dir="auto">Some parameters can be set globally as the default for all jobs using the&#x000A;<code>default:</code> keyword. Default parameters can then be overridden by job-specific&#x000A;configuration.</p>&#x000A;<p data-sourcepos="127:1-127:70" dir="auto">The following job parameters can be defined inside a <code>default:</code> block:</p>&#x000A;<ul data-sourcepos="129:1-134:0" dir="auto">&#x000A;<li data-sourcepos="129:1-129:19"><a href="#image"><code>image</code></a></li>&#x000A;<li data-sourcepos="130:1-130:25"><a href="#services"><code>services</code></a></li>&#x000A;<li data-sourcepos="131:1-131:52"><a href="#before_script-and-after_script"><code>before_script</code></a></li>&#x000A;<li data-sourcepos="132:1-132:51"><a href="#before_script-and-after_script"><code>after_script</code></a></li>&#x000A;<li data-sourcepos="133:1-134:0"><a href="#cache"><code>cache</code></a></li>&#x000A;</ul>&#x000A;<p data-sourcepos="135:1-136:65" dir="auto">In the following example, the <code>ruby:2.5</code> image is set as the default for all&#x000A;jobs except the <code>rspec 2.6</code> job, which uses the <code>ruby:2.6</code> image:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">default</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.5</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">bundle exec rspec</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="s">rspec 2.6</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.6</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">bundle exec rspec</span></span></code></pre>&#x000A;<h2 data-sourcepos="150:1-150:20" dir="auto">&#x000A;<a id="user-content-parameter-details" class="anchor" href="#parameter-details" aria-hidden="true"></a>Parameter details</h2>&#x000A;<p data-sourcepos="152:1-152:89" dir="auto">The following are detailed explanations for parameters used to configure CI/CD pipelines.</p>&#x000A;<h3 data-sourcepos="154:1-154:12" dir="auto">&#x000A;<a id="user-content-script" class="anchor" href="#script" aria-hidden="true"></a><code>script</code>&#x000A;</h3>&#x000A;<p data-sourcepos="156:1-157:45" dir="auto"><code>script</code> is the only required keyword that a job needs. It's a shell script&#x000A;which is executed by the Runner. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bundle</span><span class="nv"> </span><span class="s">exec</span><span class="nv"> </span><span class="s">rspec"</span></span></code></pre>&#x000A;<p data-sourcepos="164:1-164:64" dir="auto">This parameter can also contain several commands using an array:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">uname -a</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle exec rspec</span></span></code></pre>&#x000A;<p data-sourcepos="173:1-178:98" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Sometimes, <code>script</code> commands will need to be wrapped in single or double quotes.&#x000A;For example, commands that contain a colon (<code>:</code>) need to be wrapped in quotes so&#x000A;that the YAML parser knows to interpret the whole thing as a string rather than&#x000A;a "key: value" pair. Be careful when using special characters:&#x000A;<code>:</code>, <code>{</code>, <code>}</code>, <code>[</code>, <code>]</code>, <code>,</code>, <code>&amp;</code>, <code>*</code>, <code>#</code>, <code>?</code>, <code>|</code>, <code>-</code>, <code>&lt;</code>, <code>&gt;</code>, <code>=</code>, <code>!</code>, <code>%</code>, <code>@</code>, <code>`</code>.</p>&#x000A;<h3 data-sourcepos="180:1-180:11" dir="auto">&#x000A;<a id="user-content-image" class="anchor" href="#image" aria-hidden="true"></a><code>image</code>&#x000A;</h3>&#x000A;<p data-sourcepos="182:1-182:103" dir="auto">Used to specify <a href="../docker/using_docker_images.md#what-is-an-image">a Docker image</a> to use for the job.</p>&#x000A;<p data-sourcepos="184:1-184:4" dir="auto">For:</p>&#x000A;<ul data-sourcepos="186:1-188:0" dir="auto">&#x000A;<li data-sourcepos="186:1-186:164">Simple definition examples, see <a href="../docker/using_docker_images.md#define-image-and-services-from-gitlab-ciyml">Define <code>image</code> and <code>services</code> from .gitlab-ci.yml</a>.</li>&#x000A;<li data-sourcepos="187:1-188:0">Detailed usage information, refer to <a href="../docker/README.md">Docker integration</a> documentation.</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="189:1-189:17" dir="auto">&#x000A;<a id="user-content-imagename" class="anchor" href="#imagename" aria-hidden="true"></a><code>image:name</code>&#x000A;</h4>&#x000A;<p data-sourcepos="191:1-191:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="193:1-193:122" dir="auto">For more information, see <a href="../docker/using_docker_images.md#available-settings-for-image">Available settings for <code>image</code></a>.</p>&#x000A;<h4 data-sourcepos="195:1-195:23" dir="auto">&#x000A;<a id="user-content-imageentrypoint" class="anchor" href="#imageentrypoint" aria-hidden="true"></a><code>image:entrypoint</code>&#x000A;</h4>&#x000A;<p data-sourcepos="197:1-197:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="199:1-199:122" dir="auto">For more information, see <a href="../docker/using_docker_images.md#available-settings-for-image">Available settings for <code>image</code></a>.</p>&#x000A;<h3 data-sourcepos="201:1-201:14" dir="auto">&#x000A;<a id="user-content-services" class="anchor" href="#services" aria-hidden="true"></a><code>services</code>&#x000A;</h3>&#x000A;<p data-sourcepos="203:1-203:148" dir="auto">Used to specify a <a href="../docker/using_docker_images.md#what-is-a-service">service Docker image</a>, linked to a base image specified in <a href="#image"><code>image</code></a>.</p>&#x000A;<p data-sourcepos="205:1-205:4" dir="auto">For:</p>&#x000A;<ul data-sourcepos="207:1-210:0" dir="auto">&#x000A;<li data-sourcepos="207:1-207:164">Simple definition examples, see <a href="../docker/using_docker_images.md#define-image-and-services-from-gitlab-ciyml">Define <code>image</code> and <code>services</code> from .gitlab-ci.yml</a>.</li>&#x000A;<li data-sourcepos="208:1-208:95">Detailed usage information, refer to <a href="../docker/README.md">Docker integration</a> documentation.</li>&#x000A;<li data-sourcepos="209:1-210:0">For example services, see <a href="../services/README.md">GitLab CI Services</a>.</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="211:1-211:20" dir="auto">&#x000A;<a id="user-content-servicesname" class="anchor" href="#servicesname" aria-hidden="true"></a><code>services:name</code>&#x000A;</h4>&#x000A;<p data-sourcepos="213:1-213:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="215:1-215:132" dir="auto">For more information, see see <a href="../docker/using_docker_images.md#available-settings-for-services">Available settings for <code>services</code></a>.</p>&#x000A;<h4 data-sourcepos="217:1-217:21" dir="auto">&#x000A;<a id="user-content-servicesalias" class="anchor" href="#servicesalias" aria-hidden="true"></a><code>services:alias</code>&#x000A;</h4>&#x000A;<p data-sourcepos="219:1-219:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="221:1-221:132" dir="auto">For more information, see see <a href="../docker/using_docker_images.md#available-settings-for-services">Available settings for <code>services</code></a>.</p>&#x000A;<h4 data-sourcepos="223:1-223:26" dir="auto">&#x000A;<a id="user-content-servicesentrypoint" class="anchor" href="#servicesentrypoint" aria-hidden="true"></a><code>services:entrypoint</code>&#x000A;</h4>&#x000A;<p data-sourcepos="225:1-225:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="227:1-227:132" dir="auto">For more information, see see <a href="../docker/using_docker_images.md#available-settings-for-services">Available settings for <code>services</code></a>.</p>&#x000A;<h4 data-sourcepos="229:1-229:23" dir="auto">&#x000A;<a id="user-content-servicescommand" class="anchor" href="#servicescommand" aria-hidden="true"></a><code>services:command</code>&#x000A;</h4>&#x000A;<p data-sourcepos="231:1-231:114" dir="auto">An <a href="../docker/using_docker_images.md#extended-docker-configuration-options">extended docker configuration option</a>.</p>&#x000A;<p data-sourcepos="233:1-233:132" dir="auto">For more information, see see <a href="../docker/using_docker_images.md#available-settings-for-services">Available settings for <code>services</code></a>.</p>&#x000A;<h3 data-sourcepos="235:1-235:38" dir="auto">&#x000A;<a id="user-content-before_script-and-after_script" class="anchor" href="#before_script-and-after_script" aria-hidden="true"></a><code>before_script</code> and <code>after_script</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="237:1-237:59" dir="auto">&#x000A;<p data-sourcepos="237:3-237:59">Introduced in GitLab 8.7 and requires GitLab Runner v1.2.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="239:1-241:44" dir="auto"><code>before_script</code> is used to define the command that should be run before all&#x000A;jobs, including deploy jobs, but after the restoration of <a href="#artifacts">artifacts</a>.&#x000A;This can be an array or a multi-line string.</p>&#x000A;<p data-sourcepos="243:1-244:76" dir="auto"><code>after_script</code> is used to define the command that will be run after all&#x000A;jobs, including failed ones. This has to be an array or a multi-line string.</p>&#x000A;<p data-sourcepos="246:1-246:41" dir="auto">Scripts specified in <code>before_script</code> are:</p>&#x000A;<ul data-sourcepos="248:1-253:0" dir="auto">&#x000A;<li data-sourcepos="248:1-250:45">Concatenated with scripts specified in the main <code>script</code>. Job-level&#x000A;<code>before_script</code> definition override global-level <code>before_script</code> definition&#x000A;when concatenated with <code>script</code> definition.</li>&#x000A;<li data-sourcepos="251:1-253:0">Executed together with main <code>script</code> script as one script in a single shell&#x000A;context.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="254:1-254:36" dir="auto">Scripts specified in <code>after_script</code>:</p>&#x000A;<ul data-sourcepos="256:1-265:0" dir="auto">&#x000A;<li data-sourcepos="256:1-256:59">Have a current working directory set back to the default.</li>&#x000A;<li data-sourcepos="257:1-258:10">Are executed in a shell context separated from <code>before_script</code> and <code>script</code>&#x000A;scripts.</li>&#x000A;<li data-sourcepos="259:1-265:0">Because of separated context, cannot see changes done by scripts defined&#x000A;in <code>before_script</code> or <code>script</code> scripts, either:&#x000A;<ul data-sourcepos="261:3-265:0">&#x000A;<li data-sourcepos="261:3-262:12">In shell. For example, command aliases and variables exported in <code>script</code>&#x000A;scripts.</li>&#x000A;<li data-sourcepos="263:3-265:0">Outside of the working tree (depending on the Runner executor). For example,&#x000A;software installed by a <code>before_script</code> or <code>script</code> scripts.</li>&#x000A;</ul>&#x000A;</li>&#x000A;</ul>&#x000A;<p data-sourcepos="266:1-267:22" dir="auto">It's possible to overwrite the globally defined <code>before_script</code> and <code>after_script</code>&#x000A;if you set it per-job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">default</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">before_script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">global before script</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">before_script</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">execute this instead of global before script</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">my command</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">after_script</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">execute this after my script</span></span></code></pre>&#x000A;<h3 data-sourcepos="283:1-283:12" dir="auto">&#x000A;<a id="user-content-stages" class="anchor" href="#stages" aria-hidden="true"></a><code>stages</code>&#x000A;</h3>&#x000A;<p data-sourcepos="285:1-286:9" dir="auto"><code>stages</code> is used to define stages that can be used by jobs and is defined&#x000A;globally.</p>&#x000A;<p data-sourcepos="288:1-289:77" dir="auto">The specification of <code>stages</code> allows for having flexible multi stage pipelines.&#x000A;The ordering of elements in <code>stages</code> defines the ordering of jobs' execution:</p>&#x000A;<ol data-sourcepos="291:1-294:0" dir="auto">&#x000A;<li data-sourcepos="291:1-291:46">Jobs of the same stage are run in parallel.</li>&#x000A;<li data-sourcepos="292:1-294:0">Jobs of the next stage are run after the jobs from the previous stage&#x000A;complete successfully.</li>&#x000A;</ol>&#x000A;<p data-sourcepos="295:1-295:61" dir="auto">Let's consider the following example, which defines 3 stages:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">test</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">deploy</span></span></code></pre>&#x000A;<ol data-sourcepos="304:1-310:0" dir="auto">&#x000A;<li data-sourcepos="304:1-304:55">First, all jobs of <code>build</code> are executed in parallel.</li>&#x000A;<li data-sourcepos="305:1-305:76">If all jobs of <code>build</code> succeed, the <code>test</code> jobs are executed in parallel.</li>&#x000A;<li data-sourcepos="306:1-306:77">If all jobs of <code>test</code> succeed, the <code>deploy</code> jobs are executed in parallel.</li>&#x000A;<li data-sourcepos="307:1-307:69">If all jobs of <code>deploy</code> succeed, the commit is marked as <code>passed</code>.</li>&#x000A;<li data-sourcepos="308:1-310:0">If any of the previous jobs fails, the commit is marked as <code>failed</code> and no&#x000A;jobs of further stage are executed.</li>&#x000A;</ol>&#x000A;<p data-sourcepos="311:1-311:47" dir="auto">There are also two edge cases worth mentioning:</p>&#x000A;<ol data-sourcepos="313:1-316:0" dir="auto">&#x000A;<li data-sourcepos="313:1-314:72">If no <code>stages</code> are defined in <code>.gitlab-ci.yml</code>, then the <code>build</code>,&#x000A;<code>test</code> and <code>deploy</code> are allowed to be used as job's stage by default.</li>&#x000A;<li data-sourcepos="315:1-316:0">If a job doesn't specify a <code>stage</code>, the job is assigned the <code>test</code> stage.</li>&#x000A;</ol>&#x000A;<h3 data-sourcepos="317:1-317:11" dir="auto">&#x000A;<a id="user-content-stage" class="anchor" href="#stage" aria-hidden="true"></a><code>stage</code>&#x000A;</h3>&#x000A;<p data-sourcepos="319:1-321:105" dir="auto"><code>stage</code> is defined per-job and relies on <a href="#stages"><code>stages</code></a> which is defined&#x000A;globally. It allows to group jobs into different stages, and jobs of the same&#x000A;<code>stage</code> are executed in parallel (subject to <a href="#using-your-own-runners">certain conditions</a>). For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">test</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">deploy</span></span>&#x000A;<span id="LC5" class="line" lang="yaml"></span>&#x000A;<span id="LC6" class="line" lang="yaml"><span class="na">job 1</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make build dependencies</span></span>&#x000A;<span id="LC9" class="line" lang="yaml"></span>&#x000A;<span id="LC10" class="line" lang="yaml"><span class="na">job 2</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make build artifacts</span></span>&#x000A;<span id="LC13" class="line" lang="yaml"></span>&#x000A;<span id="LC14" class="line" lang="yaml"><span class="na">job 3</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make test</span></span>&#x000A;<span id="LC17" class="line" lang="yaml"></span>&#x000A;<span id="LC18" class="line" lang="yaml"><span class="na">job 4</span><span class="pi">:</span></span>&#x000A;<span id="LC19" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make deploy</span></span></code></pre>&#x000A;<h4 data-sourcepos="346:1-346:27" dir="auto">&#x000A;<a id="user-content-using-your-own-runners" class="anchor" href="#using-your-own-runners" aria-hidden="true"></a>Using your own Runners</h4>&#x000A;<p data-sourcepos="348:1-350:22" dir="auto">When using your own Runners, GitLab Runner runs only one job at a time by default (see the&#x000A;<code>concurrent</code> flag in <a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-global-section" rel="nofollow noreferrer noopener" target="_blank">Runner global settings</a>&#x000A;for more information).</p>&#x000A;<p data-sourcepos="352:1-352:54" dir="auto">Jobs will run on your own Runners in parallel only if:</p>&#x000A;<ul data-sourcepos="354:1-356:0" dir="auto">&#x000A;<li data-sourcepos="354:1-354:27">Run on different Runners.</li>&#x000A;<li data-sourcepos="355:1-356:0">The Runner's <code>concurrent</code> setting has been changed.</li>&#x000A;</ul>&#x000A;<h3 data-sourcepos="357:1-357:27" dir="auto">&#x000A;<a id="user-content-onlyexcept-basic" class="anchor" href="#onlyexcept-basic" aria-hidden="true"></a><code>only</code>/<code>except</code> (basic)</h3>&#x000A;<p data-sourcepos="359:1-360:17" dir="auto"><code>only</code> and <code>except</code> are two parameters that set a job policy to limit when&#x000A;jobs are created:</p>&#x000A;<ol data-sourcepos="362:1-365:0" dir="auto">&#x000A;<li data-sourcepos="362:1-362:76">&#x000A;<code>only</code> defines the names of branches and tags for which the job will run.</li>&#x000A;<li data-sourcepos="363:1-365:0">&#x000A;<code>except</code> defines the names of branches and tags for which the job will&#x000A;<strong>not</strong> run.</li>&#x000A;</ol>&#x000A;<p data-sourcepos="366:1-366:60" dir="auto">There are a few rules that apply to the usage of job policy:</p>&#x000A;<ul data-sourcepos="368:1-373:0" dir="auto">&#x000A;<li data-sourcepos="368:1-369:70">&#x000A;<code>only</code> and <code>except</code> are inclusive. If both <code>only</code> and <code>except</code> are defined&#x000A;in a job specification, the ref is filtered by <code>only</code> and <code>except</code>.</li>&#x000A;<li data-sourcepos="370:1-370:124">&#x000A;<code>only</code> and <code>except</code> allow the use of regular expressions (<a href="#supported-onlyexcept-regexp-syntax">supported regexp syntax</a>).</li>&#x000A;<li data-sourcepos="371:1-373:0">&#x000A;<code>only</code> and <code>except</code> allow to specify a repository path to filter jobs for&#x000A;forks.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="374:1-374:67" dir="auto">In addition, <code>only</code> and <code>except</code> allow the use of special keywords:</p>&#x000A;<table data-sourcepos="376:1-389:94" dir="auto">&#x000A;<thead>&#x000A;<tr data-sourcepos="376:1-376:33">&#x000A;<th data-sourcepos="376:2-376:12"><strong>Value</strong></th>&#x000A;<th data-sourcepos="376:14-376:32"><strong>Description</strong></th>&#x000A;</tr>&#x000A;</thead>&#x000A;<tbody>&#x000A;<tr data-sourcepos="378:1-378:71">&#x000A;<td data-sourcepos="378:2-378:19"><code>branches</code></td>&#x000A;<td data-sourcepos="378:21-378:70">When a git reference of a pipeline is a branch.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="379:1-379:68">&#x000A;<td data-sourcepos="379:2-379:19"><code>tags</code></td>&#x000A;<td data-sourcepos="379:21-379:67">When a git reference of a pipeline is a tag.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="380:1-380:102">&#x000A;<td data-sourcepos="380:2-380:19"><code>api</code></td>&#x000A;<td data-sourcepos="380:21-380:101">When pipeline has been triggered by a second pipelines API (not triggers API).</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="381:1-381:64">&#x000A;<td data-sourcepos="381:2-381:19"><code>external</code></td>&#x000A;<td data-sourcepos="381:21-381:63">When using CI services other than GitLab.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="382:1-382:93">&#x000A;<td data-sourcepos="382:2-382:19"><code>pipelines</code></td>&#x000A;<td data-sourcepos="382:21-382:92">For multi-project triggers, created using the API with <code>CI_JOB_TOKEN</code>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="383:1-383:73">&#x000A;<td data-sourcepos="383:2-383:19"><code>pushes</code></td>&#x000A;<td data-sourcepos="383:21-383:72">Pipeline is triggered by a <code>git push</code> by the user.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="384:1-384:60">&#x000A;<td data-sourcepos="384:2-384:19"><code>schedules</code></td>&#x000A;<td data-sourcepos="384:21-384:59">For <a href="../../user/project/pipelines/schedules.md" title="Pipelines schedules">scheduled pipelines</a>.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="385:1-385:67">&#x000A;<td data-sourcepos="385:2-385:19"><code>triggers</code></td>&#x000A;<td data-sourcepos="385:21-385:66">For pipelines created using a trigger token.</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="386:1-386:125">&#x000A;<td data-sourcepos="386:2-386:19"><code>web</code></td>&#x000A;<td data-sourcepos="386:21-386:124">For pipelines created using <strong>Run pipeline</strong> button in GitLab UI (under your project's <strong>Pipelines</strong>).</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="387:1-387:140">&#x000A;<td data-sourcepos="387:2-387:19"><code>merge_requests</code></td>&#x000A;<td data-sourcepos="387:21-387:139">When a merge request is created or updated (See <a href="../merge_request_pipelines/index.md">pipelines for merge requests</a>).</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="388:1-388:212">&#x000A;<td data-sourcepos="388:2-388:26"><code>external_pull_requests</code></td>&#x000A;<td data-sourcepos="388:28-388:211">When an external pull request on GitHub is created or updated (See <a href="../ci_cd_for_external_repos/index.md#pipelines-for-external-pull-requests">Pipelines for external pull requests</a>).</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="389:1-389:94">&#x000A;<td data-sourcepos="389:2-389:18"><code>chat</code></td>&#x000A;<td data-sourcepos="389:20-389:93">For jobs created using a <a href="../chatops/README.md">GitLab ChatOps</a> command.</td>&#x000A;</tr>&#x000A;</tbody>&#x000A;</table>&#x000A;<p data-sourcepos="391:1-392:37" dir="auto">In the example below, <code>job</code> will run only for refs that start with <code>issue-</code>,&#x000A;whereas all branches will be skipped:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="c1"># use regexp</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">/^issue-.*$/</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="c1"># use special keyword</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">branches</span></span></code></pre>&#x000A;<p data-sourcepos="404:1-405:48" dir="auto">Pattern matching is case-sensitive by default. Use <code>i</code> flag modifier, like&#x000A;<code>/pattern/i</code> to make a pattern case-insensitive:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="c1"># use regexp</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">/^issue-.*$/i</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="c1"># use special keyword</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">branches</span></span></code></pre>&#x000A;<p data-sourcepos="417:1-418:76" dir="auto">In this example, <code>job</code> will run only for refs that are tagged, or if a build is&#x000A;explicitly requested via an API trigger or a <a href="../../user/project/pipelines/schedules.md" title="Pipelines schedules">Pipeline Schedule</a>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="c1"># use special keywords</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">tags</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">triggers</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">schedules</span></span></code></pre>&#x000A;<p data-sourcepos="429:1-430:25" dir="auto">The repository path can be used to have jobs executed only for the parent&#x000A;repository and not forks:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">branches@gitlab-org/gitlab-ce</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">master@gitlab-org/gitlab-ce</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">/^release/.*$/@gitlab-org/gitlab-ce</span></span></code></pre>&#x000A;<p data-sourcepos="441:1-442:62" dir="auto">The above example will run <code>job</code> for all branches on <code>gitlab-org/gitlab-ce</code>,&#x000A;except <code>master</code> and those with names prefixed with <code>release/</code>.</p>&#x000A;<p data-sourcepos="444:1-445:58" dir="auto">If a job does not have an <code>only</code> rule, <code>only: ['branches', 'tags']</code> is set by&#x000A;default. If it doesn't have an <code>except</code> rule, it is empty.</p>&#x000A;<p data-sourcepos="447:1-447:12" dir="auto">For example,</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">echo 'test'</span></span></code></pre>&#x000A;<p data-sourcepos="454:1-454:17" dir="auto">is translated to:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">echo 'test'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">branches'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">tags'</span><span class="pi">]</span></span></code></pre>&#x000A;<h4 data-sourcepos="462:1-462:24" dir="auto">&#x000A;<a id="user-content-regular-expressions" class="anchor" href="#regular-expressions" aria-hidden="true"></a>Regular expressions</h4>&#x000A;<p data-sourcepos="464:1-466:56" dir="auto">Because <code>@</code> is used to denote the beginning of a ref's repository path,&#x000A;matching a ref name containing the <code>@</code> character in a regular expression&#x000A;requires the use of the hex character code match <code>\x40</code>.</p>&#x000A;<p data-sourcepos="468:1-469:59" dir="auto">Only the tag or branch name can be matched by a regular expression.&#x000A;The repository path, if given, is always matched literally.</p>&#x000A;<p data-sourcepos="471:1-476:25" dir="auto">If a regular expression shall be used to match the tag or branch name,&#x000A;the entire ref name part of the pattern has to be a regular expression,&#x000A;and must be surrounded by <code>/</code>.&#x000A;(With regular expression flags appended after the closing <code>/</code>.)&#x000A;So <code>issue-/.*/</code> won't work to match all tag names or branch names&#x000A;that begin with <code>issue-</code>.</p>&#x000A;<p data-sourcepos="478:1-482:70" dir="auto">TIP: <strong>Tip</strong>&#x000A;Use anchors <code>^</code> and <code>$</code> to avoid the regular expression&#x000A;matching only a substring of the tag name or branch name.&#x000A;For example, <code>/^issue-.*$/</code> is equivalent to <code>/^issue-/</code>,&#x000A;while just <code>/issue/</code> would also match a branch called <code>severe-issues</code>.</p>&#x000A;<h3 data-sourcepos="484:1-484:43" dir="auto">&#x000A;<a id="user-content-supported-onlyexcept-regexp-syntax" class="anchor" href="#supported-onlyexcept-regexp-syntax" aria-hidden="true"></a>Supported <code>only</code>/<code>except</code> regexp syntax</h3>&#x000A;<p data-sourcepos="486:1-487:65" dir="auto">CAUTION: <strong>Warning:</strong>&#x000A;This is a breaking change that was introduced with GitLab 11.9.4.</p>&#x000A;<p data-sourcepos="489:1-490:86" dir="auto">In GitLab 11.9.4, GitLab begun internally converting regexp used&#x000A;in <code>only</code> and <code>except</code> parameters to <a href="https://github.com/google/re2/wiki/Syntax" rel="nofollow noreferrer noopener" target="_blank">RE2</a>.</p>&#x000A;<p data-sourcepos="492:1-495:33" dir="auto">This means that only subset of features provided by <a href="https://ruby-doc.org/core/Regexp.html" rel="nofollow noreferrer noopener" target="_blank">Ruby Regexp</a>&#x000A;is supported. <a href="https://github.com/google/re2/wiki/Syntax" rel="nofollow noreferrer noopener" target="_blank">RE2</a> limits the set of features&#x000A;provided due to computational complexity, which means some features became unavailable in GitLab 11.9.4.&#x000A;For example, negative lookaheads.</p>&#x000A;<p data-sourcepos="497:1-499:96" dir="auto">For GitLab versions from 11.9.7 and up to GitLab 12.0, GitLab provides a feature flag that can be&#x000A;enabled by administrators that allows users to use unsafe regexp syntax. This brings compatibility&#x000A;with previously allowed syntax version and allows users to gracefully migrate to the new syntax.</p>&#x000A;<pre class="code highlight js-syntax-highlight ruby" lang="ruby" v-pre="true"><code><span id="LC1" class="line" lang="ruby"><span class="no">Feature</span><span class="p">.</span><span class="nf">enable</span><span class="p">(</span><span class="ss">:allow_unsafe_ruby_regexp</span><span class="p">)</span></span></code></pre>&#x000A;<h3 data-sourcepos="505:1-505:30" dir="auto">&#x000A;<a id="user-content-onlyexcept-advanced" class="anchor" href="#onlyexcept-advanced" aria-hidden="true"></a><code>only</code>/<code>except</code> (advanced)</h3>&#x000A;<p data-sourcepos="507:1-509:13" dir="auto">CAUTION: <strong>Warning:</strong>&#x000A;This is an <em>alpha</em> feature, and it is subject to change at any time without&#x000A;prior notice!</p>&#x000A;<p data-sourcepos="511:1-512:38" dir="auto">GitLab supports both simple and complex strategies, so it's possible to use an&#x000A;array and a hash configuration scheme.</p>&#x000A;<p data-sourcepos="514:1-514:24" dir="auto">Four keys are available:</p>&#x000A;<ul data-sourcepos="516:1-520:0" dir="auto">&#x000A;<li data-sourcepos="516:1-516:8"><code>refs</code></li>&#x000A;<li data-sourcepos="517:1-517:13"><code>variables</code></li>&#x000A;<li data-sourcepos="518:1-518:11"><code>changes</code></li>&#x000A;<li data-sourcepos="519:1-520:0"><code>kubernetes</code></li>&#x000A;</ul>&#x000A;<p data-sourcepos="521:1-522:37" dir="auto">If you use multiple keys under <code>only</code> or <code>except</code>, the keys will be evaluated as a&#x000A;single conjoined expression. That is:</p>&#x000A;<ul data-sourcepos="524:1-526:0" dir="auto">&#x000A;<li data-sourcepos="524:1-524:66">&#x000A;<code>only:</code> means "include this job if all of the conditions match".</li>&#x000A;<li data-sourcepos="525:1-526:0">&#x000A;<code>except:</code> means "exclude this job if any of the conditions match".</li>&#x000A;</ul>&#x000A;<p data-sourcepos="527:1-527:60" dir="auto">With <code>only</code>, individual keys are logically joined by an AND:</p>&#x000A;<blockquote data-sourcepos="529:1-529:89" dir="auto">&#x000A;<p data-sourcepos="529:3-529:89">(any of refs) AND (any of variables) AND (any of changes) AND (if kubernetes is active)</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="531:1-531:66" dir="auto"><code>except</code> is implemented as a negation of this complete expression:</p>&#x000A;<blockquote data-sourcepos="533:1-533:94" dir="auto">&#x000A;<p data-sourcepos="533:3-533:94">NOT((any of refs) AND (any of variables) AND (any of changes) AND (if kubernetes is active))</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="535:1-535:91" dir="auto">This, more intuitively, means the keys join by an OR. A functionally equivalent expression:</p>&#x000A;<blockquote data-sourcepos="537:1-537:86" dir="auto">&#x000A;<p data-sourcepos="537:3-537:86">(any of refs) OR (any of variables) OR (any of changes) OR (if kubernetes is active)</p>&#x000A;</blockquote>&#x000A;<h4 data-sourcepos="539:1-539:30" dir="auto">&#x000A;<a id="user-content-onlyrefsexceptrefs" class="anchor" href="#onlyrefsexceptrefs" aria-hidden="true"></a><code>only:refs</code>/<code>except:refs</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="541:1-541:42" dir="auto">&#x000A;<p data-sourcepos="541:3-541:42"><code>refs</code> policy introduced in GitLab 10.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="543:1-544:58" dir="auto">The <code>refs</code> strategy can take the same values as the&#x000A;<a href="#onlyexcept-basic">simplified only/except configuration</a>.</p>&#x000A;<p data-sourcepos="546:1-547:73" dir="auto">In the example below, the <code>deploy</code> job is going to be created only when the&#x000A;pipeline has been <a href="../../user/project/pipelines/schedules.md" title="Pipelines schedules">scheduled</a> or runs for the <code>master</code> branch:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">refs</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">master</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">schedules</span></span></code></pre>&#x000A;<h4 data-sourcepos="557:1-557:42" dir="auto">&#x000A;<a id="user-content-onlykubernetesexceptkubernetes" class="anchor" href="#onlykubernetesexceptkubernetes" aria-hidden="true"></a><code>only:kubernetes</code>/<code>except:kubernetes</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="559:1-559:48" dir="auto">&#x000A;<p data-sourcepos="559:3-559:48"><code>kubernetes</code> policy introduced in GitLab 10.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="561:1-561:60" dir="auto">The <code>kubernetes</code> strategy accepts only the <code>active</code> keyword.</p>&#x000A;<p data-sourcepos="563:1-564:44" dir="auto">In the example below, the <code>deploy</code> job is going to be created only when the&#x000A;Kubernetes service is active in the project:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">kubernetes</span><span class="pi">:</span> <span class="s">active</span></span></code></pre>&#x000A;<h4 data-sourcepos="572:1-572:40" dir="auto">&#x000A;<a id="user-content-onlyvariablesexceptvariables" class="anchor" href="#onlyvariablesexceptvariables" aria-hidden="true"></a><code>only:variables</code>/<code>except:variables</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="574:1-574:47" dir="auto">&#x000A;<p data-sourcepos="574:3-574:47"><code>variables</code> policy introduced in GitLab 10.7.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="576:1-579:67" dir="auto">The <code>variables</code> keyword is used to define variables expressions. In other words,&#x000A;you can use predefined variables / project / group or&#x000A;environment-scoped variables to define an expression GitLab is going to&#x000A;evaluate in order to decide whether a job should be created or not.</p>&#x000A;<p data-sourcepos="581:1-581:40" dir="auto">Examples of using variables expressions:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">cap staging deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">refs</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">branches</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">$RELEASE == "staging"</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">$STAGING</span></span></code></pre>&#x000A;<p data-sourcepos="594:1-594:65" dir="auto">Another use case is excluding jobs depending on a commit message:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">end-to-end</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake test:end-to-end</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">$CI_COMMIT_MESSAGE =~ /skip-end-to-end-tests/</span></span></code></pre>&#x000A;<p data-sourcepos="604:1-604:99" dir="auto">Learn more about <a href="../variables/README.md#environment-variables-expressions">variables expressions</a>.</p>&#x000A;<h4 data-sourcepos="606:1-606:36" dir="auto">&#x000A;<a id="user-content-onlychangesexceptchanges" class="anchor" href="#onlychangesexceptchanges" aria-hidden="true"></a><code>only:changes</code>/<code>except:changes</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="608:1-608:57" dir="auto">&#x000A;<p data-sourcepos="608:3-608:57"><code>changes</code> policy <a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/19232" rel="nofollow noreferrer noopener" target="_blank">introduced</a> in GitLab 11.4.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="610:1-611:68" dir="auto">Using the <code>changes</code> keyword with <code>only</code> or <code>except</code> makes it possible to define if&#x000A;a job should be created based on files modified by a git push event.</p>&#x000A;<p data-sourcepos="613:1-613:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-image:$CI_COMMIT_REF_SLUG .</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">changes</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">Dockerfile</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">docker/scripts/*</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">dockerfiles/**/*</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">more_scripts/*.{rb,py,sh}</span></span></code></pre>&#x000A;<p data-sourcepos="626:1-628:49" dir="auto">In the scenario above, when pushing multiple commits to GitLab to an existing&#x000A;branch, GitLab creates and triggers the <code>docker build</code> job, provided that one of the&#x000A;commits contains changes to any of the following:</p>&#x000A;<ul data-sourcepos="630:1-634:0" dir="auto">&#x000A;<li data-sourcepos="630:1-630:24">The <code>Dockerfile</code> file.</li>&#x000A;<li data-sourcepos="631:1-631:54">Any of the files inside <code>docker/scripts/</code> directory.</li>&#x000A;<li data-sourcepos="632:1-632:73">Any of the files and subdirectories inside the <code>dockerfiles</code> directory.</li>&#x000A;<li data-sourcepos="633:1-634:0">Any of the files with <code>rb</code>, <code>py</code>, <code>sh</code> extensions inside the <code>more_scripts</code> directory.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="635:1-635:148" dir="auto">You can also use glob patterns to match multiple files in either the root directory of the repo, or in <em>any</em> directory within the repo. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">npm run test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">changes</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s2">"</span><span class="s">*.json"</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s2">"</span><span class="s">**/*.sql"</span></span></code></pre>&#x000A;<p data-sourcepos="646:1-647:174" dir="auto">NOTE: <strong>Note:</strong>&#x000A;In the example above, the expressions are wrapped double quotes because they are glob patterns. GitLab will fail to parse <code>.gitlab-ci.yml</code> files with unwrapped glob patterns.</p>&#x000A;<p data-sourcepos="649:1-649:136" dir="auto">The following example will skip the CI job if a change is detected in any file in the root directory of the repo with a <code>.md</code> extension:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">npm run build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">changes</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s2">"</span><span class="s">*.md"</span></span></code></pre>&#x000A;<p data-sourcepos="659:1-661:18" dir="auto">CAUTION: <strong>Warning:</strong>&#x000A;There are some caveats when using this feature with new branches and tags. See&#x000A;the section below.</p>&#x000A;<h5 data-sourcepos="663:1-663:48" dir="auto">&#x000A;<a id="user-content-using-changes-with-new-branches-and-tags" class="anchor" href="#using-changes-with-new-branches-and-tags" aria-hidden="true"></a>Using <code>changes</code> with new branches and tags</h5>&#x000A;<p data-sourcepos="665:1-668:82" dir="auto">When pushing a <strong>new</strong> branch or a <strong>new</strong> tag to GitLab, the policy always&#x000A;evaluates to true and GitLab will create a job. This feature is not connected&#x000A;with merge requests yet and, because GitLab is creating pipelines before a user&#x000A;can create a merge request, it is unknown what the target branch is at this point.</p>&#x000A;<h5 data-sourcepos="670:1-670:43" dir="auto">&#x000A;<a id="user-content-using-changes-with-merge_requests" class="anchor" href="#using-changes-with-merge_requests" aria-hidden="true"></a>Using <code>changes</code> with <code>merge_requests</code>&#x000A;</h5>&#x000A;<p data-sourcepos="672:1-674:19" dir="auto">With <a href="../merge_request_pipelines/index.md">pipelines for merge requests</a>,&#x000A;it is possible to define a job to be created based on files modified&#x000A;in a merge request.</p>&#x000A;<p data-sourcepos="676:1-676:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker build service one</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-service-one-image:$CI_COMMIT_REF_SLUG .</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">refs</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">merge_requests</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">changes</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">Dockerfile</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">service-one/**/*</span></span></code></pre>&#x000A;<p data-sourcepos="689:1-691:48" dir="auto">In the scenario above, if a merge request is created or updated that changes&#x000A;either files in <code>service-one</code> directory or the <code>Dockerfile</code>, GitLab creates&#x000A;and triggers the <code>docker build service one</code> job.</p>&#x000A;<h3 data-sourcepos="693:1-693:11" dir="auto">&#x000A;<a id="user-content-rules" class="anchor" href="#rules" aria-hidden="true"></a><code>rules</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="695:1-695:94" dir="auto">&#x000A;<p data-sourcepos="695:3-695:94"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/29011" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 12.3.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="697:1-698:77" dir="auto"><code>rules</code> allows for a list of individual rule objects to be evaluated&#x000A;<em>in order</em>, until one matches and dynamically provides attributes to the job.</p>&#x000A;<p data-sourcepos="700:1-700:31" dir="auto">Available rule clauses include:</p>&#x000A;<ul data-sourcepos="702:1-706:0" dir="auto">&#x000A;<li data-sourcepos="702:1-703:65">&#x000A;<a href="#rulesif"><code>if</code></a>&#x000A;(similar to <a href="#onlyvariablesexceptvariables"><code>only:variables</code></a>).</li>&#x000A;<li data-sourcepos="704:1-706:0">&#x000A;<a href="#ruleschanges"><code>changes</code></a>&#x000A;(same as <a href="#onlychangesexceptchanges"><code>only:changes</code></a>).</li>&#x000A;</ul>&#x000A;<p data-sourcepos="707:1-709:27" dir="auto">For example, using <code>if</code>. This configuration specifies that <code>job</code> should be built&#x000A;and run for every pipeline on merge requests targeting <code>master</code>, regardless of&#x000A;the status of other builds:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">Hello,</span><span class="nv"> </span><span class="s">Rules!"</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">rules</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$CI_MERGE_REQUEST_TARGET_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"master"'</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">always</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$VAR</span><span class="nv"> </span><span class="s">=~</span><span class="nv"> </span><span class="s">/pattern/'</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span> <span class="s">on_success</span></span></code></pre>&#x000A;<p data-sourcepos="722:1-722:35" dir="auto">In this example, if the first rule:</p>&#x000A;<ul data-sourcepos="724:1-730:0" dir="auto">&#x000A;<li data-sourcepos="724:1-724:61">Matches, the job will be given the <code>when:always</code> attribute.</li>&#x000A;<li data-sourcepos="725:1-730:0">Does not match, the second and third rules will be evaluated sequentially&#x000A;until a match is found. That is, the job will be given either the:&#x000A;<ul data-sourcepos="727:3-730:0">&#x000A;<li data-sourcepos="727:3-727:56">&#x000A;<code>when: manual</code> attribute if the second rule matches.</li>&#x000A;<li data-sourcepos="728:3-730:0">&#x000A;<code>when: on_success</code> attribute if the second rule does not match. The third&#x000A;rule will always match when reached because it has no conditional clauses.</li>&#x000A;</ul>&#x000A;</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="731:1-731:15" dir="auto">&#x000A;<a id="user-content-rulesif" class="anchor" href="#rulesif" aria-hidden="true"></a><code>rules:if</code>&#x000A;</h4>&#x000A;<p data-sourcepos="733:1-735:87" dir="auto"><code>rules:if</code> differs slightly from <code>only:variables</code> by accepting only a single&#x000A;expression string, rather than an array of them. Any set of expressions to be&#x000A;evaluated should be conjoined into a single expression using <code>&amp;&amp;</code> or <code>||</code>. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">Hello,</span><span class="nv"> </span><span class="s">Rules!"</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">rules</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$CI_MERGE_REQUEST_SOURCE_BRANCH</span><span class="nv"> </span><span class="s">=~</span><span class="nv"> </span><span class="s">/^feature/</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">$CI_MERGE_REQUEST_TARGET_BRANCH</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"master"'</span> <span class="c1"># This rule will be evaluated</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">always</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$CI_MERGE_REQUEST_SOURCE_BRANCH</span><span class="nv"> </span><span class="s">=~</span><span class="nv"> </span><span class="s">/^feature/'</span> <span class="c1"># This rule will only be evaluated if the target branch is not "master"</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$CI_MERGE_REQUEST_SOURCE_BRANCH'</span> <span class="c1"># If neither of the first two match but the simple presence does, we set to "on_success" by default</span></span></code></pre>&#x000A;<p data-sourcepos="748:1-751:13" dir="auto">If none of the provided rules match, the job will be set to <code>when:never</code>, and&#x000A;not included in the pipeline. If <code>rules:when</code> is not included in the configuration&#x000A;at all, the behavior defaults to <code>job:when</code>, which continues to default to&#x000A;<code>on_success</code>.</p>&#x000A;<h4 data-sourcepos="753:1-753:20" dir="auto">&#x000A;<a id="user-content-ruleschanges" class="anchor" href="#ruleschanges" aria-hidden="true"></a><code>rules:changes</code>&#x000A;</h4>&#x000A;<p data-sourcepos="755:1-756:28" dir="auto"><code>changes</code> works exactly the same way as <a href="#onlychangesexceptchanges"><code>only</code>/<code>except</code></a>,&#x000A;accepting an array of paths.</p>&#x000A;<p data-sourcepos="758:1-758:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-image:$CI_COMMIT_REF_SLUG .</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">rules</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">changes</span><span class="pi">:</span> <span class="c1"># Will include the job and set to when:manual if any of the follow paths match a modified file.</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">Dockerfile</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$VAR</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"string</span><span class="nv"> </span><span class="s">value"'</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span> <span class="c1"># Will include the job and set to when:manual if the expression evaluates to true, after the `changes:` rule fails to match.</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span> <span class="s">on_success</span> <span class="c1"># If neither of the first rules match, set to on_success</span></span>&#x000A;<span id="LC10" class="line" lang="yaml"></span></code></pre>&#x000A;<p data-sourcepos="773:1-773:37" dir="auto">In this example, a job either set to:</p>&#x000A;<ul data-sourcepos="775:1-777:0" dir="auto">&#x000A;<li data-sourcepos="775:1-775:71">Run manually if <code>Dockerfile</code> has changed OR <code>$VAR == "string value"</code>.</li>&#x000A;<li data-sourcepos="776:1-777:0">&#x000A;<code>when:on_success</code> by the last rule, where no earlier clauses evaluate to true.</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="778:1-778:25" dir="auto">&#x000A;<a id="user-content-complex-rule-clauses" class="anchor" href="#complex-rule-clauses" aria-hidden="true"></a>Complex rule clauses</h4>&#x000A;<p data-sourcepos="780:1-780:77" dir="auto">To conjoin <code>if</code> and <code>changes</code> clauses with an AND, use them in the same rule.</p>&#x000A;<p data-sourcepos="782:1-782:25" dir="auto">In the following example:</p>&#x000A;<ul data-sourcepos="784:1-787:0" dir="auto">&#x000A;<li data-sourcepos="784:1-785:43">We run the job manually if <code>Dockerfile</code> or any file in <code>docker/scripts/</code>&#x000A;has changed AND <code>$VAR == "string value"</code>.</li>&#x000A;<li data-sourcepos="786:1-787:0">Otherwise, the job will not be included in the pipeline.</li>&#x000A;</ul>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-image:$CI_COMMIT_REF_SLUG .</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">rules</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$VAR</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">"string</span><span class="nv"> </span><span class="s">value"'</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="na">changes</span><span class="pi">:</span> <span class="c1"># Will include the job and set to when:manual if any of the follow paths match a modified file.</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">Dockerfile</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">docker/scripts/*</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="c1"># - when: never would be redundant here, this is implied any time rules are listed.</span></span></code></pre>&#x000A;<p data-sourcepos="800:1-800:41" dir="auto">The only clauses currently available are:</p>&#x000A;<ul data-sourcepos="802:1-804:0" dir="auto">&#x000A;<li data-sourcepos="802:1-802:6"><code>if</code></li>&#x000A;<li data-sourcepos="803:1-804:0"><code>changes</code></li>&#x000A;</ul>&#x000A;<p data-sourcepos="805:1-807:56" dir="auto">Keywords such as <code>branches</code> or <code>refs</code> that are currently available for&#x000A;<code>only</code>/<code>except</code> are not yet available in <code>rules</code> as they are being individually&#x000A;considered for their usage and behavior in this context.</p>&#x000A;<h4 data-sourcepos="809:1-809:25" dir="auto">&#x000A;<a id="user-content-permitted-attributes" class="anchor" href="#permitted-attributes" aria-hidden="true"></a>Permitted attributes</h4>&#x000A;<p data-sourcepos="811:1-811:53" dir="auto">The only job attributes currently set by <code>rules</code> are:</p>&#x000A;<ul data-sourcepos="813:1-815:0" dir="auto">&#x000A;<li data-sourcepos="813:1-813:9">&#x000A;<code>when</code>.</li>&#x000A;<li data-sourcepos="814:1-815:0">&#x000A;<code>start_in</code>, if <code>when</code> is set to <code>delayed</code>.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="816:1-817:15" dir="auto">A job will be included in a pipeline if <code>when</code> is evaluated to any value&#x000A;except <code>never</code>.</p>&#x000A;<p data-sourcepos="819:1-820:8" dir="auto">Delayed jobs require a <code>start_in</code> value, so rule objects do as well. For&#x000A;example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-image:$CI_COMMIT_REF_SLUG .</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">rules</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">changes</span><span class="pi">:</span> <span class="c1"># Will include the job and delay 3 hours when the Dockerfile has changed</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">Dockerfile</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="na">when</span><span class="pi">:</span> <span class="s">delayed</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="na">start_in</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3</span><span class="nv"> </span><span class="s">hours'</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span> <span class="s">on_success</span> <span class="c1"># Otherwise include the job and set to run normally</span></span>&#x000A;<span id="LC9" class="line" lang="yaml"></span></code></pre>&#x000A;<p data-sourcepos="834:1-836:70" dir="auto">Additional job configuration may be added to rules in the future. If something&#x000A;useful isn't available, please&#x000A;<a href="https://www.gitlab.com/gitlab-org/gitlab-foss/issues" rel="nofollow noreferrer noopener" target="_blank">open an issue</a>.</p>&#x000A;<h3 data-sourcepos="838:1-838:10" dir="auto">&#x000A;<a id="user-content-tags" class="anchor" href="#tags" aria-hidden="true"></a><code>tags</code>&#x000A;</h3>&#x000A;<p data-sourcepos="840:1-841:28" dir="auto"><code>tags</code> is used to select specific Runners from the list of all Runners that are&#x000A;allowed to run this project.</p>&#x000A;<p data-sourcepos="843:1-844:42" dir="auto">During the registration of a Runner, you can specify the Runner's tags, for&#x000A;example <code>ruby</code>, <code>postgres</code>, <code>development</code>.</p>&#x000A;<p data-sourcepos="846:1-847:17" dir="auto"><code>tags</code> allow you to run jobs with Runners that have the specified tags&#x000A;assigned to them:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span></code></pre>&#x000A;<p data-sourcepos="856:1-857:44" dir="auto">The specification above, will make sure that <code>job</code> is built by a Runner that&#x000A;has both <code>ruby</code> AND <code>postgres</code> tags defined.</p>&#x000A;<p data-sourcepos="859:1-861:58" dir="auto">Tags are also a great way to run different jobs on different platforms, for&#x000A;example, given an OS X Runner with tag <code>osx</code> and Windows Runner with tag&#x000A;<code>windows</code>, the following jobs run on respective platforms:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">windows job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">windows</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">echo Hello, %USERNAME%!</span></span>&#x000A;<span id="LC8" class="line" lang="yaml"></span>&#x000A;<span id="LC9" class="line" lang="yaml"><span class="na">osx job</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">osx</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">echo "Hello, $USER!"</span></span></code></pre>&#x000A;<h3 data-sourcepos="881:1-881:19" dir="auto">&#x000A;<a id="user-content-allow_failure" class="anchor" href="#allow_failure" aria-hidden="true"></a><code>allow_failure</code>&#x000A;</h3>&#x000A;<p data-sourcepos="883:1-885:68" dir="auto"><code>allow_failure</code> allows a job to fail without impacting the rest of the CI&#x000A;suite.&#x000A;The default value is <code>false</code>, except for <a href="#whenmanual">manual</a> jobs.</p>&#x000A;<p data-sourcepos="887:1-889:35" dir="auto">When enabled and the job fails, the job will show an orange warning in the UI.&#x000A;However, the logical flow of the pipeline will consider the job a&#x000A;success/passed, and is not blocked.</p>&#x000A;<p data-sourcepos="891:1-893:27" dir="auto">Assuming all other jobs are successful, the job's stage and its pipeline will&#x000A;show the same orange warning. However, the associated commit will be marked&#x000A;"passed", without warnings.</p>&#x000A;<p data-sourcepos="895:1-897:22" dir="auto">In the example below, <code>job1</code> and <code>job2</code> will run in parallel, but if <code>job1</code>&#x000A;fails, it will not stop the next stage from running, since it's marked with&#x000A;<code>allow_failure: true</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job1</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">execute_script_that_will_fail</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">allow_failure</span><span class="pi">:</span> <span class="no">true</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="na">job2</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">execute_script_that_will_succeed</span></span>&#x000A;<span id="LC11" class="line" lang="yaml"></span>&#x000A;<span id="LC12" class="line" lang="yaml"><span class="na">job3</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">deploy_to_staging</span></span></code></pre>&#x000A;<h3 data-sourcepos="917:1-917:10" dir="auto">&#x000A;<a id="user-content-when" class="anchor" href="#when" aria-hidden="true"></a><code>when</code>&#x000A;</h3>&#x000A;<p data-sourcepos="919:1-920:8" dir="auto"><code>when</code> is used to implement jobs that are run in case of failure or despite the&#x000A;failure.</p>&#x000A;<p data-sourcepos="922:1-922:49" dir="auto"><code>when</code> can be set to one of the following values:</p>&#x000A;<ol data-sourcepos="924:1-932:0" dir="auto">&#x000A;<li data-sourcepos="924:1-926:42">&#x000A;<code>on_success</code> - execute job only when all jobs from prior stages&#x000A;succeed (or are considered succeeding because they are marked&#x000A;<code>allow_failure</code>). This is the default.</li>&#x000A;<li data-sourcepos="927:1-928:10">&#x000A;<code>on_failure</code> - execute job only when at least one job from prior stages&#x000A;fails.</li>&#x000A;<li data-sourcepos="929:1-929:77">&#x000A;<code>always</code> - execute job regardless of the status of jobs from prior stages.</li>&#x000A;<li data-sourcepos="930:1-932:0">&#x000A;<code>manual</code> - execute job manually (added in GitLab 8.10). Read about&#x000A;<a href="#whenmanual">manual actions</a> below.</li>&#x000A;</ol>&#x000A;<p data-sourcepos="933:1-933:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">cleanup_build</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">test</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">deploy</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">cleanup</span></span>&#x000A;<span id="LC7" class="line" lang="yaml"></span>&#x000A;<span id="LC8" class="line" lang="yaml"><span class="na">build_job</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">make build</span></span>&#x000A;<span id="LC12" class="line" lang="yaml"></span>&#x000A;<span id="LC13" class="line" lang="yaml"><span class="na">cleanup_build_job</span><span class="pi">:</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">cleanup_build</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">cleanup build when failed</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="na">when</span><span class="pi">:</span> <span class="s">on_failure</span></span>&#x000A;<span id="LC18" class="line" lang="yaml"></span>&#x000A;<span id="LC19" class="line" lang="yaml"><span class="na">test_job</span><span class="pi">:</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC22" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">make test</span></span>&#x000A;<span id="LC23" class="line" lang="yaml"></span>&#x000A;<span id="LC24" class="line" lang="yaml"><span class="na">deploy_job</span><span class="pi">:</span></span>&#x000A;<span id="LC25" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC26" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC27" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">make deploy</span></span>&#x000A;<span id="LC28" class="line" lang="yaml">  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC29" class="line" lang="yaml"></span>&#x000A;<span id="LC30" class="line" lang="yaml"><span class="na">cleanup_job</span><span class="pi">:</span></span>&#x000A;<span id="LC31" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">cleanup</span></span>&#x000A;<span id="LC32" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC33" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">cleanup after jobs</span></span>&#x000A;<span id="LC34" class="line" lang="yaml">  <span class="na">when</span><span class="pi">:</span> <span class="s">always</span></span></code></pre>&#x000A;<p data-sourcepos="972:1-972:22" dir="auto">The above script will:</p>&#x000A;<ol data-sourcepos="974:1-978:0" dir="auto">&#x000A;<li data-sourcepos="974:1-974:59">Execute <code>cleanup_build_job</code> only when <code>build_job</code> fails.</li>&#x000A;<li data-sourcepos="975:1-976:22">Always execute <code>cleanup_job</code> as the last step in pipeline regardless of&#x000A;success or failure.</li>&#x000A;<li data-sourcepos="977:1-978:0">Allow you to manually execute <code>deploy_job</code> from GitLab's UI.</li>&#x000A;</ol>&#x000A;<h4 data-sourcepos="979:1-979:18" dir="auto">&#x000A;<a id="user-content-whenmanual" class="anchor" href="#whenmanual" aria-hidden="true"></a><code>when:manual</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="981:1-983:52" dir="auto">&#x000A;<ul data-sourcepos="981:3-983:52">&#x000A;<li data-sourcepos="981:3-981:30">Introduced in GitLab 8.10.</li>&#x000A;<li data-sourcepos="982:3-982:58">Blocking manual actions were introduced in GitLab 9.0.</li>&#x000A;<li data-sourcepos="983:3-983:52">Protected actions were introduced in GitLab 9.2.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="985:1-989:80" dir="auto">Manual actions are a special type of job that are not executed automatically,&#x000A;they need to be explicitly started by a user. An example usage of manual actions&#x000A;would be a deployment to a production environment. Manual actions can be started&#x000A;from the pipeline, job, environment, and deployment views. Read more at the&#x000A;<a href="../environments.md#configuring-manual-deployments">environments documentation</a>.</p>&#x000A;<p data-sourcepos="991:1-994:42" dir="auto">Manual actions can be either optional or blocking. Blocking manual actions will&#x000A;block the execution of the pipeline at the stage this action is defined in. It's&#x000A;possible to resume execution of the pipeline when someone executes a blocking&#x000A;manual action by clicking a <em>play</em> button.</p>&#x000A;<p data-sourcepos="996:1-1000:20" dir="auto">When a pipeline is blocked, it will not be merged if Merge When Pipeline Succeeds&#x000A;is set. Blocked pipelines also do have a special status, called <em>manual</em>.&#x000A;Manual actions are non-blocking by default. If you want to make manual action&#x000A;blocking, it is necessary to add <code>allow_failure: false</code> to the job's definition&#x000A;in <code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="1002:1-1004:51" dir="auto">Optional manual actions have <code>allow_failure: true</code> set by default and their&#x000A;Statuses do not contribute to the overall pipeline status. So, if a manual&#x000A;action fails, the pipeline will eventually succeed.</p>&#x000A;<p data-sourcepos="1006:1-1010:41" dir="auto">Manual actions are considered to be write actions, so permissions for&#x000A;<a href="../../user/project/protected_branches.md">protected branches</a> are used when&#x000A;a user wants to trigger an action. In other words, in order to trigger a manual&#x000A;action assigned to a branch that the pipeline is running for, the user needs to&#x000A;have the ability to merge to this branch.</p>&#x000A;<h4 data-sourcepos="1012:1-1012:19" dir="auto">&#x000A;<a id="user-content-whendelayed" class="anchor" href="#whendelayed" aria-hidden="true"></a><code>when:delayed</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1014:1-1014:94" dir="auto">&#x000A;<p data-sourcepos="1014:3-1014:94"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/21767" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 11.4.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1016:1-1017:78" dir="auto">Delayed job are for executing scripts after a certain period.&#x000A;This is useful if you want to avoid jobs entering <code>pending</code> state immediately.</p>&#x000A;<p data-sourcepos="1019:1-1020:98" dir="auto">You can set the period with <code>start_in</code> key. The value of <code>start_in</code> key is an elapsed time in seconds, unless a unit is&#x000A;provided. <code>start_in</code> key must be less than or equal to one hour. Examples of valid values include:</p>&#x000A;<ul data-sourcepos="1022:1-1025:0" dir="auto">&#x000A;<li data-sourcepos="1022:1-1022:14"><code>10 seconds</code></li>&#x000A;<li data-sourcepos="1023:1-1023:14"><code>30 minutes</code></li>&#x000A;<li data-sourcepos="1024:1-1025:0"><code>1 hour</code></li>&#x000A;</ul>&#x000A;<p data-sourcepos="1026:1-1027:87" dir="auto">When there is a delayed job in a stage, the pipeline will not progress until the delayed job has finished.&#x000A;This means this keyword can also be used for inserting delays between different stages.</p>&#x000A;<p data-sourcepos="1029:1-1030:102" dir="auto">The timer of a delayed job starts immediately after the previous stage has completed.&#x000A;Similar to other types of jobs, a delayed job's timer will not start unless the previous stage passed.</p>&#x000A;<p data-sourcepos="1032:1-1032:129" dir="auto">The following example creates a job named <code>timed rollout 10%</code> that is executed 30 minutes after the previous stage has completed:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">timed rollout 10%</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">echo 'Rolling out 10% ...'</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">when</span><span class="pi">:</span> <span class="s">delayed</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">start_in</span><span class="pi">:</span> <span class="s">30 minutes</span></span></code></pre>&#x000A;<p data-sourcepos="1042:1-1043:82" dir="auto">You can stop the active timer of a delayed job by clicking the <strong>Unschedule</strong> button.&#x000A;This job will never be executed in the future unless you execute the job manually.</p>&#x000A;<p data-sourcepos="1045:1-1046:56" dir="auto">You can start a delayed job immediately by clicking the <strong>Play</strong> button.&#x000A;GitLab runner will pick your job soon and start the job.</p>&#x000A;<h3 data-sourcepos="1048:1-1048:17" dir="auto">&#x000A;<a id="user-content-environment" class="anchor" href="#environment" aria-hidden="true"></a><code>environment</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1050:1-1052:52" dir="auto">&#x000A;<ul data-sourcepos="1050:3-1052:52">&#x000A;<li data-sourcepos="1050:3-1050:29">Introduced in GitLab 8.9.</li>&#x000A;<li data-sourcepos="1051:3-1052:52">You can read more about environments and find more examples in the&#x000A;<a href="../environments.md" title="CI/CD environments">documentation about environments</a>.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1054:1-1056:34" dir="auto"><code>environment</code> is used to define that a job deploys to a specific environment.&#x000A;If <code>environment</code> is specified and no environment under that name exists, a new&#x000A;one will be created automatically.</p>&#x000A;<p data-sourcepos="1058:1-1058:68" dir="auto">In its simplest form, the <code>environment</code> keyword can be defined like:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy to production</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">git push production HEAD:master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span></span></code></pre>&#x000A;<p data-sourcepos="1068:1-1069:43" dir="auto">In the above example, the <code>deploy to production</code> job will be marked as doing a&#x000A;deployment to the <code>production</code> environment.</p>&#x000A;<h4 data-sourcepos="1071:1-1071:23" dir="auto">&#x000A;<a id="user-content-environmentname" class="anchor" href="#environmentname" aria-hidden="true"></a><code>environment:name</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1073:1-1079:60" dir="auto">&#x000A;<ul data-sourcepos="1073:3-1079:60">&#x000A;<li data-sourcepos="1073:3-1073:30">Introduced in GitLab 8.11.</li>&#x000A;<li data-sourcepos="1074:3-1076:19">Before GitLab 8.11, the name of an environment could be defined as a string like&#x000A;<code>environment: production</code>. The recommended way now is to define it under the&#x000A;<code>name</code> keyword.</li>&#x000A;<li data-sourcepos="1077:3-1079:60">The <code>name</code> parameter can use any of the defined CI variables,&#x000A;including predefined, secure variables and <code>.gitlab-ci.yml</code> <a href="#variables"><code>variables</code></a>.&#x000A;You however cannot use variables defined under <code>script</code>.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1081:1-1081:35" dir="auto">The <code>environment</code> name can contain:</p>&#x000A;<ul data-sourcepos="1083:1-1092:0" dir="auto">&#x000A;<li data-sourcepos="1083:1-1083:9">letters</li>&#x000A;<li data-sourcepos="1084:1-1084:8">digits</li>&#x000A;<li data-sourcepos="1085:1-1085:8">spaces</li>&#x000A;<li data-sourcepos="1086:1-1086:5"><code>-</code></li>&#x000A;<li data-sourcepos="1087:1-1087:5"><code>_</code></li>&#x000A;<li data-sourcepos="1088:1-1088:5"><code>/</code></li>&#x000A;<li data-sourcepos="1089:1-1089:5"><code>$</code></li>&#x000A;<li data-sourcepos="1090:1-1090:5"><code>{</code></li>&#x000A;<li data-sourcepos="1091:1-1092:0"><code>}</code></li>&#x000A;</ul>&#x000A;<p data-sourcepos="1093:1-1094:30" dir="auto">Common names are <code>qa</code>, <code>staging</code>, and <code>production</code>, but you can use whatever&#x000A;name works with your workflow.</p>&#x000A;<p data-sourcepos="1096:1-1098:39" dir="auto">Instead of defining the name of the environment right after the <code>environment</code>&#x000A;keyword, it is also possible to define it as a separate value. For that, use&#x000A;the <code>name</code> keyword under <code>environment</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy to production</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">git push production HEAD:master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span></span></code></pre>&#x000A;<h4 data-sourcepos="1108:1-1108:22" dir="auto">&#x000A;<a id="user-content-environmenturl" class="anchor" href="#environmenturl" aria-hidden="true"></a><code>environment:url</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1110:1-1115:60" dir="auto">&#x000A;<ul data-sourcepos="1110:3-1115:60">&#x000A;<li data-sourcepos="1110:3-1110:30">Introduced in GitLab 8.11.</li>&#x000A;<li data-sourcepos="1111:3-1112:60">Before GitLab 8.11, the URL could be added only in GitLab's UI. The&#x000A;recommended way now is to define it in <code>.gitlab-ci.yml</code>.</li>&#x000A;<li data-sourcepos="1113:3-1115:60">The <code>url</code> parameter can use any of the defined CI variables,&#x000A;including predefined, secure variables and <code>.gitlab-ci.yml</code> <a href="#variables"><code>variables</code></a>.&#x000A;You however cannot use variables defined under <code>script</code>.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1117:1-1118:57" dir="auto">This is an optional value that when set, it exposes buttons in various places&#x000A;in GitLab which when clicked take you to the defined URL.</p>&#x000A;<p data-sourcepos="1120:1-1122:30" dir="auto">In the example below, if the job finishes successfully, it will create buttons&#x000A;in the merge requests and in the environments/deployments pages which will point&#x000A;to <code>https://prod.example.com</code>.</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy to production</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">git push production HEAD:master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">url</span><span class="pi">:</span> <span class="s">https://prod.example.com</span></span></code></pre>&#x000A;<h4 data-sourcepos="1133:1-1133:26" dir="auto">&#x000A;<a id="user-content-environmenton_stop" class="anchor" href="#environmenton_stop" aria-hidden="true"></a><code>environment:on_stop</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1135:1-1138:22" dir="auto">&#x000A;<ul data-sourcepos="1135:3-1138:22">&#x000A;<li data-sourcepos="1135:3-1135:41">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/6669" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 8.13.</li>&#x000A;<li data-sourcepos="1136:3-1138:22">Starting with GitLab 8.14, when you have an environment that has a stop action&#x000A;defined, GitLab will automatically trigger a stop action when the associated&#x000A;branch is deleted.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1140:1-1142:16" dir="auto">Closing (stopping) environments can be achieved with the <code>on_stop</code> keyword defined under&#x000A;<code>environment</code>. It declares a different job that runs in order to close&#x000A;the environment.</p>&#x000A;<p data-sourcepos="1144:1-1144:53" dir="auto">Read the <code>environment:action</code> section for an example.</p>&#x000A;<h4 data-sourcepos="1146:1-1146:25" dir="auto">&#x000A;<a id="user-content-environmentaction" class="anchor" href="#environmentaction" aria-hidden="true"></a><code>environment:action</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1148:1-1148:39" dir="auto">&#x000A;<p data-sourcepos="1148:3-1148:39"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/6669" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 8.13.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1150:1-1151:51" dir="auto">The <code>action</code> keyword is to be used in conjunction with <code>on_stop</code> and is defined&#x000A;in the job that is called to close the environment.</p>&#x000A;<p data-sourcepos="1153:1-1153:18" dir="auto">Take for instance:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">review_app</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make deploy-app</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">review</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">on_stop</span><span class="pi">:</span> <span class="s">stop_review_app</span></span>&#x000A;<span id="LC7" class="line" lang="yaml"></span>&#x000A;<span id="LC8" class="line" lang="yaml"><span class="na">stop_review_app</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="na">GIT_STRATEGY</span><span class="pi">:</span> <span class="s">none</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make delete-app</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">  <span class="na">when</span><span class="pi">:</span> <span class="s">manual</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">review</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">    <span class="na">action</span><span class="pi">:</span> <span class="s">stop</span></span></code></pre>&#x000A;<p data-sourcepos="1174:1-1179:39" dir="auto">In the above example we set up the <code>review_app</code> job to deploy to the <code>review</code>&#x000A;environment, and we also defined a new <code>stop_review_app</code> job under <code>on_stop</code>.&#x000A;Once the <code>review_app</code> job is successfully finished, it will trigger the&#x000A;<code>stop_review_app</code> job based on what is defined under <code>when</code>. In this case we&#x000A;set it up to <code>manual</code> so it will need a <a href="#whenmanual">manual action</a> via&#x000A;GitLab's web interface in order to run.</p>&#x000A;<p data-sourcepos="1181:1-1183:91" dir="auto">Also in the example, <code>GIT_STRATEGY</code> is set to <code>none</code> so that GitLab Runner won’t&#x000A;try to check out the code after the branch is deleted when the <code>stop_review_app</code>&#x000A;job is <a href="../environments.md#automatically-stopping-an-environment">automatically triggered</a>.</p>&#x000A;<p data-sourcepos="1185:1-1185:81" dir="auto">The <code>stop_review_app</code> job is <strong>required</strong> to have the following keywords defined:</p>&#x000A;<ul data-sourcepos="1187:1-1192:0" dir="auto">&#x000A;<li data-sourcepos="1187:1-1187:29">&#x000A;<code>when</code> - <a href="#when">reference</a>&#x000A;</li>&#x000A;<li data-sourcepos="1188:1-1188:20"><code>environment:name</code></li>&#x000A;<li data-sourcepos="1189:1-1189:22"><code>environment:action</code></li>&#x000A;<li data-sourcepos="1190:1-1192:0">&#x000A;<code>stage</code> should be the same as the <code>review_app</code> in order for the environment&#x000A;to stop automatically when the branch is deleted</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="1193:1-1193:25" dir="auto">&#x000A;<a id="user-content-dynamic-environments" class="anchor" href="#dynamic-environments" aria-hidden="true"></a>Dynamic environments</h4>&#x000A;<blockquote data-sourcepos="1195:1-1199:60" dir="auto">&#x000A;<ul data-sourcepos="1195:3-1199:60">&#x000A;<li data-sourcepos="1195:3-1195:63">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/6323" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 8.12 and GitLab Runner 1.6.</li>&#x000A;<li data-sourcepos="1196:3-1196:72">The <code>$CI_ENVIRONMENT_SLUG</code> was <a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/7983" rel="nofollow noreferrer noopener" target="_blank">introduced</a> in GitLab 8.15.</li>&#x000A;<li data-sourcepos="1197:3-1199:60">The <code>name</code> and <code>url</code> parameters can use any of the defined CI variables,&#x000A;including predefined, secure variables and <code>.gitlab-ci.yml</code> <a href="#variables"><code>variables</code></a>.&#x000A;You however cannot use variables defined under <code>script</code>.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1201:1-1201:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">deploy as review app</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make deploy</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">review/$CI_COMMIT_REF_NAME</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">url</span><span class="pi">:</span> <span class="s">https://$CI_ENVIRONMENT_SLUG.example.com/</span></span></code></pre>&#x000A;<p data-sourcepos="1212:1-1218:34" dir="auto">The <code>deploy as review app</code> job will be marked as deployment to dynamically&#x000A;create the <code>review/$CI_COMMIT_REF_NAME</code> environment, where <code>$CI_COMMIT_REF_NAME</code>&#x000A;is an <a href="../variables/README.md" title="CI/CD variables">environment variable</a> set by the Runner. The&#x000A;<code>$CI_ENVIRONMENT_SLUG</code> variable is based on the environment name, but suitable&#x000A;for inclusion in URLs. In this case, if the <code>deploy as review app</code> job was run&#x000A;in a branch named <code>pow</code>, this environment would be accessible with an URL like&#x000A;<code>https://review-pow.example.com/</code>.</p>&#x000A;<p data-sourcepos="1220:1-1221:23" dir="auto">This of course implies that the underlying server which hosts the application&#x000A;is properly configured.</p>&#x000A;<p data-sourcepos="1223:1-1225:56" dir="auto">The common use case is to create dynamic environments for branches and use them&#x000A;as Review Apps. You can see a simple example using Review Apps at&#x000A;<a href="https://gitlab.com/gitlab-examples/review-apps-nginx/" rel="nofollow noreferrer noopener" target="_blank">https://gitlab.com/gitlab-examples/review-apps-nginx/</a>.</p>&#x000A;<h3 data-sourcepos="1227:1-1227:11" dir="auto">&#x000A;<a id="user-content-cache" class="anchor" href="#cache" aria-hidden="true"></a><code>cache</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1229:1-1233:72" dir="auto">&#x000A;<ul data-sourcepos="1229:3-1233:72">&#x000A;<li data-sourcepos="1229:3-1229:39">Introduced in GitLab Runner v0.7.0.</li>&#x000A;<li data-sourcepos="1230:3-1230:44">&#x000A;<code>cache</code> can be set globally and per-job.</li>&#x000A;<li data-sourcepos="1231:3-1232:15">From GitLab 9.0, caching is enabled and shared between pipelines and jobs&#x000A;by default.</li>&#x000A;<li data-sourcepos="1233:3-1233:72">From GitLab 9.2, caches are restored before <a href="#artifacts">artifacts</a>.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1235:1-1237:58" dir="auto">TIP: <strong>Learn more:</strong>&#x000A;Read how caching works and find out some good practices in the&#x000A;<a href="../caching/index.md">caching dependencies documentation</a>.</p>&#x000A;<p data-sourcepos="1239:1-1241:10" dir="auto"><code>cache</code> is used to specify a list of files and directories which should be&#x000A;cached between jobs. You can only use paths that are within the project&#x000A;workspace.</p>&#x000A;<p data-sourcepos="1243:1-1244:47" dir="auto">If <code>cache</code> is defined outside the scope of jobs, it means it is set&#x000A;globally and all jobs will use that definition.</p>&#x000A;<h4 data-sourcepos="1246:1-1246:18" dir="auto">&#x000A;<a id="user-content-cachepaths" class="anchor" href="#cachepaths" aria-hidden="true"></a><code>cache:paths</code>&#x000A;</h4>&#x000A;<p data-sourcepos="1248:1-1249:170" dir="auto">Use the <code>paths</code> directive to choose which files or directories will be cached.&#x000A;Wildcards can be used that follow the <a href="https://en.wikipedia.org/wiki/Glob_(programming)" rel="nofollow noreferrer noopener" target="_blank">glob</a> patterns and <a href="https://golang.org/pkg/path/filepath/#Match" rel="nofollow noreferrer noopener" target="_blank">filepath.Match</a>.</p>&#x000A;<p data-sourcepos="1251:1-1251:72" dir="auto">Cache all files in <code>binaries</code> that end in <code>.apk</code> and the <code>.config</code> file:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/*.apk</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">.config</span></span></code></pre>&#x000A;<p data-sourcepos="1262:1-1263:32" dir="auto">Locally defined cache overrides globally defined options. The following <code>rspec</code>&#x000A;job will cache only <code>binaries/</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">my/files</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="na">key</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1278:1-1280:43" dir="auto">Note that since cache is shared between jobs, if you're using different&#x000A;paths for different jobs, you should also set a different <strong>cache:key</strong>&#x000A;otherwise cache content can be overwritten.</p>&#x000A;<h4 data-sourcepos="1282:1-1282:16" dir="auto">&#x000A;<a id="user-content-cachekey" class="anchor" href="#cachekey" aria-hidden="true"></a><code>cache:key</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1284:1-1284:37" dir="auto">&#x000A;<p data-sourcepos="1284:3-1284:37">Introduced in GitLab Runner v1.0.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1286:1-1288:43" dir="auto">Since the cache is shared between jobs, if you're using different&#x000A;paths for different jobs, you should also set a different <code>cache:key</code>&#x000A;otherwise cache content can be overwritten.</p>&#x000A;<p data-sourcepos="1290:1-1293:77" dir="auto">The <code>key</code> directive allows you to define the affinity of caching between jobs,&#x000A;allowing to have a single cache for all jobs, cache per-job, cache per-branch&#x000A;or any other way that fits your workflow. This way, you can fine tune caching,&#x000A;allowing you to cache data between different jobs or even different branches.</p>&#x000A;<p data-sourcepos="1295:1-1298:56" dir="auto">The <code>cache:key</code> variable can use any of the&#x000A;<a href="../variables/README.md">predefined variables</a>, and the default key, if not&#x000A;set, is just literal <code>default</code> which means everything is shared between each&#x000A;pipelines and jobs by default, starting from GitLab 9.0.</p>&#x000A;<p data-sourcepos="1300:1-1302:76" dir="auto">NOTE: <strong>Note:</strong>&#x000A;The <code>cache:key</code> variable cannot contain the <code>/</code> character, or the equivalent&#x000A;URI-encoded <code>%2F</code>; a value made only of dots (<code>.</code>, <code>%2E</code>) is also forbidden.</p>&#x000A;<p data-sourcepos="1304:1-1304:42" dir="auto">For example, to enable per-branch caching:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$CI_COMMIT_REF_SLUG"</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1313:1-1314:13" dir="auto">If you use <strong>Windows Batch</strong> to run your shell scripts you need to replace&#x000A;<code>$</code> with <code>%</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%CI_COMMIT_REF_SLUG%"</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<h4 data-sourcepos="1323:1-1323:22" dir="auto">&#x000A;<a id="user-content-cacheuntracked" class="anchor" href="#cacheuntracked" aria-hidden="true"></a><code>cache:untracked</code>&#x000A;</h4>&#x000A;<p data-sourcepos="1325:1-1326:11" dir="auto">Set <code>untracked: true</code> to cache all files that are untracked in your Git&#x000A;repository:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">untracked</span><span class="pi">:</span> <span class="no">true</span></span></code></pre>&#x000A;<p data-sourcepos="1335:1-1335:54" dir="auto">Cache all Git untracked files and files in <code>binaries</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">untracked</span><span class="pi">:</span> <span class="no">true</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<h4 data-sourcepos="1346:1-1346:19" dir="auto">&#x000A;<a id="user-content-cachepolicy" class="anchor" href="#cachepolicy" aria-hidden="true"></a><code>cache:policy</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1348:1-1348:27" dir="auto">&#x000A;<p data-sourcepos="1348:3-1348:27">Introduced in GitLab 9.4.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1350:1-1353:7" dir="auto">The default behaviour of a caching job is to download the files at the start of&#x000A;execution, and to re-upload them at the end. This allows any changes made by the&#x000A;job to be persisted for future runs, and is known as the <code>pull-push</code> cache&#x000A;policy.</p>&#x000A;<p data-sourcepos="1355:1-1358:29" dir="auto">If you know the job doesn't alter the cached files, you can skip the upload step&#x000A;by setting <code>policy: pull</code> in the job specification. Typically, this would be&#x000A;twinned with an ordinary cache job at an earlier stage to ensure the cache&#x000A;is updated from time to time:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">setup</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">test</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">prepare</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">setup</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="na">key</span><span class="pi">:</span> <span class="s">gems</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">vendor/bundle</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle install --deployment</span></span>&#x000A;<span id="LC13" class="line" lang="yaml"></span>&#x000A;<span id="LC14" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">    <span class="na">key</span><span class="pi">:</span> <span class="s">gems</span></span>&#x000A;<span id="LC18" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC19" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">vendor/bundle</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">    <span class="na">policy</span><span class="pi">:</span> <span class="s">pull</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC22" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle exec rspec ...</span></span></code></pre>&#x000A;<p data-sourcepos="1385:1-1387:9" dir="auto">This helps to speed up job execution and reduce load on the cache server,&#x000A;especially when you have a large number of cache-using jobs executing in&#x000A;parallel.</p>&#x000A;<p data-sourcepos="1389:1-1391:23" dir="auto">Additionally, if you have a job that unconditionally recreates the cache without&#x000A;reference to its previous contents, you can use <code>policy: push</code> in that job to&#x000A;skip the download step.</p>&#x000A;<h3 data-sourcepos="1393:1-1393:15" dir="auto">&#x000A;<a id="user-content-artifacts" class="anchor" href="#artifacts" aria-hidden="true"></a><code>artifacts</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1395:1-1399:68" dir="auto">&#x000A;<ul data-sourcepos="1395:3-1399:68">&#x000A;<li data-sourcepos="1395:3-1395:65">Introduced in GitLab Runner v0.7.0 for non-Windows platforms.</li>&#x000A;<li data-sourcepos="1396:3-1396:55">Windows support was added in GitLab Runner v.1.0.0.</li>&#x000A;<li data-sourcepos="1397:3-1397:58">From GitLab 9.2, caches are restored before artifacts.</li>&#x000A;<li data-sourcepos="1398:3-1398:101">Not all executors are <a href="https://docs.gitlab.com/runner/executors/#compatibility-chart" rel="nofollow noreferrer noopener" target="_blank">supported</a>.</li>&#x000A;<li data-sourcepos="1399:3-1399:68">Job artifacts are only collected for successful jobs by default.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1401:1-1402:73" dir="auto"><code>artifacts</code> is used to specify a list of files and directories which should be&#x000A;attached to the job when it <a href="#artifactswhen">succeeds, fails, or always</a>.</p>&#x000A;<p data-sourcepos="1404:1-1405:43" dir="auto">The artifacts will be sent to GitLab after the job finishes and will&#x000A;be available for download in the GitLab UI.</p>&#x000A;<p data-sourcepos="1407:1-1407:75" dir="auto"><a href="../../user/project/pipelines/job_artifacts.md">Read more about artifacts</a>.</p>&#x000A;<h4 data-sourcepos="1409:1-1409:22" dir="auto">&#x000A;<a id="user-content-artifactspaths" class="anchor" href="#artifactspaths" aria-hidden="true"></a><code>artifacts:paths</code>&#x000A;</h4>&#x000A;<p data-sourcepos="1411:1-1412:170" dir="auto">You can only use paths that are within the project workspace.&#x000A;Wildcards can be used that follow the <a href="https://en.wikipedia.org/wiki/Glob_(programming)" rel="nofollow noreferrer noopener" target="_blank">glob</a> patterns and <a href="https://golang.org/pkg/path/filepath/#Match" rel="nofollow noreferrer noopener" target="_blank">filepath.Match</a>.</p>&#x000A;<p data-sourcepos="1414:1-1414:76" dir="auto">To pass artifacts between different jobs, see <a href="#dependencies">dependencies</a>.</p>&#x000A;<p data-sourcepos="1416:1-1416:43" dir="auto">Send all files in <code>binaries</code> and <code>.config</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">binaries/</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">.config</span></span></code></pre>&#x000A;<p data-sourcepos="1425:1-1425:85" dir="auto">To disable artifact passing, define the job with empty <a href="#dependencies">dependencies</a>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make build</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">dependencies</span><span class="pi">:</span> <span class="pi">[]</span></span></code></pre>&#x000A;<p data-sourcepos="1434:1-1435:52" dir="auto">You may want to create artifacts only for tagged releases to avoid filling the&#x000A;build server storage with temporary build artifacts.</p>&#x000A;<p data-sourcepos="1437:1-1437:73" dir="auto">Create artifacts only for tags (<code>default-job</code> will not create artifacts):</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">default-job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mvn test -U</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">except</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">tags</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="na">release-job</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mvn package -U</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">target/*.war</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">tags</span></span></code></pre>&#x000A;<h4 data-sourcepos="1456:1-1456:21" dir="auto">&#x000A;<a id="user-content-artifactsname" class="anchor" href="#artifactsname" aria-hidden="true"></a><code>artifacts:name</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1458:1-1458:52" dir="auto">&#x000A;<p data-sourcepos="1458:3-1458:52">Introduced in GitLab 8.6 and GitLab Runner v1.1.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1460:1-1464:79" dir="auto">The <code>name</code> directive allows you to define the name of the created artifacts&#x000A;archive. That way, you can have a unique name for every archive which could be&#x000A;useful when you'd like to download the archive from GitLab. The <code>artifacts:name</code>&#x000A;variable can make use of any of the <a href="../variables/README.md">predefined variables</a>.&#x000A;The default name is <code>artifacts</code>, which becomes <code>artifacts.zip</code> when downloaded.</p>&#x000A;<p data-sourcepos="1466:1-1469:67" dir="auto">NOTE: <strong>Note:</strong>&#x000A;If your branch-name contains forward slashes&#x000A;(e.g. <code>feature/my-feature</code>) it is advised to use <code>$CI_COMMIT_REF_SLUG</code>&#x000A;instead of <code>$CI_COMMIT_REF_NAME</code> for proper naming of the artifact.</p>&#x000A;<p data-sourcepos="1471:1-1471:52" dir="auto">To create an archive with a name of the current job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$CI_JOB_NAME"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1481:1-1482:23" dir="auto">To create an archive with a name of the current branch or tag including only&#x000A;the binaries directory:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$CI_COMMIT_REF_NAME"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1492:1-1493:42" dir="auto">To create an archive with a name of the current job and the current branch or&#x000A;tag including only the binaries directory:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$CI_JOB_NAME-$CI_COMMIT_REF_NAME"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1503:1-1503:81" dir="auto">To create an archive with a name of the current <a href="#stages">stage</a> and branch name:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$CI_JOB_STAGE-$CI_COMMIT_REF_NAME"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<hr data-sourcepos="1513:1-1514:0">&#x000A;<p data-sourcepos="1515:1-1516:13" dir="auto">If you use <strong>Windows Batch</strong> to run your shell scripts you need to replace&#x000A;<code>$</code> with <code>%</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%CI_JOB_STAGE%-%CI_COMMIT_REF_NAME%"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<p data-sourcepos="1526:1-1527:17" dir="auto">If you use <strong>Windows PowerShell</strong> to run your shell scripts you need to replace&#x000A;<code>$</code> with <code>$env:</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$env:CI_JOB_STAGE-$env:CI_COMMIT_REF_NAME"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<h4 data-sourcepos="1537:1-1537:26" dir="auto">&#x000A;<a id="user-content-artifactsuntracked" class="anchor" href="#artifactsuntracked" aria-hidden="true"></a><code>artifacts:untracked</code>&#x000A;</h4>&#x000A;<p data-sourcepos="1539:1-1540:43" dir="auto"><code>artifacts:untracked</code> is used to add all Git untracked files as artifacts (along&#x000A;to the paths defined in <code>artifacts:paths</code>).</p>&#x000A;<p data-sourcepos="1542:1-1543:82" dir="auto">NOTE: <strong>Note:</strong>&#x000A;<code>artifacts:untracked</code> ignores configuration in the repository's <code>.gitignore</code> file.</p>&#x000A;<p data-sourcepos="1545:1-1545:29" dir="auto">Send all Git untracked files:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">untracked</span><span class="pi">:</span> <span class="no">true</span></span></code></pre>&#x000A;<p data-sourcepos="1552:1-1552:53" dir="auto">Send all Git untracked files and files in <code>binaries</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">untracked</span><span class="pi">:</span> <span class="no">true</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">binaries/</span></span></code></pre>&#x000A;<h4 data-sourcepos="1561:1-1561:21" dir="auto">&#x000A;<a id="user-content-artifactswhen" class="anchor" href="#artifactswhen" aria-hidden="true"></a><code>artifacts:when</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1563:1-1563:52" dir="auto">&#x000A;<p data-sourcepos="1563:3-1563:52">Introduced in GitLab 8.9 and GitLab Runner v1.3.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1565:1-1566:8" dir="auto"><code>artifacts:when</code> is used to upload artifacts on job failure or despite the&#x000A;failure.</p>&#x000A;<p data-sourcepos="1568:1-1568:59" dir="auto"><code>artifacts:when</code> can be set to one of the following values:</p>&#x000A;<ol data-sourcepos="1570:1-1573:0" dir="auto">&#x000A;<li data-sourcepos="1570:1-1570:83">&#x000A;<code>on_success</code> - upload artifacts only when the job succeeds. This is the default.</li>&#x000A;<li data-sourcepos="1571:1-1571:59">&#x000A;<code>on_failure</code> - upload artifacts only when the job fails.</li>&#x000A;<li data-sourcepos="1572:1-1573:0">&#x000A;<code>always</code> - upload artifacts regardless of the job status.</li>&#x000A;</ol>&#x000A;<p data-sourcepos="1574:1-1574:40" dir="auto">To upload artifacts only when job fails:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">when</span><span class="pi">:</span> <span class="s">on_failure</span></span></code></pre>&#x000A;<h4 data-sourcepos="1582:1-1582:26" dir="auto">&#x000A;<a id="user-content-artifactsexpire_in" class="anchor" href="#artifactsexpire_in" aria-hidden="true"></a><code>artifacts:expire_in</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1584:1-1584:52" dir="auto">&#x000A;<p data-sourcepos="1584:3-1584:52">Introduced in GitLab 8.9 and GitLab Runner v1.3.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1586:1-1590:44" dir="auto"><code>expire_in</code> allows you to specify how long artifacts should live before they&#x000A;expire and therefore deleted, counting from the time they are uploaded and&#x000A;stored on GitLab. If the expiry time is not defined, it defaults to the&#x000A;<a href="../../user/admin_area/settings/continuous_integration.md#default-artifacts-expiration-core-only">instance wide setting</a>&#x000A;(30 days by default, forever on GitLab.com).</p>&#x000A;<p data-sourcepos="1592:1-1593:23" dir="auto">You can use the <strong>Keep</strong> button on the job page to override expiration and&#x000A;keep artifacts forever.</p>&#x000A;<p data-sourcepos="1595:1-1596:31" dir="auto">After their expiry, artifacts are deleted hourly by default (via a cron job),&#x000A;and are not accessible anymore.</p>&#x000A;<p data-sourcepos="1598:1-1599:38" dir="auto">The value of <code>expire_in</code> is an elapsed time in seconds, unless a unit is&#x000A;provided. Examples of parsable values:</p>&#x000A;<ul data-sourcepos="1601:1-1608:0" dir="auto">&#x000A;<li data-sourcepos="1601:1-1601:6">'42'</li>&#x000A;<li data-sourcepos="1602:1-1602:16">'3 mins 4 sec'</li>&#x000A;<li data-sourcepos="1603:1-1603:16">'2 hrs 20 min'</li>&#x000A;<li data-sourcepos="1604:1-1604:11">'2h20min'</li>&#x000A;<li data-sourcepos="1605:1-1605:15">'6 mos 1 day'</li>&#x000A;<li data-sourcepos="1606:1-1606:23">'47 yrs 6 mos and 4d'</li>&#x000A;<li data-sourcepos="1607:1-1608:0">'3 weeks and 2 days'</li>&#x000A;</ul>&#x000A;<p data-sourcepos="1609:1-1609:48" dir="auto">To expire artifacts 1 week after being uploaded:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">expire_in</span><span class="pi">:</span> <span class="s">1 week</span></span></code></pre>&#x000A;<h4 data-sourcepos="1617:1-1617:24" dir="auto">&#x000A;<a id="user-content-artifactsreports" class="anchor" href="#artifactsreports" aria-hidden="true"></a><code>artifacts:reports</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="1619:1-1620:51" dir="auto">&#x000A;<p data-sourcepos="1619:3-1620:51"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/20390" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in&#x000A;GitLab 11.2. Requires GitLab Runner 11.2 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1622:1-1624:50" dir="auto">The <code>reports</code> keyword is used for collecting test reports from jobs and&#x000A;exposing them in GitLab's UI (merge requests, pipeline views). Read how to use&#x000A;this with <a href="#artifactsreportsjunit">JUnit reports</a>.</p>&#x000A;<p data-sourcepos="1626:1-1629:25" dir="auto">NOTE: <strong>Note:</strong>&#x000A;The test reports are collected regardless of the job results (success or failure).&#x000A;You can use <a href="#artifactsexpire_in"><code>artifacts:expire_in</code></a> to set up an expiration&#x000A;date for their artifacts.</p>&#x000A;<p data-sourcepos="1631:1-1633:45" dir="auto">NOTE: <strong>Note:</strong>&#x000A;If you also want the ability to browse the report output files, include the&#x000A;<a href="#artifactspaths"><code>artifacts:paths</code></a> keyword.</p>&#x000A;<h5 data-sourcepos="1635:1-1635:31" dir="auto">&#x000A;<a id="user-content-artifactsreportsjunit" class="anchor" href="#artifactsreportsjunit" aria-hidden="true"></a><code>artifacts:reports:junit</code>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1637:1-1638:51" dir="auto">&#x000A;<p data-sourcepos="1637:3-1638:51"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/20390" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in&#x000A;GitLab 11.2. Requires GitLab Runner 11.2 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1640:1-1643:45" dir="auto">The <code>junit</code> report collects <a href="https://www.ibm.com/support/knowledgecenter/en/SSQ2R2_14.1.0/com.ibm.rsar.analysis.codereview.cobol.doc/topics/cac_useresults_junit.html" rel="nofollow noreferrer noopener" target="_blank">JUnit XML files</a>&#x000A;as artifacts. Although JUnit was originally developed in Java, there are many&#x000A;<a href="https://en.wikipedia.org/wiki/JUnit#Ports" rel="nofollow noreferrer noopener" target="_blank">third party ports</a> for other&#x000A;languages like JavaScript, Python, Ruby, etc.</p>&#x000A;<p data-sourcepos="1645:1-1646:79" dir="auto">See <a href="../junit_test_reports.md">JUnit test reports</a> for more details and examples.&#x000A;Below is an example of collecting a JUnit XML file from Ruby's RSpec test tool:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">bundle install</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">rspec --format RspecJunitFormatter --out rspec.xml</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="na">reports</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="na">junit</span><span class="pi">:</span> <span class="s">rspec.xml</span></span></code></pre>&#x000A;<p data-sourcepos="1659:1-1660:41" dir="auto">The collected JUnit reports will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests.</p>&#x000A;<p data-sourcepos="1662:1-1667:68" dir="auto">NOTE: <strong>Note:</strong>&#x000A;In case the JUnit tool you use exports to multiple XML files, you can specify&#x000A;multiple test report paths within a single job and they will be automatically&#x000A;concatenated into a single file. Use a filename pattern (<code>junit: rspec-*.xml</code>),&#x000A;an array of filenames (<code>junit: [rspec-1.xml, rspec-2.xml, rspec-3.xml]</code>), or a&#x000A;combination thereof (<code>junit: [rspec.xml, test-results/TEST-*.xml]</code>).</p>&#x000A;<h5 data-sourcepos="1669:1-1669:51" dir="auto">&#x000A;<a id="user-content-artifactsreportscodequality-starter" class="anchor" href="#artifactsreportscodequality-starter" aria-hidden="true"></a><code>artifacts:reports:codequality</code> <strong>(STARTER)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1671:1-1671:67" dir="auto">&#x000A;<p data-sourcepos="1671:3-1671:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1673:1-1674:13" dir="auto">The <code>codequality</code> report collects <a href="../../user/project/merge_requests/code_quality.md">CodeQuality issues</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1676:1-1677:41" dir="auto">The collected Code Quality report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests.</p>&#x000A;<h5 data-sourcepos="1679:1-1679:45" dir="auto">&#x000A;<a id="user-content-artifactsreportssast-ultimate" class="anchor" href="#artifactsreportssast-ultimate" aria-hidden="true"></a><code>artifacts:reports:sast</code> <strong>(ULTIMATE)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1681:1-1681:67" dir="auto">&#x000A;<p data-sourcepos="1681:3-1681:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1683:1-1684:13" dir="auto">The <code>sast</code> report collects <a href="../../user/application_security/sast/index.md">SAST vulnerabilities</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1686:1-1688:11" dir="auto">The collected SAST report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests, pipeline view and provide data for security&#x000A;dashboards.</p>&#x000A;<h5 data-sourcepos="1690:1-1690:60" dir="auto">&#x000A;<a id="user-content-artifactsreportsdependency_scanning-ultimate" class="anchor" href="#artifactsreportsdependency_scanning-ultimate" aria-hidden="true"></a><code>artifacts:reports:dependency_scanning</code> <strong>(ULTIMATE)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1692:1-1692:67" dir="auto">&#x000A;<p data-sourcepos="1692:3-1692:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1694:1-1695:13" dir="auto">The <code>dependency_scanning</code> report collects <a href="../../user/application_security/dependency_scanning/index.md">Dependency Scanning vulnerabilities</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1697:1-1699:11" dir="auto">The collected Dependency Scanning report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests, pipeline view and provide data for security&#x000A;dashboards.</p>&#x000A;<h5 data-sourcepos="1701:1-1701:59" dir="auto">&#x000A;<a id="user-content-artifactsreportscontainer_scanning-ultimate" class="anchor" href="#artifactsreportscontainer_scanning-ultimate" aria-hidden="true"></a><code>artifacts:reports:container_scanning</code> <strong>(ULTIMATE)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1703:1-1703:67" dir="auto">&#x000A;<p data-sourcepos="1703:3-1703:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1705:1-1706:13" dir="auto">The <code>container_scanning</code> report collects <a href="../../user/application_security/container_scanning/index.md">Container Scanning vulnerabilities</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1708:1-1710:11" dir="auto">The collected Container Scanning report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests, pipeline view and provide data for security&#x000A;dashboards.</p>&#x000A;<h5 data-sourcepos="1712:1-1712:45" dir="auto">&#x000A;<a id="user-content-artifactsreportsdast-ultimate" class="anchor" href="#artifactsreportsdast-ultimate" aria-hidden="true"></a><code>artifacts:reports:dast</code> <strong>(ULTIMATE)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1714:1-1714:67" dir="auto">&#x000A;<p data-sourcepos="1714:3-1714:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1716:1-1717:13" dir="auto">The <code>dast</code> report collects <a href="../../user/application_security/dast/index.md">DAST vulnerabilities</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1719:1-1721:11" dir="auto">The collected DAST report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests, pipeline view and provide data for security&#x000A;dashboards.</p>&#x000A;<h5 data-sourcepos="1723:1-1723:59" dir="auto">&#x000A;<a id="user-content-artifactsreportslicense_management-ultimate" class="anchor" href="#artifactsreportslicense_management-ultimate" aria-hidden="true"></a><code>artifacts:reports:license_management</code> <strong>(ULTIMATE)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1725:1-1725:67" dir="auto">&#x000A;<p data-sourcepos="1725:3-1725:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1727:1-1728:13" dir="auto">The <code>license_management</code> report collects <a href="../../user/application_security/license_compliance/index.md">Licenses</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1730:1-1732:11" dir="auto">The collected License Compliance report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests, pipeline view and provide data for security&#x000A;dashboards.</p>&#x000A;<h5 data-sourcepos="1734:1-1734:51" dir="auto">&#x000A;<a id="user-content-artifactsreportsperformance-premium" class="anchor" href="#artifactsreportsperformance-premium" aria-hidden="true"></a><code>artifacts:reports:performance</code> <strong>(PREMIUM)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1736:1-1736:67" dir="auto">&#x000A;<p data-sourcepos="1736:3-1736:67">Introduced in GitLab 11.5. Requires GitLab Runner 11.5 and above.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1738:1-1739:13" dir="auto">The <code>performance</code> report collects <a href="../../user/project/merge_requests/browser_performance_testing.md">Performance metrics</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1741:1-1742:41" dir="auto">The collected Performance report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests.</p>&#x000A;<h5 data-sourcepos="1744:1-1744:47" dir="auto">&#x000A;<a id="user-content-artifactsreportsmetrics-premium" class="anchor" href="#artifactsreportsmetrics-premium" aria-hidden="true"></a><code>artifacts:reports:metrics</code> <strong>(PREMIUM)</strong>&#x000A;</h5>&#x000A;<blockquote data-sourcepos="1746:1-1746:29" dir="auto">&#x000A;<p data-sourcepos="1746:3-1746:29">Introduced in GitLab 11.10.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1748:1-1749:13" dir="auto">The <code>metrics</code> report collects <a href="../../ci/metrics_reports.md">Metrics</a>&#x000A;as artifacts.</p>&#x000A;<p data-sourcepos="1751:1-1752:41" dir="auto">The collected Metrics report will be uploaded to GitLab as an artifact and will&#x000A;be automatically shown in merge requests.</p>&#x000A;<h3 data-sourcepos="1754:1-1754:18" dir="auto">&#x000A;<a id="user-content-dependencies" class="anchor" href="#dependencies" aria-hidden="true"></a><code>dependencies</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1756:1-1756:52" dir="auto">&#x000A;<p data-sourcepos="1756:3-1756:52">Introduced in GitLab 8.6 and GitLab Runner v1.1.1.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1758:1-1759:66" dir="auto">This feature should be used in conjunction with <a href="#artifacts"><code>artifacts</code></a> and&#x000A;allows you to define the artifacts to pass between different jobs.</p>&#x000A;<p data-sourcepos="1761:1-1761:80" dir="auto">Note that <code>artifacts</code> from all previous <a href="#stages">stages</a> are passed by default.</p>&#x000A;<p data-sourcepos="1763:1-1769:69" dir="auto">To use this feature, define <code>dependencies</code> in context of the job and pass&#x000A;a list of all previous jobs from which the artifacts should be downloaded.&#x000A;You can only define jobs from stages that are executed before the current one.&#x000A;An error will be shown if you define jobs from the current stage or next ones.&#x000A;Defining an empty array will skip downloading any artifacts for that job.&#x000A;The status of the previous job is not considered when using <code>dependencies</code>, so&#x000A;if it failed or it is a manual job that was not run, no error occurs.</p>&#x000A;<hr data-sourcepos="1771:1-1772:0">&#x000A;<p data-sourcepos="1773:1-1776:50" dir="auto">In the following example, we define two jobs with artifacts, <code>build:osx</code> and&#x000A;<code>build:linux</code>. When the <code>test:osx</code> is executed, the artifacts from <code>build:osx</code>&#x000A;will be downloaded and extracted in the context of the build. The same happens&#x000A;for <code>test:linux</code> and artifacts from <code>build:linux</code>.</p>&#x000A;<p data-sourcepos="1778:1-1779:32" dir="auto">The job <code>deploy</code> will download artifacts from all previous jobs because of&#x000A;the <a href="#stages">stage</a> precedence:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">build:osx:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span> <span class="s">make build:osx</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="s">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span>&#x000A;<span id="LC7" class="line" lang="yaml"></span>&#x000A;<span id="LC8" class="line" lang="yaml"><span class="s">build:linux:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span> <span class="s">make build:linux</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="s">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">binaries/</span></span>&#x000A;<span id="LC14" class="line" lang="yaml"></span>&#x000A;<span id="LC15" class="line" lang="yaml"><span class="s">test:osx:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span> <span class="s">make test:osx</span></span>&#x000A;<span id="LC18" class="line" lang="yaml">  <span class="s">dependencies</span><span class="pi">:</span></span>&#x000A;<span id="LC19" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">build:osx</span></span>&#x000A;<span id="LC20" class="line" lang="yaml"></span>&#x000A;<span id="LC21" class="line" lang="yaml"><span class="s">test:linux:</span></span>&#x000A;<span id="LC22" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC23" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span> <span class="s">make test:linux</span></span>&#x000A;<span id="LC24" class="line" lang="yaml">  <span class="s">dependencies</span><span class="pi">:</span></span>&#x000A;<span id="LC25" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">build:linux</span></span>&#x000A;<span id="LC26" class="line" lang="yaml"></span>&#x000A;<span id="LC27" class="line" lang="yaml"><span class="na">deploy</span><span class="pi">:</span></span>&#x000A;<span id="LC28" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC29" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">make deploy</span></span></code></pre>&#x000A;<h4 data-sourcepos="1813:1-1813:35" dir="auto">&#x000A;<a id="user-content-when-a-dependent-job-will-fail" class="anchor" href="#when-a-dependent-job-will-fail" aria-hidden="true"></a>When a dependent job will fail</h4>&#x000A;<blockquote data-sourcepos="1815:1-1815:28" dir="auto">&#x000A;<p data-sourcepos="1815:3-1815:28">Introduced in GitLab 10.3.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1817:1-1820:28" dir="auto">If the artifacts of the job that is set as a dependency have been&#x000A;<a href="#artifactsexpire_in">expired</a> or&#x000A;<a href="../../user/project/pipelines/job_artifacts.md#erasing-artifacts">erased</a>, then&#x000A;the dependent job will fail.</p>&#x000A;<p data-sourcepos="1822:1-1825:32" dir="auto">NOTE: <strong>Note:</strong>&#x000A;You can ask your administrator to&#x000A;<a href="../../administration/job_artifacts.md#validation-for-dependencies">flip this switch</a>&#x000A;and bring back the old behavior.</p>&#x000A;<h3 data-sourcepos="1827:1-1827:11" dir="auto">&#x000A;<a id="user-content-needs" class="anchor" href="#needs" aria-hidden="true"></a><code>needs</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1829:1-1830:83" dir="auto">&#x000A;<ul data-sourcepos="1829:3-1830:83">&#x000A;<li data-sourcepos="1829:3-1829:88">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/47063" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 12.2.</li>&#x000A;<li data-sourcepos="1830:3-1830:83">In GitLab 12.3, maximum number of jobs in <code>needs</code> array raised from five to 50.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1832:1-1833:88" dir="auto">The <code>needs:</code> keyword enables executing jobs out-of-order, allowing you to implement&#x000A;a <a href="../directed_acyclic_graph/index.md">directed acyclic graph</a> in your <code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="1835:1-1836:53" dir="auto">This lets you run some jobs without waiting for other ones, disregarding stage ordering&#x000A;so you can have multiple stages running concurrently.</p>&#x000A;<p data-sourcepos="1838:1-1838:37" dir="auto">Let's consider the following example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">linux:build:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="s">mac:build:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">build</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="s">linux:rspec:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="s">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">linux:build"</span><span class="pi">]</span></span>&#x000A;<span id="LC10" class="line" lang="yaml"></span>&#x000A;<span id="LC11" class="line" lang="yaml"><span class="s">linux:rubocop:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">  <span class="s">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">linux:build"</span><span class="pi">]</span></span>&#x000A;<span id="LC14" class="line" lang="yaml"></span>&#x000A;<span id="LC15" class="line" lang="yaml"><span class="s">mac:rspec:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="s">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">mac:build"</span><span class="pi">]</span></span>&#x000A;<span id="LC18" class="line" lang="yaml"></span>&#x000A;<span id="LC19" class="line" lang="yaml"><span class="s">mac:rubocop:</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="s">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">  <span class="s">needs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">mac:build"</span><span class="pi">]</span></span>&#x000A;<span id="LC22" class="line" lang="yaml"></span>&#x000A;<span id="LC23" class="line" lang="yaml"><span class="na">production</span><span class="pi">:</span></span>&#x000A;<span id="LC24" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span></code></pre>&#x000A;<p data-sourcepos="1867:1-1867:46" dir="auto">This example creates three paths of execution:</p>&#x000A;<ul data-sourcepos="1869:1-1878:0" dir="auto">&#x000A;<li data-sourcepos="1869:1-1871:0">&#x000A;<p data-sourcepos="1869:3-1870:78">Linux path: the <code>linux:rspec</code> and <code>linux:rubocop</code> jobs will be run as soon&#x000A;as the <code>linux:build</code> job finishes without waiting for <code>mac:build</code> to finish.</p>&#x000A;</li>&#x000A;<li data-sourcepos="1872:1-1874:0">&#x000A;<p data-sourcepos="1872:3-1873:79">macOS path: the <code>mac:rspec</code> and <code>mac:rubocop</code> jobs will be run as soon&#x000A;as the <code>mac:build</code> job finishes, without waiting for <code>linux:build</code> to finish.</p>&#x000A;</li>&#x000A;<li data-sourcepos="1875:1-1878:0">&#x000A;<p data-sourcepos="1875:3-1877:42">The <code>production</code> job will be executed as soon as all previous jobs&#x000A;finish; in this case: <code>linux:build</code>, <code>linux:rspec</code>, <code>linux:rubocop</code>,&#x000A;<code>mac:build</code>, <code>mac:rspec</code>, <code>mac:rubocop</code>.</p>&#x000A;</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="1879:1-1879:33" dir="auto">&#x000A;<a id="user-content-requirements-and-limitations" class="anchor" href="#requirements-and-limitations" aria-hidden="true"></a>Requirements and limitations</h4>&#x000A;<ul data-sourcepos="1881:1-1901:0" dir="auto">&#x000A;<li data-sourcepos="1881:1-1883:43">If <code>needs:</code> is set to point to a job that is not instantiated&#x000A;because of <code>only/except</code> rules or otherwise does not exist, the&#x000A;pipeline will be created with YAML error.</li>&#x000A;<li data-sourcepos="1884:1-1890:62">We are temporarily limiting the maximum number of jobs that a single job can&#x000A;need in the <code>needs:</code> array:&#x000A;<ul data-sourcepos="1886:3-1890:62">&#x000A;<li data-sourcepos="1886:3-1887:94">For GitLab.com, the limit is five. For more information, see our&#x000A;<a href="https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/7541" rel="nofollow noreferrer noopener" target="_blank">infrastructure issue</a>.</li>&#x000A;<li data-sourcepos="1888:3-1890:62">For self-managed instances, the limit is:&#x000A;<ul data-sourcepos="1889:5-1890:62">&#x000A;<li data-sourcepos="1889:5-1889:69">Five by default (<code>ci_dag_limit_needs</code> feature flag is enabled).</li>&#x000A;<li data-sourcepos="1890:5-1890:62">50 if the <code>ci_dag_limit_needs</code> feature flag is disabled.</li>&#x000A;</ul>&#x000A;</li>&#x000A;</ul>&#x000A;</li>&#x000A;<li data-sourcepos="1891:1-1893:101">It is impossible for now to have <code>needs: []</code> (empty needs),&#x000A;the job always needs to depend on something, unless this is the job&#x000A;in the first stage (see <a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/65504" rel="nofollow noreferrer noopener" target="_blank">gitlab-ce#65504</a>).</li>&#x000A;<li data-sourcepos="1894:1-1895:59">If <code>needs:</code> refers to a job that is marked as <code>parallel:</code>.&#x000A;the current job will depend on all parallel jobs created.</li>&#x000A;<li data-sourcepos="1896:1-1898:134">&#x000A;<code>needs:</code> is similar to <code>dependencies:</code> in that it needs to use jobs from&#x000A;prior stages, meaning it is impossible to create circular&#x000A;dependencies or depend on jobs in the current stage (see <a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/65505" rel="nofollow noreferrer noopener" target="_blank">gitlab-ce#65505</a>).</li>&#x000A;<li data-sourcepos="1899:1-1901:0">Related to the above, stages must be explicitly defined for all jobs&#x000A;that have the keyword <code>needs:</code> or are referred to by one.</li>&#x000A;</ul>&#x000A;<h3 data-sourcepos="1902:1-1902:14" dir="auto">&#x000A;<a id="user-content-coverage" class="anchor" href="#coverage" aria-hidden="true"></a><code>coverage</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1904:1-1904:39" dir="auto">&#x000A;<p data-sourcepos="1904:3-1904:39"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/7447" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 8.17.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1906:1-1907:11" dir="auto"><code>coverage</code> allows you to configure how code coverage will be extracted from the&#x000A;job output.</p>&#x000A;<p data-sourcepos="1909:1-1912:21" dir="auto">Regular expressions are the only valid kind of value expected here. So, using&#x000A;surrounding <code>/</code> is mandatory in order to consistently and explicitly represent&#x000A;a regular expression string. You must escape special characters if you want to&#x000A;match them literally.</p>&#x000A;<p data-sourcepos="1914:1-1914:17" dir="auto">A simple example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">job1</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">coverage</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/Code</span><span class="nv"> </span><span class="s">coverage:</span><span class="nv"> </span><span class="s">\d+\.\d+/'</span></span></code></pre>&#x000A;<h3 data-sourcepos="1922:1-1922:11" dir="auto">&#x000A;<a id="user-content-retry" class="anchor" href="#retry" aria-hidden="true"></a><code>retry</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="1924:1-1925:142" dir="auto">&#x000A;<ul data-sourcepos="1924:3-1925:142">&#x000A;<li data-sourcepos="1924:3-1924:41">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/12909" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 9.5.</li>&#x000A;<li data-sourcepos="1925:3-1925:142">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/21758" rel="nofollow noreferrer noopener" target="_blank">Behaviour expanded</a> in GitLab 11.5 to control on which failures to retry.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="1927:1-1928:18" dir="auto"><code>retry</code> allows you to configure how many times a job is going to be retried in&#x000A;case of a failure.</p>&#x000A;<p data-sourcepos="1930:1-1931:59" dir="auto">When a job fails and has <code>retry</code> configured, it is going to be processed again&#x000A;up to the amount of times specified by the <code>retry</code> keyword.</p>&#x000A;<p data-sourcepos="1933:1-1935:63" dir="auto">If <code>retry</code> is set to 2, and a job succeeds in a second run (first retry), it won't be retried&#x000A;again. <code>retry</code> value has to be a positive integer, equal or larger than 0, but&#x000A;lower or equal to 2 (two retries maximum, three runs in total).</p>&#x000A;<p data-sourcepos="1937:1-1937:47" dir="auto">A simple example to retry in all failure cases:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">retry</span><span class="pi">:</span> <span class="m">2</span></span></code></pre>&#x000A;<p data-sourcepos="1945:1-1946:74" dir="auto">By default, a job will be retried on all failure cases. To have a better control&#x000A;on which failures to retry, <code>retry</code> can be a hash with the following keys:</p>&#x000A;<ul data-sourcepos="1948:1-1950:0" dir="auto">&#x000A;<li data-sourcepos="1948:1-1948:39">&#x000A;<code>max</code>: The maximum number of retries.</li>&#x000A;<li data-sourcepos="1949:1-1950:0">&#x000A;<code>when</code>: The failure cases to retry.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="1951:1-1951:58" dir="auto">To retry only runner system failures at maximum two times:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">retry</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">max</span><span class="pi">:</span> <span class="m">2</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">when</span><span class="pi">:</span> <span class="s">runner_system_failure</span></span></code></pre>&#x000A;<p data-sourcepos="1961:1-1962:15" dir="auto">If there is another failure, other than a runner system failure, the job will&#x000A;not be retried.</p>&#x000A;<p data-sourcepos="1964:1-1964:76" dir="auto">To retry on multiple failure cases, <code>when</code> can also be an array of failures:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">retry</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">max</span><span class="pi">:</span> <span class="m">2</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">when</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">runner_system_failure</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">stuck_or_timeout_failure</span></span></code></pre>&#x000A;<p data-sourcepos="1976:1-1976:31" dir="auto">Possible values for <code>when</code> are:</p>&#x000A;&#x000A;<ul data-sourcepos="1986:1-1994:0" dir="auto">&#x000A;<li data-sourcepos="1986:1-1986:43">&#x000A;<code>always</code>: Retry on any failure (default).</li>&#x000A;<li data-sourcepos="1987:1-1987:62">&#x000A;<code>unknown_failure</code>: Retry when the failure reason is unknown.</li>&#x000A;<li data-sourcepos="1988:1-1988:49">&#x000A;<code>script_failure</code>: Retry when the script failed.</li>&#x000A;<li data-sourcepos="1989:1-1989:38">&#x000A;<code>api_failure</code>: Retry on API failure.</li>&#x000A;<li data-sourcepos="1990:1-1990:72">&#x000A;<code>stuck_or_timeout_failure</code>: Retry when the job got stuck or timed out.</li>&#x000A;<li data-sourcepos="1991:1-1991:103">&#x000A;<code>runner_system_failure</code>: Retry if there was a runner system failure (e.g. setting up the job failed).</li>&#x000A;<li data-sourcepos="1992:1-1992:66">&#x000A;<code>missing_dependency_failure</code>: Retry if a dependency was missing.</li>&#x000A;<li data-sourcepos="1993:1-1994:0">&#x000A;<code>runner_unsupported</code>: Retry if the runner was unsupported.</li>&#x000A;</ul>&#x000A;<h3 data-sourcepos="1995:1-1995:11" dir="auto">&#x000A;<a id="user-content-timeout" class="anchor" href="#timeout" aria-hidden="true"></a>timeout</h3>&#x000A;<p data-sourcepos="1997:1-1997:63" dir="auto"><code>timeout</code> allows you to configure a timeout for a specific job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">build.sh</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">timeout</span><span class="pi">:</span> <span class="s">3 hours 30 minutes</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rspec</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">timeout</span><span class="pi">:</span> <span class="s">3h 30m</span></span></code></pre>&#x000A;<h3 data-sourcepos="2009:1-2009:14" dir="auto">&#x000A;<a id="user-content-parallel" class="anchor" href="#parallel" aria-hidden="true"></a><code>parallel</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2011:1-2011:94" dir="auto">&#x000A;<p data-sourcepos="2011:3-2011:94"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/22631" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 11.5.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2013:1-2014:93" dir="auto"><code>parallel</code> allows you to configure how many instances of a job to run in&#x000A;parallel. This value has to be greater than or equal to two (2) and less than or equal to 50.</p>&#x000A;<p data-sourcepos="2016:1-2017:51" dir="auto">This creates N instances of the same job that run in parallel. They're named&#x000A;sequentially from <code>job_name 1/N</code> to <code>job_name N/N</code>.</p>&#x000A;<p data-sourcepos="2019:1-2019:140" dir="auto">For every job, <code>CI_NODE_INDEX</code> and <code>CI_NODE_TOTAL</code> <a href="../variables/README.md#predefined-environment-variables">environment variables</a> are set.</p>&#x000A;<p data-sourcepos="2021:1-2021:95" dir="auto">Marking a job to be run in parallel requires only a simple addition to your configuration file:</p>&#x000A;<pre class="code highlight js-syntax-highlight diff" lang="diff" v-pre="true"><code><span id="LC1" class="line" lang="diff"> test:</span>&#x000A;<span id="LC2" class="line" lang="diff">   script: rspec</span>&#x000A;<span id="LC3" class="line" lang="diff"><span class="gi">+  parallel: 5</span></span></code></pre>&#x000A;<p data-sourcepos="2029:1-2031:60" dir="auto">TIP: <strong>Tip:</strong>&#x000A;Parallelize tests suites across parallel jobs.&#x000A;Different languages have different tools to facilitate this.</p>&#x000A;<p data-sourcepos="2033:1-2033:129" dir="auto">A simple example using <a href="https://github.com/renderedtext/test-boosters" rel="nofollow noreferrer noopener" target="_blank">Semaphore Test Boosters</a> and RSpec to run some Ruby tests:</p>&#x000A;<pre class="code highlight js-syntax-highlight ruby" lang="ruby" v-pre="true"><code><span id="LC1" class="line" lang="ruby"><span class="c1"># Gemfile</span></span>&#x000A;<span id="LC2" class="line" lang="ruby"><span class="n">source</span> <span class="s1">'https://rubygems.org'</span></span>&#x000A;<span id="LC3" class="line" lang="ruby"></span>&#x000A;<span id="LC4" class="line" lang="ruby"><span class="n">gem</span> <span class="s1">'rspec'</span></span>&#x000A;<span id="LC5" class="line" lang="ruby"><span class="n">gem</span> <span class="s1">'semaphore_test_boosters'</span></span></code></pre>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">parallel</span><span class="pi">:</span> <span class="m">3</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle exec rspec_booster --job $CI_NODE_INDEX/$CI_NODE_TOTAL</span></span></code></pre>&#x000A;<p data-sourcepos="2051:1-2052:85" dir="auto">CAUTION: <strong>Caution:</strong>&#x000A;Please be aware that semaphore_test_boosters reports usages statistics to the author.</p>&#x000A;<p data-sourcepos="2054:1-2055:35" dir="auto">You can then navigate to the <strong>Jobs</strong> tab of a new pipeline build and see your RSpec&#x000A;job split into three separate jobs.</p>&#x000A;<h3 data-sourcepos="2057:1-2057:27" dir="auto">&#x000A;<a id="user-content-trigger-premium" class="anchor" href="#trigger-premium" aria-hidden="true"></a><code>trigger</code> <strong>(PREMIUM)</strong>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2059:1-2059:125" dir="auto">&#x000A;<p data-sourcepos="2059:3-2059:125"><a href="https://gitlab.com/gitlab-org/gitlab/issues/8997" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in <a href="https://about.gitlab.com/pricing/" rel="nofollow noreferrer noopener" target="_blank">GitLab Premium</a> 11.8.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2061:1-2063:8" dir="auto"><code>trigger</code> allows you to define downstream pipeline trigger. When a job created&#x000A;from <code>trigger</code> definition is started by GitLab, a downstream pipeline gets&#x000A;created.</p>&#x000A;<p data-sourcepos="2065:1-2065:125" dir="auto">Learn more about <a href="../multi_project_pipelines.md#creating-multi-project-pipelines-from-gitlab-ciyml">multi-project pipelines</a>.</p>&#x000A;<h4 data-sourcepos="2067:1-2067:28" dir="auto">&#x000A;<a id="user-content-simple-trigger-syntax" class="anchor" href="#simple-trigger-syntax" aria-hidden="true"></a>Simple <code>trigger</code> syntax</h4>&#x000A;<p data-sourcepos="2069:1-2070:41" dir="auto">The most simple way to configure a downstream trigger to use <code>trigger</code> keyword&#x000A;with a full path to a downstream project:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">bundle exec rspec</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">staging</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">trigger</span><span class="pi">:</span> <span class="s">my/deployment</span></span></code></pre>&#x000A;<h4 data-sourcepos="2082:1-2082:29" dir="auto">&#x000A;<a id="user-content-complex-trigger-syntax" class="anchor" href="#complex-trigger-syntax" aria-hidden="true"></a>Complex <code>trigger</code> syntax</h4>&#x000A;<p data-sourcepos="2084:1-2085:27" dir="auto">It is possible to configure a branch name that GitLab will use to create&#x000A;a downstream pipeline with:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">bundle exec rspec</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">staging</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">trigger</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="na">project</span><span class="pi">:</span> <span class="s">my/deployment</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="na">branch</span><span class="pi">:</span> <span class="s">stable</span></span></code></pre>&#x000A;<h3 data-sourcepos="2099:1-2099:19" dir="auto">&#x000A;<a id="user-content-interruptible" class="anchor" href="#interruptible" aria-hidden="true"></a><code>interruptible</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2101:1-2101:94" dir="auto">&#x000A;<p data-sourcepos="2101:3-2101:94"><a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/23464" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 12.3.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2103:1-2105:11" dir="auto"><code>interruptible</code> is used to indicate that a job should be canceled if made redundant by a newer run of the same job. Defaults to <code>false</code>.&#x000A;This value will only be used if the <a href="../../user/project/pipelines/settings.md#auto-cancel-pending-pipelines">automatic cancellation of redundant pipelines feature</a>&#x000A;is enabled.</p>&#x000A;<p data-sourcepos="2107:1-2107:66" dir="auto">When enabled, a pipeline on the same branch will be canceled when:</p>&#x000A;<ul data-sourcepos="2109:1-2111:0" dir="auto">&#x000A;<li data-sourcepos="2109:1-2109:47">It is made redundant by a newer pipeline run.</li>&#x000A;<li data-sourcepos="2110:1-2111:0">Either all jobs are set as interruptible, or any uninterruptible jobs are not yet pending.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2112:1-2112:49" dir="auto">Pending jobs are always considered interruptible.</p>&#x000A;<p data-sourcepos="2114:1-2115:100" dir="auto">TIP: <strong>Tip:</strong>&#x000A;Set jobs as uninterruptible that should behave atomically and should never be canceled once started.</p>&#x000A;<p data-sourcepos="2117:1-2117:25" dir="auto">Here is a simple example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">stage1</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">stage2</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">step-1</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">stage1</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">echo "Can be canceled"</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  </span>&#x000A;<span id="LC10" class="line" lang="yaml"><span class="na">step-2</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">stage2</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">echo "Can not be canceled"</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">interruptible</span><span class="pi">:</span> <span class="no">false</span></span></code></pre>&#x000A;<p data-sourcepos="2136:1-2136:87" dir="auto">In the example above, a new pipeline run will cause an existing running pipeline to be:</p>&#x000A;<ul data-sourcepos="2138:1-2140:0" dir="auto">&#x000A;<li data-sourcepos="2138:1-2138:51">Canceled, if only <code>step-1</code> is running or pending.</li>&#x000A;<li data-sourcepos="2139:1-2140:0">Not canceled, once <code>step-2</code> becomes pending.</li>&#x000A;</ul>&#x000A;<h3 data-sourcepos="2141:1-2141:13" dir="auto">&#x000A;<a id="user-content-include" class="anchor" href="#include" aria-hidden="true"></a><code>include</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2143:1-2145:99" dir="auto">&#x000A;<ul data-sourcepos="2143:3-2145:99">&#x000A;<li data-sourcepos="2143:3-2143:75">Introduced in <a href="https://about.gitlab.com/pricing/" rel="nofollow noreferrer noopener" target="_blank">GitLab Premium</a> 10.5.</li>&#x000A;<li data-sourcepos="2144:3-2144:59">Available for Starter, Premium and Ultimate since 10.6.</li>&#x000A;<li data-sourcepos="2145:3-2145:99">&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/merge_requests/21603" rel="nofollow noreferrer noopener" target="_blank">Moved</a> to GitLab Core in 11.4.</li>&#x000A;</ul>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2147:1-2149:49" dir="auto">Using the <code>include</code> keyword, you can allow the inclusion of external YAML files.&#x000A;<code>include</code> requires the external YAML file to have the extensions <code>.yml</code> or <code>.yaml</code>,&#x000A;otherwise the external file will not be included.</p>&#x000A;<p data-sourcepos="2151:1-2151:35" dir="auto">The files defined in <code>include</code> are:</p>&#x000A;<ul data-sourcepos="2153:1-2156:0" dir="auto">&#x000A;<li data-sourcepos="2153:1-2153:45">Deep merged with those in <code>.gitlab-ci.yml</code>.</li>&#x000A;<li data-sourcepos="2154:1-2156:0">Always evaluated first and merged with the content of <code>.gitlab-ci.yml</code>,&#x000A;regardless of the position of the <code>include</code> keyword.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2157:1-2159:12" dir="auto">TIP: <strong>Tip:</strong>&#x000A;Use merging to customize and override included CI/CD configurations with local&#x000A;definitions.</p>&#x000A;<p data-sourcepos="2161:1-2164:69" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Using YAML aliases across different YAML files sourced by <code>include</code> is not&#x000A;supported. You must only refer to aliases in the same file. Instead&#x000A;of using YAML anchors, you can use the <a href="#extends"><code>extends</code> keyword</a>.</p>&#x000A;<p data-sourcepos="2166:1-2166:40" dir="auto"><code>include</code> supports four include methods:</p>&#x000A;<ul data-sourcepos="2168:1-2172:0" dir="auto">&#x000A;<li data-sourcepos="2168:1-2168:26"><a href="#includelocal"><code>local</code></a></li>&#x000A;<li data-sourcepos="2169:1-2169:24"><a href="#includefile"><code>file</code></a></li>&#x000A;<li data-sourcepos="2170:1-2170:32"><a href="#includetemplate"><code>template</code></a></li>&#x000A;<li data-sourcepos="2171:1-2172:0"><a href="#includeremote"><code>remote</code></a></li>&#x000A;</ul>&#x000A;<p data-sourcepos="2173:1-2173:40" dir="auto">See <a href="#include-examples">usage examples</a>.</p>&#x000A;<p data-sourcepos="2175:1-2178:109" dir="auto">NOTE: <strong>Note:</strong>&#x000A;<code>.gitlab-ci.yml</code> configuration included by all methods is evaluated at pipeline creation.&#x000A;The configuration is a snapshot in time and persisted in the database. Any changes to&#x000A;referenced <code>.gitlab-ci.yml</code> configuration will not be reflected in GitLab until the next pipeline is created.</p>&#x000A;<h4 data-sourcepos="2180:1-2180:20" dir="auto">&#x000A;<a id="user-content-includelocal" class="anchor" href="#includelocal" aria-hidden="true"></a><code>include:local</code>&#x000A;</h4>&#x000A;<p data-sourcepos="2182:1-2183:70" dir="auto"><code>include:local</code> includes a file from the same repository as <code>.gitlab-ci.yml</code>.&#x000A;It's referenced using full paths relative to the root directory (<code>/</code>).</p>&#x000A;<p data-sourcepos="2185:1-2187:74" dir="auto">You can only use files that are currently tracked by Git on the same branch&#x000A;your configuration file is on. In other words, when using a <code>include:local</code>, make&#x000A;sure that both <code>.gitlab-ci.yml</code> and the local file are on the same branch.</p>&#x000A;<p data-sourcepos="2189:1-2190:69" dir="auto">All <a href="#nested-includes">nested includes</a> will be executed in the scope of the same project,&#x000A;so it is possible to use local, project, remote or template includes.</p>&#x000A;<p data-sourcepos="2192:1-2193:68" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Including local files through Git submodules paths is not supported.</p>&#x000A;<p data-sourcepos="2195:1-2195:8" dir="auto">Example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">local</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span></code></pre>&#x000A;<h4 data-sourcepos="2202:1-2202:19" dir="auto">&#x000A;<a id="user-content-includefile" class="anchor" href="#includefile" aria-hidden="true"></a><code>include:file</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="2204:1-2204:86" dir="auto">&#x000A;<p data-sourcepos="2204:3-2204:86"><a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/53903" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 11.7.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2206:1-2208:34" dir="auto">To include files from another private project under the same GitLab instance,&#x000A;use <code>include:file</code>. This file is referenced using full  paths relative to the&#x000A;root directory (<code>/</code>). For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-group/my-project'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2216:1-2216:77" dir="auto">You can also specify <code>ref</code>, with the default being the <code>HEAD</code> of the project:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-group/my-project'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="na">ref</span><span class="pi">:</span> <span class="s">master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span>&#x000A;<span id="LC5" class="line" lang="yaml"></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-group/my-project'</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="na">ref</span><span class="pi">:</span> <span class="s">v1.0.0</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span>&#x000A;<span id="LC9" class="line" lang="yaml"></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-group/my-project'</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="na">ref</span><span class="pi">:</span> <span class="s">787123b47f14b552955ca2786bc9542ae66fee5b</span> <span class="c1"># Git SHA</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2233:1-2235:21" dir="auto">All <a href="#nested-includes">nested includes</a> will be executed in the scope of the target project,&#x000A;so it is possible to use local (relative to target project), project, remote&#x000A;or template includes.</p>&#x000A;<h4 data-sourcepos="2237:1-2237:23" dir="auto">&#x000A;<a id="user-content-includetemplate" class="anchor" href="#includetemplate" aria-hidden="true"></a><code>include:template</code>&#x000A;</h4>&#x000A;<blockquote data-sourcepos="2239:1-2239:86" dir="auto">&#x000A;<p data-sourcepos="2239:3-2239:86"><a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/53445" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 11.7.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2241:1-2242:101" dir="auto"><code>include:template</code> can be used to include <code>.gitlab-ci.yml</code> templates that are&#x000A;<a href="https://gitlab.com/gitlab-org/gitlab-foss/tree/master/lib/gitlab/ci/templates" rel="nofollow noreferrer noopener" target="_blank">shipped with GitLab</a>.</p>&#x000A;<p data-sourcepos="2244:1-2244:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="c1"># File sourced from GitLab's template collection</span></span>&#x000A;<span id="LC2" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Auto-DevOps.gitlab-ci.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2252:1-2252:34" dir="auto">Multiple <code>include:template</code> files:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Android-Fastlane.gitlab-ci.yml</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Auto-DevOps.gitlab-ci.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2260:1-2261:62" dir="auto">All <a href="#nested-includes">nested includes</a> will be executed only with the permission of the user,&#x000A;so it is possible to use project, remote or template includes.</p>&#x000A;<h4 data-sourcepos="2263:1-2263:21" dir="auto">&#x000A;<a id="user-content-includeremote" class="anchor" href="#includeremote" aria-hidden="true"></a><code>include:remote</code>&#x000A;</h4>&#x000A;<p data-sourcepos="2265:1-2268:48" dir="auto"><code>include:remote</code> can be used to include a file from a different location,&#x000A;using HTTP/HTTPS, referenced by using the full URL. The remote file must be&#x000A;publicly accessible through a simple GET request as authentication schemas&#x000A;in the remote URL is not supported. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">remote</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.gitlab-ci-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2275:1-2276:42" dir="auto">All nested includes will be executed without context as public user, so only another remote,&#x000A;or public project, or template is allowed.</p>&#x000A;<h4 data-sourcepos="2278:1-2278:20" dir="auto">&#x000A;<a id="user-content-nested-includes" class="anchor" href="#nested-includes" aria-hidden="true"></a>Nested includes</h4>&#x000A;<blockquote data-sourcepos="2280:1-2280:86" dir="auto">&#x000A;<p data-sourcepos="2280:3-2280:86"><a href="https://gitlab.com/gitlab-org/gitlab-foss/issues/56836" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in GitLab 11.9.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2282:1-2284:56" dir="auto">Nested includes allow you to compose a set of includes.&#x000A;A total of 50 includes is allowed.&#x000A;Duplicate includes are considered a configuration error.</p>&#x000A;<h4 data-sourcepos="2286:1-2286:23" dir="auto">&#x000A;<a id="user-content-include-examples" class="anchor" href="#include-examples" aria-hidden="true"></a><code>include</code> examples</h4>&#x000A;<p data-sourcepos="2288:1-2288:39" dir="auto">Here are a few more <code>include</code> examples.</p>&#x000A;<h5 data-sourcepos="2290:1-2290:47" dir="auto">&#x000A;<a id="user-content-single-string-or-array-of-multiple-values" class="anchor" href="#single-string-or-array-of-multiple-values" aria-hidden="true"></a>Single string or array of multiple values</h5>&#x000A;<p data-sourcepos="2292:1-2293:66" dir="auto">You can include your extra YAML file(s) either as a single string or&#x000A;an array of multiple values. The following examples are all valid.</p>&#x000A;<p data-sourcepos="2295:1-2295:54" dir="auto">Single string with the <code>include:local</code> method implied:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.after-script-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2301:1-2301:36" dir="auto">Array with <code>include</code> method implied:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s1">'</span><span class="s">/templates/.after-script-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2309:1-2309:57" dir="auto">Single string with <code>include</code> method specified explicitly:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">remote</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2316:1-2316:50" dir="auto">Array with <code>include:remote</code> being the single item:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">remote</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span></code></pre>&#x000A;<p data-sourcepos="2323:1-2323:59" dir="auto">Array with multiple <code>include</code> methods specified explicitly:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">remote</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">local</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.after-script-template.yml'</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Auto-DevOps.gitlab-ci.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2332:1-2332:19" dir="auto">Array mixed syntax:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s1">'</span><span class="s">/templates/.after-script-template.yml'</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Auto-DevOps.gitlab-ci.yml</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my-group/my-project'</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">ref</span><span class="pi">:</span> <span class="s">master</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/templates/.gitlab-ci-template.yml'</span></span></code></pre>&#x000A;<h5 data-sourcepos="2344:1-2344:41" dir="auto">&#x000A;<a id="user-content-re-using-a-before_script-template" class="anchor" href="#re-using-a-before_script-template" aria-hidden="true"></a>Re-using a <code>before_script</code> template</h5>&#x000A;<p data-sourcepos="2346:1-2347:79" dir="auto">In the following example, the content of <code>.before-script-template.yml</code> will be&#x000A;automatically fetched and evaluated along with the content of <code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="2349:1-2349:87" dir="auto">Content of <code>https://gitlab.com/awesome-project/raw/master/.before-script-template.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">before_script</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">apt-get update -qq &amp;&amp; apt-get install -y -qq sqlite3 libsqlite3-dev nodejs</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">gem install bundler --no-document</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">bundle install --jobs $(nproc)  "${FLAGS[@]}"</span></span></code></pre>&#x000A;<p data-sourcepos="2358:1-2358:28" dir="auto">Content of <code>.gitlab-ci.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://gitlab.com/awesome-project/raw/master/.before-script-template.yml'</span></span>&#x000A;<span id="LC2" class="line" lang="yaml"></span>&#x000A;<span id="LC3" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle exec rspec</span></span></code></pre>&#x000A;<h5 data-sourcepos="2368:1-2368:41" dir="auto">&#x000A;<a id="user-content-overriding-external-template-values" class="anchor" href="#overriding-external-template-values" aria-hidden="true"></a>Overriding external template values</h5>&#x000A;<p data-sourcepos="2370:1-2371:75" dir="auto">The following example shows specific YAML-defined variables and details of the&#x000A;<code>production</code> job from an include file being customized in <code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="2373:1-2373:57" dir="auto">Content of <code>https://company.com/autodevops-template.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">user</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">testing_password</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">$CI_ENVIRONMENT_SLUG</span></span>&#x000A;<span id="LC5" class="line" lang="yaml"></span>&#x000A;<span id="LC6" class="line" lang="yaml"><span class="na">production</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">production</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">install_dependencies</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">deploy</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="na">name</span><span class="pi">:</span> <span class="s">production</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="na">url</span><span class="pi">:</span> <span class="s">https://$CI_PROJECT_PATH_SLUG.$KUBE_INGRESS_BASE_DOMAIN</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">master</span></span></code></pre>&#x000A;<p data-sourcepos="2393:1-2393:28" dir="auto">Content of <code>.gitlab-ci.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://company.com/autodevops-template.yml'</span></span>&#x000A;<span id="LC2" class="line" lang="yaml"></span>&#x000A;<span id="LC3" class="line" lang="yaml"><span class="na">image</span><span class="pi">:</span> <span class="s">alpine:latest</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">root</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">secure_password</span></span>&#x000A;<span id="LC8" class="line" lang="yaml"></span>&#x000A;<span id="LC9" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">build</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">test</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">production</span></span>&#x000A;<span id="LC13" class="line" lang="yaml"></span>&#x000A;<span id="LC14" class="line" lang="yaml"><span class="na">production</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">  <span class="na">environment</span><span class="pi">:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">    <span class="na">url</span><span class="pi">:</span> <span class="s">https://domain.com</span></span></code></pre>&#x000A;<p data-sourcepos="2414:1-2417:17" dir="auto">In this case, the variables <code>POSTGRES_USER</code> and <code>POSTGRES_PASSWORD</code> along&#x000A;with the environment url of the <code>production</code> job defined in&#x000A;<code>autodevops-template.yml</code> have been overridden by new values defined in&#x000A;<code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="2419:1-2422:22" dir="auto">The merging lets you extend and override dictionary mappings, but&#x000A;you cannot add or modify items to an included array. For example, to add&#x000A;an additional item to the production job script, you must repeat the&#x000A;existing script items:</p>&#x000A;<p data-sourcepos="2424:1-2424:57" dir="auto">Content of <code>https://company.com/autodevops-template.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">production</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">production</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">install_dependencies</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">deploy</span></span></code></pre>&#x000A;<p data-sourcepos="2434:1-2434:28" dir="auto">Content of <code>.gitlab-ci.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://company.com/autodevops-template.yml'</span></span>&#x000A;<span id="LC2" class="line" lang="yaml"></span>&#x000A;<span id="LC3" class="line" lang="yaml"><span class="na">stages</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">production</span></span>&#x000A;<span id="LC5" class="line" lang="yaml"></span>&#x000A;<span id="LC6" class="line" lang="yaml"><span class="na">production</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">install_dependencies</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">deploy</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">notify_owner</span></span></code></pre>&#x000A;<p data-sourcepos="2449:1-2451:37" dir="auto">In this case, if <code>install_dependencies</code> and <code>deploy</code> were not repeated in&#x000A;<code>.gitlab-ci.yml</code>, they would not be part of the script for the <code>production</code>&#x000A;job in the combined CI configuration.</p>&#x000A;<h5 data-sourcepos="2453:1-2453:27" dir="auto">&#x000A;<a id="user-content-using-nested-includes" class="anchor" href="#using-nested-includes" aria-hidden="true"></a>Using nested includes</h5>&#x000A;<p data-sourcepos="2455:1-2456:41" dir="auto">The examples below show how includes can be nested from different sources&#x000A;using a combination of different methods.</p>&#x000A;<p data-sourcepos="2458:1-2458:91" dir="auto">In this example, <code>.gitlab-ci.yml</code> includes local the file <code>/.gitlab-ci/another-config.yml</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">local</span><span class="pi">:</span> <span class="s">/.gitlab-ci/another-config.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2465:1-2466:21" dir="auto">The <code>/.gitlab-ci/another-config.yml</code> includes a template and the <code>/templates/docker-workflow.yml</code> file&#x000A;from another project:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">Bash.gitlab-ci.yml</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">project</span><span class="pi">:</span> <span class="s">group/my-project</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="na">file</span><span class="pi">:</span> <span class="s">/templates/docker-workflow.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2475:1-2476:26" dir="auto">The <code>/templates/docker-workflow.yml</code> present in <code>group/my-project</code> includes two local files&#x000A;of the <code>group/my-project</code>:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">local</span><span class="pi">:</span> <span class="s">/templates/docker-build.yml</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="pi">-</span> <span class="na">local</span><span class="pi">:</span> <span class="s">/templates/docker-testing.yml</span></span></code></pre>&#x000A;<p data-sourcepos="2484:1-2484:90" dir="auto">Our <code>/templates/docker-build.yml</code> present in <code>group/my-project</code> adds a <code>docker-build</code> job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker-build</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker build -t my-image .</span></span></code></pre>&#x000A;<p data-sourcepos="2491:1-2491:95" dir="auto">Our second <code>/templates/docker-test.yml</code> present in <code>group/my-project</code> adds a <code>docker-test</code> job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">docker-test</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">docker run my-image /run/tests.sh</span></span></code></pre>&#x000A;<h3 data-sourcepos="2498:1-2498:13" dir="auto">&#x000A;<a id="user-content-extends" class="anchor" href="#extends" aria-hidden="true"></a><code>extends</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2500:1-2500:28" dir="auto">&#x000A;<p data-sourcepos="2500:3-2500:28">Introduced in GitLab 11.3.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2502:1-2503:13" dir="auto"><code>extends</code> defines entry names that a job that uses <code>extends</code> is going to&#x000A;inherit from.</p>&#x000A;<p data-sourcepos="2505:1-2506:27" dir="auto">It is an alternative to using <a href="#anchors">YAML anchors</a> and is a little&#x000A;more flexible and readable:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.tests</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake test</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">refs</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">branches</span></span>&#x000A;<span id="LC7" class="line" lang="yaml"></span>&#x000A;<span id="LC8" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.tests</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake rspec</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">$RSPEC</span></span></code></pre>&#x000A;<p data-sourcepos="2524:1-2525:72" dir="auto">In the example above, the <code>rspec</code> job inherits from the <code>.tests</code> template job.&#x000A;GitLab will perform a reverse deep merge based on the keys. GitLab will:</p>&#x000A;<ul data-sourcepos="2527:1-2529:0" dir="auto">&#x000A;<li data-sourcepos="2527:1-2527:55">Merge the <code>rspec</code> contents into <code>.tests</code> recursively.</li>&#x000A;<li data-sourcepos="2528:1-2529:0">Not merge the values of the keys.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2530:1-2530:42" dir="auto">This results in the following <code>rspec</code> job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake rspec</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">test</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="na">refs</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">branches</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">$RSPEC</span></span></code></pre>&#x000A;<p data-sourcepos="2543:1-2544:75" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Note that <code>script: rake test</code> has been overwritten by <code>script: rake rspec</code>.</p>&#x000A;<p data-sourcepos="2546:1-2546:117" dir="auto">If you do want to include the <code>rake test</code>, see <a href="#before_script-and-after_script"><code>before_script</code> and <code>after_script</code></a>.</p>&#x000A;<p data-sourcepos="2548:1-2549:46" dir="auto"><code>.tests</code> in this example is a <a href="#hidden-keys-jobs">hidden key</a>, but it's&#x000A;possible to inherit from regular jobs as well.</p>&#x000A;<p data-sourcepos="2551:1-2553:52" dir="auto"><code>extends</code> supports multi-level inheritance, however it is not recommended to&#x000A;use more than three levels. The maximum nesting level that is supported is 10.&#x000A;The following example has two levels of inheritance:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.tests</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">pushes</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="s">.rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.tests</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake rspec</span></span>&#x000A;<span id="LC8" class="line" lang="yaml"></span>&#x000A;<span id="LC9" class="line" lang="yaml"><span class="na">rspec 1</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="na">RSPEC_SUITE</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1'</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.rspec</span></span>&#x000A;<span id="LC13" class="line" lang="yaml"></span>&#x000A;<span id="LC14" class="line" lang="yaml"><span class="na">rspec 2</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">  <span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">    <span class="na">RSPEC_SUITE</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.rspec</span></span>&#x000A;<span id="LC18" class="line" lang="yaml"></span>&#x000A;<span id="LC19" class="line" lang="yaml"><span class="na">spinach</span><span class="pi">:</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.tests</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span> <span class="s">rake spinach</span></span></code></pre>&#x000A;<p data-sourcepos="2579:1-2582:21" dir="auto">In GitLab 12.0 and later, it's also possible to use multiple parents for&#x000A;<code>extends</code>.  The algorithm used for merge is "closest scope wins", so&#x000A;keys from the last member will always shadow anything defined on other&#x000A;levels.  For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.only-important</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">stable</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">production</span></span>&#x000A;<span id="LC7" class="line" lang="yaml"></span>&#x000A;<span id="LC8" class="line" lang="yaml"><span class="s">.in-docker</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">docker</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span></span>&#x000A;<span id="LC12" class="line" lang="yaml"></span>&#x000A;<span id="LC13" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">.only-important</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">.in-docker</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC18" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">rake rspec</span></span></code></pre>&#x000A;<p data-sourcepos="2605:1-2605:42" dir="auto">This results in the following <code>rspec</code> job:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">rspec</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">master</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">stable</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">tags</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">docker</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">rake rspec</span></span></code></pre>&#x000A;<h3 data-sourcepos="2619:1-2619:42" dir="auto">&#x000A;<a id="user-content-using-extends-and-include-together" class="anchor" href="#using-extends-and-include-together" aria-hidden="true"></a>Using <code>extends</code> and <code>include</code> together</h3>&#x000A;<p data-sourcepos="2621:1-2621:67" dir="auto"><code>extends</code> works across configuration files combined with <code>include</code>.</p>&#x000A;<p data-sourcepos="2623:1-2623:53" dir="auto">For example, if you have a local <code>included.yml</code> file:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.template</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">echo Hello!</span></span></code></pre>&#x000A;<p data-sourcepos="2631:1-2631:51" dir="auto">Then, in <code>.gitlab-ci.yml</code> you can use it like this:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">include</span><span class="pi">:</span> <span class="s">included.yml</span></span>&#x000A;<span id="LC2" class="line" lang="yaml"></span>&#x000A;<span id="LC3" class="line" lang="yaml"><span class="na">useTemplate</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">extends</span><span class="pi">:</span> <span class="s">.template</span></span></code></pre>&#x000A;<p data-sourcepos="2641:1-2642:84" dir="auto">This will run a job called <code>useTemplate</code> that runs <code>echo Hello!</code> as defined in&#x000A;the <code>.template</code> job, and uses the <code>alpine</code> Docker image as defined in the local job.</p>&#x000A;<h3 data-sourcepos="2644:1-2644:11" dir="auto">&#x000A;<a id="user-content-pages" class="anchor" href="#pages" aria-hidden="true"></a><code>pages</code>&#x000A;</h3>&#x000A;<p data-sourcepos="2646:1-2648:31" dir="auto"><code>pages</code> is a special job that is used to upload static content to GitLab that&#x000A;can be used to serve your website. It has a special syntax, so the two&#x000A;requirements below must be met:</p>&#x000A;<ul data-sourcepos="2650:1-2652:0" dir="auto">&#x000A;<li data-sourcepos="2650:1-2650:64">Any static content must be placed under a <code>public/</code> directory.</li>&#x000A;<li data-sourcepos="2651:1-2652:0">&#x000A;<code>artifacts</code> with a path to the <code>public/</code> directory must be defined.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2653:1-2655:40" dir="auto">The example below simply moves all files from the root of the project to the&#x000A;<code>public/</code> directory. The <code>.public</code> workaround is so <code>cp</code> doesn't also copy&#x000A;<code>public/</code> to itself in an infinite loop:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">pages</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mkdir .public</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">cp -r * .public</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mv .public public</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">artifacts</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">      <span class="pi">-</span> <span class="s">public</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">  <span class="na">only</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">master</span></span></code></pre>&#x000A;<p data-sourcepos="2671:1-2671:82" dir="auto">Read more on <a href="../../user/project/pages/index.md">GitLab Pages user documentation</a>.</p>&#x000A;<h3 data-sourcepos="2673:1-2673:15" dir="auto">&#x000A;<a id="user-content-variables" class="anchor" href="#variables" aria-hidden="true"></a><code>variables</code>&#x000A;</h3>&#x000A;<blockquote data-sourcepos="2675:1-2675:37" dir="auto">&#x000A;<p data-sourcepos="2675:3-2675:37">Introduced in GitLab Runner v0.5.0.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2677:1-2679:40" dir="auto">NOTE: <strong>Note:</strong>&#x000A;Integers (as well as strings) are legal both for variable's name and value.&#x000A;Floats are not legal and cannot be used.</p>&#x000A;<p data-sourcepos="2681:1-2684:35" dir="auto">GitLab CI/CD allows you to define variables inside <code>.gitlab-ci.yml</code> that are&#x000A;then passed in the job environment. They can be set globally and per-job.&#x000A;When the <code>variables</code> keyword is used on a job level, it overrides the global&#x000A;YAML variables and predefined ones.</p>&#x000A;<p data-sourcepos="2686:1-2687:35" dir="auto">They are stored in the Git repository and are meant to store non-sensitive&#x000A;project configuration, for example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">DATABASE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgres://postgres@postgres/my_database"</span></span></code></pre>&#x000A;<p data-sourcepos="2694:1-2696:32" dir="auto">These variables can be later used in all executed commands and scripts.&#x000A;The YAML-defined variables are also set to all created service containers,&#x000A;thus allowing to fine tune them.</p>&#x000A;<p data-sourcepos="2698:1-2704:32" dir="auto">Except for the user defined variables, there are also the ones <a href="../variables/README.md#predefined-environment-variables">set up by the&#x000A;Runner itself</a>.&#x000A;One example would be <code>CI_COMMIT_REF_NAME</code> which has the value of&#x000A;the branch or tag name for which project is built. Apart from the variables&#x000A;you can set in <code>.gitlab-ci.yml</code>, there are also the so called&#x000A;<a href="../variables/README.md#gitlab-cicd-environment-variables">Variables</a>&#x000A;which can be set in GitLab's UI.</p>&#x000A;<p data-sourcepos="2706:1-2706:59" dir="auto">Learn more about <a href="../variables/README.md" title="CI/CD variables">variables and their priority</a>.</p>&#x000A;<h4 data-sourcepos="2708:1-2708:17" dir="auto">&#x000A;<a id="user-content-git-strategy" class="anchor" href="#git-strategy" aria-hidden="true"></a>Git strategy</h4>&#x000A;<blockquote data-sourcepos="2710:1-2712:8" dir="auto">&#x000A;<p data-sourcepos="2710:3-2712:8">Introduced in GitLab 8.9 as an experimental feature. May change or be removed&#x000A;completely in future releases. <code>GIT_STRATEGY=none</code> requires GitLab Runner&#x000A;v1.7+.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2714:1-2716:60" dir="auto">You can set the <code>GIT_STRATEGY</code> used for getting recent application code, either&#x000A;globally or per-job in the <a href="#variables"><code>variables</code></a> section. If left&#x000A;unspecified, the default from project settings will be used.</p>&#x000A;<p data-sourcepos="2718:1-2718:62" dir="auto">There are three possible values: <code>clone</code>, <code>fetch</code>, and <code>none</code>.</p>&#x000A;<p data-sourcepos="2720:1-2721:60" dir="auto"><code>clone</code> is the slowest option. It clones the repository from scratch for every&#x000A;job, ensuring that the project workspace is always pristine.</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_STRATEGY</span><span class="pi">:</span> <span class="s">clone</span></span></code></pre>&#x000A;<p data-sourcepos="2728:1-2730:77" dir="auto"><code>fetch</code> is faster as it re-uses the project workspace (falling back to <code>clone</code>&#x000A;if it doesn't exist). <code>git clean</code> is used to undo any changes made by the last&#x000A;job, and <code>git fetch</code> is used to retrieve commits made since the last job ran.</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_STRATEGY</span><span class="pi">:</span> <span class="s">fetch</span></span></code></pre>&#x000A;<p data-sourcepos="2737:1-2741:73" dir="auto"><code>none</code> also re-uses the project workspace, but skips all Git operations&#x000A;(including GitLab Runner's pre-clone script, if present). It is mostly useful&#x000A;for jobs that operate exclusively on artifacts (e.g., <code>deploy</code>). Git repository&#x000A;data may be present, but it is certain to be out of date, so you should only&#x000A;rely on files brought into the project workspace from cache or artifacts.</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_STRATEGY</span><span class="pi">:</span> <span class="s">none</span></span></code></pre>&#x000A;<p data-sourcepos="2748:1-2751:12" dir="auto">NOTE: <strong>Note:</strong> <code>GIT_STRATEGY</code> is not supported for&#x000A;<a href="https://docs.gitlab.com/runner/executors/kubernetes.html" rel="nofollow noreferrer noopener" target="_blank">Kubernetes executor</a>,&#x000A;but may be in the future. See the <a href="https://gitlab.com/gitlab-org/gitlab-runner/issues/3847" rel="nofollow noreferrer noopener" target="_blank">support Git strategy with Kubernetes executor feature proposal</a>&#x000A;for updates.</p>&#x000A;<h4 data-sourcepos="2753:1-2753:27" dir="auto">&#x000A;<a id="user-content-git-submodule-strategy" class="anchor" href="#git-submodule-strategy" aria-hidden="true"></a>Git submodule strategy</h4>&#x000A;<blockquote data-sourcepos="2755:1-2755:32" dir="auto">&#x000A;<p data-sourcepos="2755:3-2755:32">Requires GitLab Runner v1.10+.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2757:1-2759:61" dir="auto">The <code>GIT_SUBMODULE_STRATEGY</code> variable is used to control if / how Git&#x000A;submodules are included when fetching the code before a build. You can set them&#x000A;globally or per-job in the <a href="#variables"><code>variables</code></a> section.</p>&#x000A;<p data-sourcepos="2761:1-2761:67" dir="auto">There are three possible values: <code>none</code>, <code>normal</code>, and <code>recursive</code>:</p>&#x000A;<ul data-sourcepos="2763:1-2783:0" dir="auto">&#x000A;<li data-sourcepos="2763:1-2765:0">&#x000A;<p data-sourcepos="2763:3-2764:66"><code>none</code> means that submodules will not be included when fetching the project&#x000A;code. This is the default, which matches the pre-v1.10 behavior.</p>&#x000A;</li>&#x000A;<li data-sourcepos="2766:1-2773:0">&#x000A;<p data-sourcepos="2766:3-2767:16"><code>normal</code> means that only the top-level submodules will be included. It is&#x000A;equivalent to:</p>&#x000A;<pre class="code highlight js-syntax-highlight plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">git submodule sync</span>&#x000A;<span id="LC2" class="line" lang="plaintext">git submodule update --init</span></code></pre>&#x000A;</li>&#x000A;<li data-sourcepos="2774:1-2783:0">&#x000A;<p data-sourcepos="2774:3-2777:46"><code>recursive</code> means that all submodules (including submodules of submodules)&#x000A;will be included. This feature needs Git v1.8.1 and later. When using a&#x000A;GitLab Runner with an executor not based on Docker, make sure the Git version&#x000A;meets that requirement. It is equivalent to:</p>&#x000A;<pre class="code highlight js-syntax-highlight plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">git submodule sync --recursive</span>&#x000A;<span id="LC2" class="line" lang="plaintext">git submodule update --init --recursive</span></code></pre>&#x000A;</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2784:1-2785:31" dir="auto">Note that for this feature to work correctly, the submodules must be configured&#x000A;(in <code>.gitmodules</code>) with either:</p>&#x000A;<ul data-sourcepos="2787:1-2790:0" dir="auto">&#x000A;<li data-sourcepos="2787:1-2787:57">the HTTP(S) URL of a publicly-accessible repository, or</li>&#x000A;<li data-sourcepos="2788:1-2790:0">a relative path to another repository on the same GitLab server. See the&#x000A;<a href="../git_submodules.md">Git submodules</a> documentation.</li>&#x000A;</ul>&#x000A;<h4 data-sourcepos="2791:1-2791:17" dir="auto">&#x000A;<a id="user-content-git-checkout" class="anchor" href="#git-checkout" aria-hidden="true"></a>Git checkout</h4>&#x000A;<blockquote data-sourcepos="2793:1-2793:34" dir="auto">&#x000A;<p data-sourcepos="2793:3-2793:34">Introduced in GitLab Runner 9.3.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2795:1-2798:34" dir="auto">The <code>GIT_CHECKOUT</code> variable can be used when the <code>GIT_STRATEGY</code> is set to either&#x000A;<code>clone</code> or <code>fetch</code> to specify whether a <code>git checkout</code> should be run. If not&#x000A;specified, it defaults to true. You can set them globally or per-job in the&#x000A;<a href="#variables"><code>variables</code></a> section.</p>&#x000A;<p data-sourcepos="2800:1-2800:35" dir="auto">If set to <code>false</code>, the Runner will:</p>&#x000A;<ul data-sourcepos="2802:1-2806:0" dir="auto">&#x000A;<li data-sourcepos="2802:1-2803:23">when doing <code>fetch</code> - update the repository and leave working copy on&#x000A;the current revision,</li>&#x000A;<li data-sourcepos="2804:1-2806:0">when doing <code>clone</code> - clone the repository and leave working copy on the&#x000A;default branch.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2807:1-2809:19" dir="auto">Having this setting set to <code>true</code> will mean that for both <code>clone</code> and <code>fetch</code>&#x000A;strategies the Runner will checkout the working copy to a revision related&#x000A;to the CI pipeline:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_STRATEGY</span><span class="pi">:</span> <span class="s">clone</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">GIT_CHECKOUT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">git checkout -B master origin/master</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">git merge $CI_COMMIT_SHA</span></span></code></pre>&#x000A;<h4 data-sourcepos="2820:1-2820:20" dir="auto">&#x000A;<a id="user-content-git-clean-flags" class="anchor" href="#git-clean-flags" aria-hidden="true"></a>Git clean flags</h4>&#x000A;<blockquote data-sourcepos="2822:1-2822:35" dir="auto">&#x000A;<p data-sourcepos="2822:3-2822:35">Introduced in GitLab Runner 11.10</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2824:1-2826:34" dir="auto">The <code>GIT_CLEAN_FLAGS</code> variable is used to control the default behavior of&#x000A;<code>git clean</code> after checking out the sources. You can set it globally or per-job in the&#x000A;<a href="#variables"><code>variables</code></a> section.</p>&#x000A;<p data-sourcepos="2828:1-2829:8" dir="auto"><code>GIT_CLEAN_FLAGS</code> accepts all possible options of the <a href="https://git-scm.com/docs/git-clean" rel="nofollow noreferrer noopener" target="_blank">git clean</a>&#x000A;command.</p>&#x000A;<p data-sourcepos="2831:1-2831:64" dir="auto"><code>git clean</code> is disabled if <code>GIT_CHECKOUT: "false"</code> is specified.</p>&#x000A;<p data-sourcepos="2833:1-2833:24" dir="auto">If <code>GIT_CLEAN_FLAGS</code> is:</p>&#x000A;<ul data-sourcepos="2835:1-2837:0" dir="auto">&#x000A;<li data-sourcepos="2835:1-2835:54">Not specified, <code>git clean</code> flags default to <code>-ffdx</code>.</li>&#x000A;<li data-sourcepos="2836:1-2837:0">Given the value <code>none</code>, <code>git clean</code> is not executed.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2838:1-2838:12" dir="auto">For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_CLEAN_FLAGS</span><span class="pi">:</span> <span class="s">-ffdx -e cache/</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"><span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">  <span class="pi">-</span> <span class="s">ls -al cache/</span></span></code></pre>&#x000A;<h4 data-sourcepos="2847:1-2847:24" dir="auto">&#x000A;<a id="user-content-job-stages-attempts" class="anchor" href="#job-stages-attempts" aria-hidden="true"></a>Job stages attempts</h4>&#x000A;<blockquote data-sourcepos="2849:1-2849:56" dir="auto">&#x000A;<p data-sourcepos="2849:3-2849:56">Introduced in GitLab, it requires GitLab Runner v1.9+.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2851:1-2852:24" dir="auto">You can set the number for attempts the running job will try to execute each&#x000A;of the following stages:</p>&#x000A;<table data-sourcepos="2854:1-2858:91" dir="auto">&#x000A;<thead>&#x000A;<tr data-sourcepos="2854:1-2854:49">&#x000A;<th data-sourcepos="2854:2-2854:34">Variable</th>&#x000A;<th data-sourcepos="2854:36-2854:48">Description</th>&#x000A;</tr>&#x000A;</thead>&#x000A;<tbody>&#x000A;<tr data-sourcepos="2856:1-2856:87">&#x000A;<td data-sourcepos="2856:2-2856:34"><strong>GET_SOURCES_ATTEMPTS</strong></td>&#x000A;<td data-sourcepos="2856:36-2856:86">Number of attempts to fetch sources running a job</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="2857:1-2857:92">&#x000A;<td data-sourcepos="2857:2-2857:34"><strong>ARTIFACT_DOWNLOAD_ATTEMPTS</strong></td>&#x000A;<td data-sourcepos="2857:36-2857:91">Number of attempts to download artifacts running a job</td>&#x000A;</tr>&#x000A;<tr data-sourcepos="2858:1-2858:91">&#x000A;<td data-sourcepos="2858:2-2858:34"><strong>RESTORE_CACHE_ATTEMPTS</strong></td>&#x000A;<td data-sourcepos="2858:36-2858:90">Number of attempts to restore the cache running a job</td>&#x000A;</tr>&#x000A;</tbody>&#x000A;</table>&#x000A;<p data-sourcepos="2860:1-2860:34" dir="auto">The default is one single attempt.</p>&#x000A;<p data-sourcepos="2862:1-2862:8" dir="auto">Example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GET_SOURCES_ATTEMPTS</span><span class="pi">:</span> <span class="m">3</span></span></code></pre>&#x000A;<p data-sourcepos="2869:1-2869:78" dir="auto">You can set them globally or per-job in the <a href="#variables"><code>variables</code></a> section.</p>&#x000A;<h4 data-sourcepos="2871:1-2871:20" dir="auto">&#x000A;<a id="user-content-shallow-cloning" class="anchor" href="#shallow-cloning" aria-hidden="true"></a>Shallow cloning</h4>&#x000A;<blockquote data-sourcepos="2873:1-2874:34" dir="auto">&#x000A;<p data-sourcepos="2873:3-2874:34">Introduced in GitLab 8.9 as an experimental feature. May change in future&#x000A;releases or be removed completely.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2876:1-2879:38" dir="auto">You can specify the depth of fetching and cloning using <code>GIT_DEPTH</code>. This allows&#x000A;shallow cloning of the repository which can significantly speed up cloning for&#x000A;repositories with a large number of commits or old, large binaries. The value is&#x000A;passed to <code>git fetch</code> and <code>git clone</code>.</p>&#x000A;<p data-sourcepos="2881:1-2883:20" dir="auto">NOTE: <strong>Note:</strong>&#x000A;If you use a depth of 1 and have a queue of jobs or retry&#x000A;jobs, jobs may fail.</p>&#x000A;<p data-sourcepos="2885:1-2890:76" dir="auto">Since Git fetching and cloning is based on a ref, such as a branch name, Runners&#x000A;can't clone a specific commit SHA. If there are multiple jobs in the queue, or&#x000A;you are retrying an old job, the commit to be tested needs to be within the&#x000A;Git history that is cloned. Setting too small a value for <code>GIT_DEPTH</code> can make&#x000A;it impossible to run these old commits. You will see <code>unresolved reference</code> in&#x000A;job logs. You should then reconsider changing <code>GIT_DEPTH</code> to a higher value.</p>&#x000A;<p data-sourcepos="2892:1-2893:50" dir="auto">Jobs that rely on <code>git describe</code> may not work correctly when <code>GIT_DEPTH</code> is&#x000A;set since only part of the Git history is present.</p>&#x000A;<p data-sourcepos="2895:1-2895:42" dir="auto">To fetch or clone only the last 3 commits:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_DEPTH</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span></span></code></pre>&#x000A;<p data-sourcepos="2902:1-2902:76" dir="auto">You can set it globally or per-job in the <a href="#variables"><code>variables</code></a> section.</p>&#x000A;<h2 data-sourcepos="2904:1-2904:24" dir="auto">&#x000A;<a id="user-content-deprecated-parameters" class="anchor" href="#deprecated-parameters" aria-hidden="true"></a>Deprecated parameters</h2>&#x000A;<p data-sourcepos="2906:1-2906:40" dir="auto">The following parameters are deprecated.</p>&#x000A;<h3 data-sourcepos="2908:1-2908:28" dir="auto">&#x000A;<a id="user-content-globally-defined-types" class="anchor" href="#globally-defined-types" aria-hidden="true"></a>Globally-defined <code>types</code>&#x000A;</h3>&#x000A;<p data-sourcepos="2910:1-2912:32" dir="auto">CAUTION: <strong>Deprecated:</strong>&#x000A;<code>types</code> is deprecated, and could be removed in a future release.&#x000A;Use <a href="#stages"><code>stages</code></a> instead.</p>&#x000A;<h3 data-sourcepos="2914:1-2914:22" dir="auto">&#x000A;<a id="user-content-job-defined-type" class="anchor" href="#job-defined-type" aria-hidden="true"></a>Job-defined <code>type</code>&#x000A;</h3>&#x000A;<p data-sourcepos="2916:1-2918:30" dir="auto">CAUTION: <strong>Deprecated:</strong>&#x000A;<code>type</code> is deprecated, and could be removed in one of the future releases.&#x000A;Use <a href="#stage"><code>stage</code></a> instead.</p>&#x000A;<h3 data-sourcepos="2920:1-2920:82" dir="auto">&#x000A;<a id="user-content-globally-defined-image-services-cache-before_script-after_script" class="anchor" href="#globally-defined-image-services-cache-before_script-after_script" aria-hidden="true"></a>Globally-defined <code>image</code>, <code>services</code>, <code>cache</code>, <code>before_script</code>, <code>after_script</code>&#x000A;</h3>&#x000A;<p data-sourcepos="2922:1-2924:22" dir="auto">Defining <code>image</code>, <code>services</code>, <code>cache</code>, <code>before_script</code>, and&#x000A;<code>after_script</code> globally is deprecated. Support could be removed&#x000A;from a future release.</p>&#x000A;<p data-sourcepos="2926:1-2926:67" dir="auto">Use <a href="#setting-default-parameters"><code>default:</code></a> instead. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">default</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.5</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">docker:dind</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">cache</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="na">paths</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">vendor/</span><span class="pi">]</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">  <span class="na">before_script</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">bundle install --path vendor/</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">after_script</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">rm -rf tmp/</span></span></code></pre>&#x000A;<h2 data-sourcepos="2941:1-2941:27" dir="auto">&#x000A;<a id="user-content-custom-build-directories" class="anchor" href="#custom-build-directories" aria-hidden="true"></a>Custom build directories</h2>&#x000A;<blockquote data-sourcepos="2943:1-2943:102" dir="auto">&#x000A;<p data-sourcepos="2943:3-2943:102"><a href="https://gitlab.com/gitlab-org/gitlab-runner/merge_requests/1267" rel="nofollow noreferrer noopener" target="_blank">Introduced</a> in Gitlab Runner 11.10</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="2945:1-2948:73" dir="auto">NOTE: <strong>Note:</strong>&#x000A;This can only be used when <code>custom_build_dir</code> is enabled in the <a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runnerscustom_build_dir-section" rel="nofollow noreferrer noopener" target="_blank">Runner's&#x000A;configuration</a>.&#x000A;This is the default configuration for <code>docker</code> and <code>kubernetes</code> executor.</p>&#x000A;<p data-sourcepos="2950:1-2954:11" dir="auto">By default, GitLab Runner clones the repository in a unique subpath of the&#x000A;<code>$CI_BUILDS_DIR</code> directory. However, your project might require the code in a&#x000A;specific directory (Go projects, for example). In that case, you can specify&#x000A;the <code>GIT_CLONE_PATH</code> variable to tell the Runner in which directory to clone the&#x000A;repository:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_CLONE_PATH</span><span class="pi">:</span> <span class="s">$CI_BUILDS_DIR/project-name</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">pwd</span></span></code></pre>&#x000A;<p data-sourcepos="2965:1-2967:8" dir="auto">The <code>GIT_CLONE_PATH</code> has to always be within <code>$CI_BUILDS_DIR</code>. The directory set in <code>$CI_BUILDS_DIR</code>&#x000A;is dependent on executor and configuration of <a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html#the-runners-section" rel="nofollow noreferrer noopener" target="_blank">runners.builds_dir</a>&#x000A;setting.</p>&#x000A;<h3 data-sourcepos="2969:1-2969:24" dir="auto">&#x000A;<a id="user-content-handling-concurrency" class="anchor" href="#handling-concurrency" aria-hidden="true"></a>Handling concurrency</h3>&#x000A;<p data-sourcepos="2971:1-2975:71" dir="auto">An executor using a concurrency greater than <code>1</code> might lead&#x000A;to failures because multiple jobs might be working on the same directory if the <code>builds_dir</code>&#x000A;is shared between jobs.&#x000A;GitLab Runner does not try to prevent this situation. It is up to the administrator&#x000A;and developers to comply with the requirements of Runner configuration.</p>&#x000A;<p data-sourcepos="2977:1-2978:75" dir="auto">To avoid this scenario, you can use a unique path within <code>$CI_BUILDS_DIR</code>, because Runner&#x000A;exposes two additional variables that provide a unique <code>ID</code> of concurrency:</p>&#x000A;<ul data-sourcepos="2980:1-2982:0" dir="auto">&#x000A;<li data-sourcepos="2980:1-2980:80">&#x000A;<code>$CI_CONCURRENT_ID</code>: Unique ID for all jobs running within the given executor.</li>&#x000A;<li data-sourcepos="2981:1-2982:0">&#x000A;<code>$CI_CONCURRENT_PROJECT_ID</code>: Unique ID for all jobs running within the given executor and project.</li>&#x000A;</ul>&#x000A;<p data-sourcepos="2983:1-2984:67" dir="auto">The most stable configuration that should work well in any scenario and on any executor&#x000A;is to use <code>$CI_CONCURRENT_ID</code> in the <code>GIT_CLONE_PATH</code>. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_CLONE_PATH</span><span class="pi">:</span> <span class="s">$CI_BUILDS_DIR/$CI_CONCURRENT_ID/project-name</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">pwd</span></span></code></pre>&#x000A;<p data-sourcepos="2995:1-2996:106" dir="auto">The <code>$CI_CONCURRENT_PROJECT_ID</code> should be used in conjunction with <code>$CI_PROJECT_PATH</code>&#x000A;as the <code>$CI_PROJECT_PATH</code> provides a path of a repository. That is, <code>group/subgroup/project</code>. For example:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GIT_CLONE_PATH</span><span class="pi">:</span> <span class="s">$CI_BUILDS_DIR/$CI_CONCURRENT_ID/$CI_PROJECT_PATH</span></span>&#x000A;<span id="LC3" class="line" lang="yaml"></span>&#x000A;<span id="LC4" class="line" lang="yaml"><span class="na">test</span><span class="pi">:</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">pwd</span></span></code></pre>&#x000A;<h3 data-sourcepos="3007:1-3007:16" dir="auto">&#x000A;<a id="user-content-nested-paths" class="anchor" href="#nested-paths" aria-hidden="true"></a>Nested paths</h3>&#x000A;<p data-sourcepos="3009:1-3010:27" dir="auto">The value of <code>GIT_CLONE_PATH</code> is expanded once and nesting variables&#x000A;within it is not supported.</p>&#x000A;<p data-sourcepos="3012:1-3013:22" dir="auto">For example, you define both the variables below in your&#x000A;<code>.gitlab-ci.yml</code> file:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="na">variables</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">GOPATH</span><span class="pi">:</span> <span class="s">$CI_BUILDS_DIR/go</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">GIT_CLONE_PATH</span><span class="pi">:</span> <span class="s">$GOPATH/src/namespace/project</span></span></code></pre>&#x000A;<p data-sourcepos="3021:1-3023:41" dir="auto">The value of <code>GIT_CLONE_PATH</code> is expanded once into&#x000A;<code>$CI_BUILDS_DIR/go/src/namespace/project</code>, and results in failure&#x000A;because <code>$CI_BUILDS_DIR</code> is not expanded.</p>&#x000A;<h2 data-sourcepos="3025:1-3025:24" dir="auto">&#x000A;<a id="user-content-special-yaml-features" class="anchor" href="#special-yaml-features" aria-hidden="true"></a>Special YAML features</h2>&#x000A;<p data-sourcepos="3027:1-3029:20" dir="auto">It's possible to use special YAML features like anchors (<code>&amp;</code>), aliases (<code>*</code>)&#x000A;and map merging (<code>&lt;&lt;</code>), which will allow you to greatly reduce the complexity&#x000A;of <code>.gitlab-ci.yml</code>.</p>&#x000A;<p data-sourcepos="3031:1-3031:85" dir="auto">Read more about the various <a href="https://learnxinyminutes.com/docs/yaml/" rel="nofollow noreferrer noopener" target="_blank">YAML features</a>.</p>&#x000A;<h3 data-sourcepos="3033:1-3033:22" dir="auto">&#x000A;<a id="user-content-hidden-keys-jobs" class="anchor" href="#hidden-keys-jobs" aria-hidden="true"></a>Hidden keys (jobs)</h3>&#x000A;<blockquote data-sourcepos="3035:1-3035:52" dir="auto">&#x000A;<p data-sourcepos="3035:3-3035:52">Introduced in GitLab 8.6 and GitLab Runner v1.1.1.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="3037:1-3038:31" dir="auto">If you want to temporarily 'disable' a job, rather than commenting out all the&#x000A;lines where the job is defined:</p>&#x000A;<pre class="code highlight js-syntax-highlight plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">#hidden_job:</span>&#x000A;<span id="LC2" class="line" lang="plaintext">#  script:</span>&#x000A;<span id="LC3" class="line" lang="plaintext">#    - run test</span></code></pre>&#x000A;<p data-sourcepos="3046:1-3047:67" dir="auto">you can instead start its name with a dot (<code>.</code>) and it will not be processed by&#x000A;GitLab CI. In the following example, <code>.hidden_job</code> will be ignored:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.hidden_job</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">run test</span></span></code></pre>&#x000A;<p data-sourcepos="3055:1-3057:15" dir="auto">Use this feature to ignore jobs, or use the&#x000A;<a href="#special-yaml-features">special YAML features</a> and transform the hidden keys&#x000A;into templates.</p>&#x000A;<h3 data-sourcepos="3059:1-3059:11" dir="auto">&#x000A;<a id="user-content-anchors" class="anchor" href="#anchors" aria-hidden="true"></a>Anchors</h3>&#x000A;<blockquote data-sourcepos="3061:1-3061:52" dir="auto">&#x000A;<p data-sourcepos="3061:3-3061:52">Introduced in GitLab 8.6 and GitLab Runner v1.1.1.</p>&#x000A;</blockquote>&#x000A;<p data-sourcepos="3063:1-3066:35" dir="auto">YAML has a handy feature called 'anchors', which lets you easily duplicate&#x000A;content across your document. Anchors can be used to duplicate/inherit&#x000A;properties, and is a perfect example to be used with <a href="#hidden-keys-jobs">hidden keys</a>&#x000A;to provide templates for your jobs.</p>&#x000A;<p data-sourcepos="3068:1-3070:41" dir="auto">The following example uses anchors and map merging. It will create two jobs,&#x000A;<code>test1</code> and <code>test2</code>, that will inherit the parameters of <code>.job_template</code>, each&#x000A;having their own custom <code>script</code> defined:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.job_template</span><span class="pi">:</span> <span class="nl">&amp;job_definition</span>  <span class="c1"># Hidden key that defines an anchor named 'job_definition'</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.1</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">redis</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="na">test1</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*job_definition</span>           <span class="c1"># Merge the contents of the 'job_definition' alias</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test1 project</span></span>&#x000A;<span id="LC11" class="line" lang="yaml"></span>&#x000A;<span id="LC12" class="line" lang="yaml"><span class="na">test2</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*job_definition</span>           <span class="c1"># Merge the contents of the 'job_definition' alias</span></span>&#x000A;<span id="LC14" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC15" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test2 project</span></span></code></pre>&#x000A;<p data-sourcepos="3090:1-3092:63" dir="auto"><code>&amp;</code> sets up the name of the anchor (<code>job_definition</code>), <code>&lt;&lt;</code> means "merge the&#x000A;given hash into the current one", and <code>*</code> includes the named anchor&#x000A;(<code>job_definition</code> again). The expanded version looks like this:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.job_template</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.1</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC4" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC5" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">redis</span></span>&#x000A;<span id="LC6" class="line" lang="yaml"></span>&#x000A;<span id="LC7" class="line" lang="yaml"><span class="na">test1</span><span class="pi">:</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.1</span></span>&#x000A;<span id="LC9" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC10" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">redis</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test1 project</span></span>&#x000A;<span id="LC14" class="line" lang="yaml"></span>&#x000A;<span id="LC15" class="line" lang="yaml"><span class="na">test2</span><span class="pi">:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="na">image</span><span class="pi">:</span> <span class="s">ruby:2.1</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC18" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC19" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">redis</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test2 project</span></span></code></pre>&#x000A;<p data-sourcepos="3118:1-3121:77" dir="auto">Let's see another one example. This time we will use anchors to define two sets&#x000A;of services. This will create two jobs, <code>test:postgres</code> and <code>test:mysql</code>, that&#x000A;will share the <code>script</code> directive defined in <code>.job_template</code>, and the <code>services</code>&#x000A;directive defined in <code>.postgres_services</code> and <code>.mysql_services</code> respectively:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.job_template</span><span class="pi">:</span> <span class="nl">&amp;job_definition</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test project</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="s">.postgres_services</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span> <span class="nl">&amp;postgres_definition</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC9" class="line" lang="yaml"></span>&#x000A;<span id="LC10" class="line" lang="yaml"><span class="s">.mysql_services</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span> <span class="nl">&amp;mysql_definition</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mysql</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC14" class="line" lang="yaml"></span>&#x000A;<span id="LC15" class="line" lang="yaml"><span class="s">test:postgres:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*job_definition</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span> <span class="nv">*postgres_definition</span></span>&#x000A;<span id="LC18" class="line" lang="yaml"></span>&#x000A;<span id="LC19" class="line" lang="yaml"><span class="s">test:mysql:</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*job_definition</span></span>&#x000A;<span id="LC21" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span> <span class="nv">*mysql_definition</span></span></code></pre>&#x000A;<p data-sourcepos="3147:1-3147:37" dir="auto">The expanded version looks like this:</p>&#x000A;<pre class="code highlight js-syntax-highlight yaml" lang="yaml" v-pre="true"><code><span id="LC1" class="line" lang="yaml"><span class="s">.job_template</span><span class="pi">:</span></span>&#x000A;<span id="LC2" class="line" lang="yaml">  <span class="na">script</span><span class="pi">:</span></span>&#x000A;<span id="LC3" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test project</span></span>&#x000A;<span id="LC4" class="line" lang="yaml"></span>&#x000A;<span id="LC5" class="line" lang="yaml"><span class="s">.postgres_services</span><span class="pi">:</span></span>&#x000A;<span id="LC6" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC7" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC8" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC9" class="line" lang="yaml"></span>&#x000A;<span id="LC10" class="line" lang="yaml"><span class="s">.mysql_services</span><span class="pi">:</span></span>&#x000A;<span id="LC11" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC12" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mysql</span></span>&#x000A;<span id="LC13" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC14" class="line" lang="yaml"></span>&#x000A;<span id="LC15" class="line" lang="yaml"><span class="s">test:postgres:</span></span>&#x000A;<span id="LC16" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span></span>&#x000A;<span id="LC17" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test project</span></span>&#x000A;<span id="LC18" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC19" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">postgres</span></span>&#x000A;<span id="LC20" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span>&#x000A;<span id="LC21" class="line" lang="yaml"></span>&#x000A;<span id="LC22" class="line" lang="yaml"><span class="s">test:mysql:</span></span>&#x000A;<span id="LC23" class="line" lang="yaml">  <span class="s">script</span><span class="pi">:</span></span>&#x000A;<span id="LC24" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">test project</span></span>&#x000A;<span id="LC25" class="line" lang="yaml">  <span class="na">services</span><span class="pi">:</span></span>&#x000A;<span id="LC26" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">mysql</span></span>&#x000A;<span id="LC27" class="line" lang="yaml">    <span class="pi">-</span> <span class="s">ruby</span></span></code></pre>&#x000A;<p data-sourcepos="3179:1-3179:68" dir="auto">You can see that the hidden keys are conveniently used as templates.</p>&#x000A;<h2 data-sourcepos="3181:1-3181:11" dir="auto">&#x000A;<a id="user-content-triggers" class="anchor" href="#triggers" aria-hidden="true"></a>Triggers</h2>&#x000A;<p data-sourcepos="3183:1-3184:68" dir="auto">Triggers can be used to force a rebuild of a specific branch, tag or commit,&#x000A;with an API call when a pipeline gets created using a trigger token.</p>&#x000A;<p data-sourcepos="3186:1-3186:54" dir="auto">Not to be confused with <a href="#trigger-premium"><code>trigger</code></a>.</p>&#x000A;<p data-sourcepos="3188:1-3188:65" dir="auto"><a href="../triggers/README.md">Read more in the triggers documentation.</a></p>&#x000A;<h2 data-sourcepos="3190:1-3190:24" dir="auto">&#x000A;<a id="user-content-processing-git-pushes" class="anchor" href="#processing-git-pushes" aria-hidden="true"></a>Processing Git pushes</h2>&#x000A;<p data-sourcepos="3192:1-3193:63" dir="auto">GitLab will create at most 4 branch and tags pipelines when&#x000A;doing pushing multiple changes in single <code>git push</code> invocation.</p>&#x000A;<p data-sourcepos="3195:1-3197:68" dir="auto">This limitation does not affect any of the updated Merge Request pipelines,&#x000A;all updated Merge Requests will have a pipeline created when using&#x000A;<a href="../merge_request_pipelines/index.md">pipelines for merge requests</a>.</p>&#x000A;<h2 data-sourcepos="3199:1-3199:16" dir="auto">&#x000A;<a id="user-content-skipping-jobs" class="anchor" href="#skipping-jobs" aria-hidden="true"></a>Skipping jobs</h2>&#x000A;<p data-sourcepos="3201:1-3202:76" dir="auto">If your commit message contains <code>[ci skip]</code> or <code>[skip ci]</code>, using any&#x000A;capitalization, the commit will be created but the pipeline will be skipped.</p>&#x000A;<p data-sourcepos="3204:1-3205:24" dir="auto">Alternatively, one can pass the <code>ci.skip</code> <a href="https://git-scm.com/docs/git-push#Documentation/git-push.txt--oltoptiongt" rel="nofollow noreferrer noopener" target="_blank">Git push option</a> if&#x000A;using Git 2.10 or newer:</p>&#x000A;<pre class="code highlight js-syntax-highlight shell" lang="shell" v-pre="true"><code><span id="LC1" class="line" lang="shell">git push <span class="nt">--push-option</span><span class="o">=</span>ci.skip    <span class="c"># using git 2.10+</span></span>&#x000A;<span id="LC2" class="line" lang="shell">git push <span class="nt">-o</span> ci.skip               <span class="c"># using git 2.18+</span></span></code></pre>
</div>

</div>
</div>
</div>
</div>




</body>
</html>

